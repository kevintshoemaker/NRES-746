<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Levi Heffelfinger" />


<title>Heffelfinger_HW4</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}

.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->






<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">NRES 746</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Schedule
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="schedule.html">Course Schedule</a>
    </li>
    <li>
      <a href="labschedule.html">Lab Schedule</a>
    </li>
    <li>
      <a href="Syllabus2.pdf">Syllabus</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Lectures
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="INTRO.html">Introduction to NRES 746</a>
    </li>
    <li>
      <a href="LECTURE1.html">Why focus on algorithms?</a>
    </li>
    <li>
      <a href="LECTURE2.html">Working with probabilities</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Lab exercises
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="LAB1.html">Lab 1: Algorithms in R</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Data sets
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="TreeData.csv">Tree Data</a>
    </li>
  </ul>
</li>
<li>
  <a href="Links.html">Links</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Heffelfinger_HW4</h1>
<h4 class="author"><em>Levi Heffelfinger</em></h4>
<h4 class="date"><em>December 5, 2016</em></h4>

</div>


<div id="homework-4" class="section level2">
<h2>Homework #4</h2>
</div>
<div id="levi-heffelfinger" class="section level2">
<h2>Levi Heffelfinger</h2>
</div>
<div id="nres-746" class="section level2">
<h2>NRES 746</h2>
</div>
<div id="question-1---ricker-model-in-jags" class="section level1">
<h1>Question 1 - Ricker model in JAGS</h1>
<p>Creating file and and setting up our priors</p>
<pre class="r"><code>library(R2jags)</code></pre>
<pre><code>## Loading required package: rjags</code></pre>
<pre><code>## Loading required package: coda</code></pre>
<pre><code>## Linked to JAGS 4.2.0</code></pre>
<pre><code>## Loaded modules: basemod,bugs</code></pre>
<pre><code>## 
## Attaching package: &#39;R2jags&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:coda&#39;:
## 
##     traceplot</code></pre>
<pre class="r"><code>library(coda)

cat(file=&quot;BUGSrickermodel.jags&quot;,&quot;
    model {
    
    #############
    # LIKELIHOOD
    ############
    for(i in 1:n.observations){
    mean[i]&lt;- a*day[i]*exp(-b*day[i])  #ricker function relationship
    rate[i]&lt;- shape/mean[i]            # BUGS wants rate not scale
    titer[i] ~ dgamma(shape,rate[i])
    }
    
    #############
    # PRIORS
    ############
    a ~ dgamma(0.1,0.1) #have to specify for each variable
    b ~ dgamma(0.1,0.1)
    shape ~ dgamma(0.01,0.01)
    }
    &quot;)</code></pre>
<p>Running it in JAGS</p>
<pre class="r"><code>library(emdbook)

MyxDat &lt;- MyxoTiter_sum
Myx &lt;- subset(MyxDat,grade==1)  #Data set from grade 1 of myxo data
head(Myx)</code></pre>
<pre><code>##   grade day titer
## 1     1   2 5.207
## 2     1   2 5.734
## 3     1   2 6.613
## 4     1   3 5.997
## 5     1   3 6.612
## 6     1   3 6.810</code></pre>
<pre class="r"><code>myx.data.for.bugs &lt;- list( #need these 3 parts of the data file
  titer = Myx$titer,
  day = Myx$day,
  n.observations = length(Myx$titer)
)

myx.data.for.bugs</code></pre>
<pre><code>## $titer
##  [1] 5.207 5.734 6.613 5.997 6.612 6.810 5.930 6.501 7.182 7.292 7.819
## [12] 7.489 6.918 6.808 6.235 6.916 4.196 7.682 8.189 7.707 7.597 7.112
## [23] 7.354 7.158 7.466 7.927 8.499
## 
## $day
##  [1] 2 2 2 3 3 3 4 4 4 4 5 5 5 5 6 6 2 9 8 7 7 8 8 6 6 6 6
## 
## $n.observations
## [1] 27</code></pre>
<pre class="r"><code>init.vals.for.bugs &lt;- function(){ #function to come up with some reasonable but random starting values for jags
  list(
    shape=runif(1,20,100),
    a=runif(1,0,10),
    b=runif(1,0,5)
  )
}
init.vals.for.bugs()</code></pre>
<pre><code>## $shape
## [1] 53.8953
## 
## $a
## [1] 3.992478
## 
## $b
## [1] 1.868626</code></pre>
<pre class="r"><code>params.to.store &lt;- c(&quot;shape&quot;,&quot;a&quot;, &quot;b&quot;)    # specify the parameters we want to get the posteriors for

#call jags to run model with given information
jags.rick &lt;- jags(data=myx.data.for.bugs,inits=init.vals.for.bugs,parameters.to.save=params.to.store,
                  n.iter=50000,model.file=&quot;BUGSrickermodel.jags&quot;,n.chains = 3,n.burnin = 5000,n.thin = 20 )</code></pre>
<pre><code>## module glm loaded</code></pre>
<pre><code>## Compiling model graph
##    Resolving undeclared variables
##    Allocating nodes
## Graph information:
##    Observed stochastic nodes: 27
##    Unobserved stochastic nodes: 3
##    Total graph size: 97
## 
## Initializing model</code></pre>
<pre class="r"><code>jags.rick</code></pre>
<pre><code>## Inference for Bugs model at &quot;BUGSrickermodel.jags&quot;, fit using jags,
##  3 chains, each with 50000 iterations (first 5000 discarded), n.thin = 20
##  n.sims = 6750 iterations saved
##          mu.vect sd.vect   2.5%    25%    50%    75%   97.5%  Rhat n.eff
## a          3.558   0.216  3.146  3.413  3.552  3.696   4.011 1.001  4200
## b          0.171   0.011  0.149  0.164  0.171  0.178   0.192 1.001  6800
## shape     78.778  22.321 41.353 62.987 76.370 92.456 128.963 1.001  6800
## deviance  62.395   2.763 59.263 60.397 61.642 63.642  69.752 1.001  4500
## 
## For each parameter, n.eff is a crude measure of effective sample size,
## and Rhat is the potential scale reduction factor (at convergence, Rhat=1).
## 
## DIC info (using the rule, pD = var(deviance)/2)
## pD = 3.8 and DIC = 66.2
## DIC is an estimate of expected predictive error (lower deviance is better).</code></pre>
<pre class="r"><code>jags.rick$BUGSoutput$mean$a</code></pre>
<pre><code>## [1] 3.55829</code></pre>
<pre class="r"><code>jagsrick.mcmc &lt;- as.mcmc(jags.rick)   # convert to &quot;MCMC&quot; object (coda package)
summary(jagsrick.mcmc) #read out of results</code></pre>
<pre><code>## 
## Iterations = 5001:49981
## Thinning interval = 20 
## Number of chains = 3 
## Sample size per chain = 2250 
## 
## 1. Empirical mean and standard deviation for each variable,
##    plus standard error of the mean:
## 
##             Mean       SD  Naive SE Time-series SE
## a         3.5583  0.21646 0.0026346      0.0031783
## b         0.1707  0.01105 0.0001345      0.0001634
## deviance 62.3946  2.76267 0.0336261      0.0336072
## shape    78.7778 22.32067 0.2716785      0.2717039
## 
## 2. Quantiles for each variable:
## 
##             2.5%     25%     50%    75%    97.5%
## a         3.1462  3.4127  3.5519  3.696   4.0108
## b         0.1486  0.1636  0.1706  0.178   0.1923
## deviance 59.2631 60.3971 61.6424 63.642  69.7522
## shape    41.3525 62.9872 76.3704 92.456 128.9630</code></pre>
<p>The maximum likelihood estimates are estimated from the liklihood surface as the highest probable values to explain the data, whereas the Bayesian estimates are means of the posterior distributions. Our estimates are very close for a and b, but our shape estimate in the Bayesian model is smaller than in ML. It should be noted that the Bayesian credible interval contains the shape estimate from ML.</p>
<p>ML estimates: a=3.5615 b=0.1713 shape=90.6791</p>
<p>JAGS Plots</p>
<pre class="r"><code>par(mar=c(2,2,2,2)) #resizes margins so plots fit
plot(jagsrick.mcmc) #plots chains and posteriors</code></pre>
<p><img src="Heffelfinger_HW4_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<pre class="r"><code>library(lattice)
densityplot(jagsrick.mcmc)</code></pre>
<p><img src="Heffelfinger_HW4_files/figure-html/unnamed-chunk-3-2.png" width="672" /></p>
<p>Setting up ricker function</p>
<pre class="r"><code>ricker&lt;- function(x,a, b) {
  a*x*exp(-b*x)}</code></pre>
<p>Plotting ricker function with JAGS results</p>
<pre class="r"><code>plot(myx.data.for.bugs$titer~myx.data.for.bugs$day, xlab=&quot;Day since infection&quot;, ylab=&quot;Virus titer&quot;, xlim=c(0,10), ylim=c(0,9))
curve(ricker(x,a=jags.rick$BUGSoutput$mean$a, b=jags.rick$BUGSoutput$mean$b), add=TRUE, col=&quot;green&quot;)</code></pre>
<pre><code>## Warning in a * x: Recycling array of length 1 in array-vector arithmetic is deprecated.
##   Use c() or as.vector() instead.</code></pre>
<pre><code>## Warning in -b * x: Recycling array of length 1 in array-vector arithmetic is deprecated.
##   Use c() or as.vector() instead.</code></pre>
<p><img src="Heffelfinger_HW4_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p>Checking for convergence</p>
<pre class="r"><code>print(gelman.diag(jagsrick.mcmc), digits = 4)</code></pre>
<pre><code>## Potential scale reduction factors:
## 
##          Point est. Upper C.I.
## a             1.000      1.001
## b             1.000      1.000
## deviance      1.001      1.004
## shape         1.000      1.001
## 
## Multivariate psrf
## 
## 1.001</code></pre>
<p>Gelman-rubin shows less than 1.1 so we’re good to go!</p>
<div id="question-2" class="section level2">
<h2>Question 2</h2>
<p>Running JAGS with M-M function</p>
<pre class="r"><code>cat(file=&quot;BUGSmmmodel.jags&quot;,&quot;
    model {
    
    #############
    # LIKELIHOOD
    ############
    for(i in 1:n.observations){
    mean[i]&lt;- (a*day[i])/(b+day[i])  #ricker function relationship
    rate[i]&lt;- shape/mean[i]            # BUGS wants rate not scale
    titer[i] ~ dgamma(shape,rate[i])
    }
    
    #############
    # PRIORS
    ############
    a ~ dgamma(0.1,0.1) #have to specify for each variable
    b ~ dgamma(0.1,0.1)
    shape ~ dgamma(0.01,0.01)
    }
    &quot;)


library(emdbook)

MyxDat &lt;- MyxoTiter_sum
Myx &lt;- subset(MyxDat,grade==1)  #Data set from grade 1 of myxo data
head(Myx)</code></pre>
<pre><code>##   grade day titer
## 1     1   2 5.207
## 2     1   2 5.734
## 3     1   2 6.613
## 4     1   3 5.997
## 5     1   3 6.612
## 6     1   3 6.810</code></pre>
<pre class="r"><code>myx.data.for.bugs &lt;- list( #need these 3 parts of the data file
  titer = Myx$titer,
  day = Myx$day,
  n.observations = length(Myx$titer)
)

myx.data.for.bugs</code></pre>
<pre><code>## $titer
##  [1] 5.207 5.734 6.613 5.997 6.612 6.810 5.930 6.501 7.182 7.292 7.819
## [12] 7.489 6.918 6.808 6.235 6.916 4.196 7.682 8.189 7.707 7.597 7.112
## [23] 7.354 7.158 7.466 7.927 8.499
## 
## $day
##  [1] 2 2 2 3 3 3 4 4 4 4 5 5 5 5 6 6 2 9 8 7 7 8 8 6 6 6 6
## 
## $n.observations
## [1] 27</code></pre>
<pre class="r"><code>init.vals.for.bugs &lt;- function(){ #function to come up with some reasonable but random starting values for jags
  list(
    shape=runif(1,20,100),
    a=runif(1,0,10),
    b=runif(1,0,5)
  )
}
init.vals.for.bugs()</code></pre>
<pre><code>## $shape
## [1] 25.12989
## 
## $a
## [1] 1.969144
## 
## $b
## [1] 0.4465381</code></pre>
<pre class="r"><code>params.to.store &lt;- c(&quot;shape&quot;,&quot;a&quot;, &quot;b&quot;)    # specify the parameters we want to get the posteriors for

#call jags to run model with given information
jags.mm &lt;- jags(data=myx.data.for.bugs,inits=init.vals.for.bugs,parameters.to.save=params.to.store,
                  n.iter=50000,model.file=&quot;BUGSmmmodel.jags&quot;,n.chains = 3,n.burnin = 5000,n.thin = 20 )</code></pre>
<pre><code>## Compiling model graph
##    Resolving undeclared variables
##    Allocating nodes
## Graph information:
##    Observed stochastic nodes: 27
##    Unobserved stochastic nodes: 3
##    Total graph size: 96
## 
## Initializing model</code></pre>
<p>Display trceplots and posteriors</p>
<pre class="r"><code>jagsmm.mcmc &lt;- as.mcmc(jags.mm)   # convert to &quot;MCMC&quot; object (coda package)
par(mar=c(2,2,2,2)) #resizes margins so plots fit
plot(jagsmm.mcmc) #plots chains and posteriors</code></pre>
<p><img src="Heffelfinger_HW4_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>Density plots</p>
<pre class="r"><code>densityplot(jagsmm.mcmc) #density plots</code></pre>
<p><img src="Heffelfinger_HW4_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<p>Estimates and Confidence Intervals</p>
<pre class="r"><code>jags.mm</code></pre>
<pre><code>## Inference for Bugs model at &quot;BUGSmmmodel.jags&quot;, fit using jags,
##  3 chains, each with 50000 iterations (first 5000 discarded), n.thin = 20
##  n.sims = 6750 iterations saved
##          mu.vect sd.vect   2.5%    25%    50%     75%   97.5%  Rhat n.eff
## a          8.814   0.511  7.852  8.470  8.797   9.139   9.886 1.002  1300
## b          1.182   0.303  0.618  0.978  1.166   1.373   1.816 1.007  3200
## shape     98.858  28.174 50.886 78.611 96.038 116.372 160.922 1.001  6800
## deviance  55.665   2.831 52.434 53.637 54.954  56.904  63.004 1.001  6800
## 
## For each parameter, n.eff is a crude measure of effective sample size,
## and Rhat is the potential scale reduction factor (at convergence, Rhat=1).
## 
## DIC info (using the rule, pD = var(deviance)/2)
## pD = 4.0 and DIC = 59.7
## DIC is an estimate of expected predictive error (lower deviance is better).</code></pre>
<p>Michaels-Menten versus Ricker</p>
<pre class="r"><code>mm&lt;- function(x,a, b) {
  (a*x)/(b+x)}

plot(myx.data.for.bugs$titer~myx.data.for.bugs$day, xlab=&quot;Day since infection&quot;, ylab=&quot;Virus titer&quot;, xlim=c(0,10), ylim=c(0,9))
curve(mm(x,a=jags.mm$BUGSoutput$mean$a,b=jags.mm$BUGSoutput$mean$b), add=TRUE, col=&quot;green&quot;)</code></pre>
<pre><code>## Warning in a * x: Recycling array of length 1 in array-vector arithmetic is deprecated.
##   Use c() or as.vector() instead.</code></pre>
<pre><code>## Warning in b + x: Recycling array of length 1 in array-vector arithmetic is deprecated.
##   Use c() or as.vector() instead.</code></pre>
<pre class="r"><code>curve(ricker(x,a=jags.rick$BUGSoutput$mean$a,b=jags.rick$BUGSoutput$mean$b), add=TRUE, col=&quot;red&quot;)</code></pre>
<pre><code>## Warning in a * x: Recycling array of length 1 in array-vector arithmetic is deprecated.
##   Use c() or as.vector() instead.</code></pre>
<pre><code>## Warning in -b * x: Recycling array of length 1 in array-vector arithmetic is deprecated.
##   Use c() or as.vector() instead.</code></pre>
<pre class="r"><code>legend(&quot;bottomright&quot;,legend=c(&quot;Ricker&quot;,&quot;Michaelis-Menten&quot;), col=c(&quot;red&quot;,&quot;blue&quot;), lty=1)</code></pre>
<p><img src="Heffelfinger_HW4_files/figure-html/unnamed-chunk-11-1.png" width="672" /> The M-M model looks like a better fit than the Ricker model. this can be specifically seen at the upper end of days since infection. The hypothesis that the titre levels off asymptotically appears seems be true.</p>
<p>Convergence assesment</p>
<pre class="r"><code>print(gelman.diag(jagsmm.mcmc), digits = 4) </code></pre>
<pre><code>## Potential scale reduction factors:
## 
##          Point est. Upper C.I.
## a            1.0029      1.010
## b            1.0025      1.008
## deviance     1.0025      1.005
## shape        0.9998      1.000
## 
## Multivariate psrf
## 
## 1.003</code></pre>
<p>The Gelman-Ruben diagnostic is less than 1.1. The chains look decent with maybe a little autocorrelation. there doesn’t seem to be chain divergence and it appears the this model has converged.</p>
<div id="question-3" class="section level3">
<h3>Question 3</h3>
<p>Goodness-of-fit and model comparision</p>
<pre class="r"><code>jags.rick$BUGSoutput$DIC</code></pre>
<pre><code>## [1] 66.2103</code></pre>
<pre class="r"><code>jags.mm$BUGSoutput$DIC</code></pre>
<pre><code>## [1] 59.6746</code></pre>
<p>The M-M model has a lower DIC (by about 6), so it is the better model by this metric. This amount of difference indicates that the M-M model is better, but the Ricker model isn’t too shabby either.</p>
</div>
<div id="pseudocode-for-gof" class="section level3">
<h3>Pseudocode for GOF</h3>
<div id="step-1" class="section level4">
<h4>Step 1</h4>
<p>Generate some data based on the parameters drawn from posterior and look at squared residuals</p>
<pre class="r"><code>#create storage vectors
reps&lt;- 1000
new.titer.data&lt;- array(Myx$day, dim=c(length(Myx$day),reps+1))
exp_vals&lt;- array(Myx$day, dim=c(length(Myx$day),reps+1))
SSE_sims&lt;- array(NA, dim=c(reps,1))
SSE_obs&lt;- array(NA, dim=c(reps,1))
obs_titer&lt;- array(Myx$titer,dim=c(length(Myx$day),reps+1))
day&lt;- Myx$day</code></pre>
<p>Run in loop to create mulitple datasets</p>
<pre class="r"><code>#loop to get values
  for(i in 1:reps){ #loop to create 1000 sets of new parameters drawn from the posterior of the model
  n.sims &lt;- jags.rick$BUGSoutput$n.sims
  r_index &lt;- sample(n.sims, 1, replace = T) #gets random number from within posteriors
  new.a &lt;- jags.rick$BUGSoutput$sims.list$a[r_index]
  new.b &lt;- jags.rick$BUGSoutput$sims.list$b[r_index]
  new.shape &lt;- jags.rick$BUGSoutput$sims.list$shape[r_index]
  new_data&lt;- rgamma(length(day), rate=new.shape/ricker(day, new.a, new.b), shape= new.shape) #generates dataset based on selected new parameters
  new.titer.data[,i+1] &lt;-new_data
  exp_vals[,i+1]&lt;- ricker(day, new.a, new.b) #generate expected values with those new parameters
  SSE.sim&lt;- sum((new.titer.data[,i+1] - exp_vals[,i+1])^2) #gets the sum of squared errors for simulated data
  SSE.obs&lt;- sum((obs_titer[,i+1] - exp_vals[,i+1])^2)      # gets the sum of squared errors for observed data
  SSE_sims[i]&lt;- SSE.sim
  SSE_obs[i]&lt;-SSE.obs
  }</code></pre>
</div>
<div id="step-2" class="section level4">
<h4>Step 2</h4>
<p>Boxplot</p>
<pre class="r"><code>#restructure days data for boxplot
rownames(new.titer.data)&lt;-Myx$day 
days_ordered&lt;-sort(unique(Myx$day))
row_ind&lt;- match(days_ordered, Myx$day) #pulls first match for each day

#create boxplot with observed data overlay
boxplot(lapply(row_ind, function(i) new.titer.data[i+1,]), ylim=c(0,12), xaxt=&quot;n&quot;,xlab=&quot;Day since infection&quot;, ylab=&quot;Virus titer&quot;) 
axis(1, at=c(1:8), labels = c(2:9))
points(Myx$day-1,Myx$titer, col=&quot;blue&quot;, pch=20, cex=1.5)</code></pre>
<p><img src="Heffelfinger_HW4_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<p>Boxplot shows decent fit. All observed data fall within whiskers of plot</p>
</div>
<div id="step-3" class="section level4">
<h4>Step 3</h4>
<p>Plot residuals. Observed vs. Fitted</p>
<pre class="r"><code>plot(SSE_sims~SSE_obs, xlab=&quot;SSE observed data&quot;, ylab = &quot;SSE Simulated data&quot;)
abline(1,1)</code></pre>
<p><img src="Heffelfinger_HW4_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<p>simulated and observed residuals do not outrank each other substantially</p>
</div>
<div id="step-4" class="section level4">
<h4>Step 4</h4>
<p>Bayesian P-Value</p>
<pre class="r"><code>#number of times the simulated data errors are greater than the observed data errors over number of replicates
SSE_all&lt;-matrix(c(SSE_sims,SSE_obs),nrow = reps, ncol = 2)
Bayesian_p&lt;-length(which(SSE_all[,1]&gt;SSE_all[,2]))/reps
Bayesian_p</code></pre>
<pre><code>## [1] 0.738</code></pre>
<p>The Bayesian P value around 0.75 indicated a decent model fit. A perfect fit (the observed data was generated by the exact process we have modeled) would be 0.5. Values near 0 or 1 are bad. Used to compare relatively to other models</p>
</div>
</div>
</div>
<div id="question-5" class="section level2">
<h2>Question 5</h2>
<p>Model(s) could be created to evalaute the trend as the days since infection increases using data for less virulent grades to allow us to have longer living organisms. Then fit the new function to grade 1 data to predict future results of the virus keeping in mind that we are using a less virulent grade. Future population prediction could be reasonabily made using this method.</p>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
