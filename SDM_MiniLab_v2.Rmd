---
title: "Ensemble Mini Lab"
author: "CIM & LTP"
date: "11/1/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Note: You will need to run the other script in full before starting this one. 



## MINILAB TASK

#### Re-run the models after dropping 1-3 "un-important" environmental variables. Please include all modified code below. 

```{r}


```


#### A popular approach to SDMs is to create an averaged model based on multiple algorithms that performed well. You may need to change some code below once you re-run your model with the reduced set of environmental variables. 

```{r}
system.time (myBiomodEM <- BIOMOD_EnsembleModeling(
  modeling.output = myBiomodModelOut,
 chosen.models = c('Chuckwalla_AllData_RUN5_GBM','Chuckwalla_AllData_RUN5_RF'),
  em.by='all', # outputting 1 emsemble model, evaluated on the the eval data
  eval.metric = c('TSS'), 
  eval.metric.quality.threshold = c(0.6), 
  prob.mean = T, 
  prob.cv = F, #calulate cv
  prob.ci = F, #calculate ci
  prob.ci.alpha = 0.05,
  prob.median = T,
  committee.averaging = F,
  prob.mean.weight = T, 
  prob.mean.weight.decay = 'proportional', #weighting by model performance
  VarImport = 10)    
)
myBiomodEM


get_built_models(myBiomodEM)

### Get rasters out

myBiomodEM.FC  <- BIOMOD_EnsembleForecasting( 
                        projection.output = myBiomodProj,
                        EM.output = myBiomodEM)

plot(myBiomodEM.FC)
myBiomodEM.FC
myBiomodEM.FC.rasters <- get_predictions(myBiomodEM.FC)

# rescale to 0/1 scale 
myBiomodEM.FC.1 <- myBiomodEM.FC.rasters/1000


plot(myBiomodEM.FC.1)
plot(myBiomodEM.FC.1[['Chuckwalla_EMmedianByTSS_mergedAlgo_mergedRun_mergedData']])

```

#### MINILAB TASK

##### Get the evaluations and variable importance out of your ensemble model. How does the performance of your ensemble model compare to your individual RF and GBM models? Did any metrics improve? 

```{r}


```





