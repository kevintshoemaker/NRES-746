<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="NRES 746" />

<meta name="date" content="2016-09-10" />

<title>The Virtual Ecologist</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cerulean.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<link rel="stylesheet"
      href="site_libs/highlight/default.css"
      type="text/css" />
<script src="site_libs/highlight/highlight.js"></script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}

.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.9em;
  padding-left: 5px;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">NRES 746</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Schedule
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="schedule.html">Course Schedule</a>
    </li>
    <li>
      <a href="labschedule.html">Lab Schedule</a>
    </li>
    <li>
      <a href="Syllabus.pdf">Syllabus</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Lectures
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="INTRO.html">Introduction to NRES 746</a>
    </li>
    <li>
      <a href="LECTURE1.html">Why focus on algorithms?</a>
    </li>
    <li>
      <a href="LECTURE2.html">Working with probabilities</a>
    </li>
    <li>
      <a href="LECTURE3.html">The Virtual Ecologist</a>
    </li>
    <li>
      <a href="LECTURE4.html">Likelihood</a>
    </li>
    <li>
      <a href="LECTURE5.html">Optimization</a>
    </li>
    <li>
      <a href="LECTURE6.html">Bayesian #1: concepts</a>
    </li>
    <li>
      <a href="LECTURE7.html">Bayesian #2: mcmc</a>
    </li>
    <li>
      <a href="LECTURE8.html">Model Selection</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Lab exercises
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="LAB1.html">Lab 1: Algorithms in R</a>
    </li>
    <li>
      <a href="LAB2.html">Lab 2: Virtual ecologist</a>
    </li>
    <li>
      <a href="LAB3.html">Lab 3: Likelihood and optimization</a>
    </li>
    <li>
      <a href="LAB4.html">Lab 4: Bayesian inference</a>
    </li>
    <li>
      <a href="LAB5.html">Lab 5: Model selection</a>
    </li>
    <li>
      <a href="Time Series Lab.html">Time-series mini-lab</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Data sets
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="TreeData.csv">Tree Data</a>
    </li>
    <li>
      <a href="ReedfrogPred.csv">Reed Frog Predation Data</a>
    </li>
    <li>
      <a href="ReedfrogFuncresp.csv">Reed Frog Func Resp</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Student-led topics
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="forWebsite_SEM.html">SEMs</a>
    </li>
    <li>
      <a href="GAMs.html">GAMs</a>
    </li>
    <li>
      <a href="RMarkdown_FigureDemo.html">Publication-quality figures in R</a>
    </li>
    <li>
      <a href="Bayesian Networks.pptx">Bayesian Networks</a>
    </li>
    <li>
      <a href="GraphTheory.html">Graph Theory</a>
    </li>
    <li>
      <a href="NRES746_IPMs.pptx">Integrated Population Models</a>
    </li>
    <li>
      <a href="TimeSeries_heckler.html">Time Series Analysis</a>
    </li>
  </ul>
</li>
<li>
  <a href="Links.html">Links</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">The Virtual Ecologist</h1>
<h4 class="author"><em>NRES 746</em></h4>
<h4 class="date"><em>September 10, 2016</em></h4>

</div>


<p>NOTE: some of this demo borrows from Hadley wickham’s presentation: <a href="http://had.co.nz/stat480/lectures/15-simulation.pdf">Simuation</a></p>
<div id="why-simulate-fake-data" class="section level2">
<h2>Why simulate ‘fake data’?</h2>
<ul>
<li>Formalize your understanding of the data generating process</li>
<li>Formalize your understanding of how sampling methods and uncertainty potentially affect information recovery
<ul>
<li>Power Analysis!</li>
<li>Sampling design!</li>
</ul></li>
<li>Test whether model fitting algorithms and statistical tests do what you think they should (e.g., estimate parameters correctly)! (test for bias, precision, etc.)</li>
<li><del>Severe violations of academic integrity</del></li>
</ul>
<p>We have simulated data in class already!</p>
</div>
<div id="random-numbers-from-known-distribution" class="section level2">
<h2>Random numbers (from known distribution)</h2>
<pre class="r"><code>runif(1,0,25)   # simulate arbitrary # of samples from dist with arbitrary params
rpois(1,3.4)
rnorm(1,22,5.4)</code></pre>
<p>First argument: n, number of samples to generate</p>
<p>Subsequent arguments: parameters of the distribution</p>
<ul>
<li>Always check that the distribution is parameterised the way you expect!</li>
</ul>
<div id="short-exercise-1" class="section level4">
<h4>Short exercise #1:</h4>
<ul>
<li>Generate 50 samples from <span class="math inline">\(N(10,5)\)</span></li>
<li>Generate 1000 numbers from <span class="math inline">\(Poisson(50)\)</span></li>
<li>Generate 10 numbers from <span class="math inline">\(Beta(0.1,0.1)\)</span></li>
</ul>
</div>
</div>
<div id="the-model" class="section level2">
<h2>The model</h2>
<p>For our purposes, the model is the data-generating process.</p>
<p>The model could be as simple as the random numbers you were just generating. That is we might assume that the sample data were generated from a Poisson process with mean equal to the sample mean.</p>
<p>In general, the models we will consider are composed of <strong>deterministic</strong> and <strong>stochastic</strong> components.</p>
<p>For example, ordinary linear regression consists of a determistic component (<span class="math inline">\(y = ax + b\)</span>) and a stochastic component (residuals are normally distributed).</p>
<div id="decomposing-ordinary-linear-regression" class="section level3">
<h3>decomposing ordinary linear regression:</h3>
<p>First, let’s look at the <strong>deterministic component</strong>:</p>
<pre class="r"><code>xvals = seq(0,100,10)  # simulated x values define parameter space

deterministic_component &lt;- function(x,a,b){
  linear &lt;- a + b*x   # linear functional form
  return(linear)
}

expected_vals &lt;- deterministic_component(xvals,175,-1.5)
expected_vals</code></pre>
<pre><code>##  [1] 175 160 145 130 115 100  85  70  55  40  25</code></pre>
<pre class="r"><code>plot(xvals,expected_vals)</code></pre>
<p><img src="LECTURE3_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<p>Now, let’s look at the <strong>stochastic component</strong>:</p>
<pre class="r"><code>stochastic_component &lt;- function(x,variance){
  sd &lt;- sqrt(variance)
  stochvals &lt;- rnorm(length(x),x,sd)
  return(stochvals)
}

sim_vals &lt;- stochastic_component(expected_vals,variance=500)

plot(xvals,sim_vals)</code></pre>
<p><img src="LECTURE3_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<pre class="r"><code># ALTERNATIVELY:

sim_vals &lt;- stochastic_component(deterministic_component(xvals,175,-1.5),500)    # stochastic &quot;shell&quot;</code></pre>
<p>You can think of the deterministic component as the <strong>“signal”</strong> and the stochastic component as the <strong>“noise”</strong>. Most data-generating processes that we will consider have both!</p>
<hr />
</div>
</div>
<div id="replication" class="section level2">
<h2>Replication!!</h2>
<p>Wherever there is randomness, we can get different results every time (that’s what it means to be random!). In such cases, a single output of the data generating model by itself has no great meaning. However, we can extract a good deal of meaning if we run lots of replicates <em>The distribution (‘cloud’) of replicates becomes the real result!</em></p>
<div id="goodness-of-fit-can-this-model-plausibly-generate-the-observed-data" class="section level3">
<h3>Goodness-of-fit (can this model plausibly generate the observed data?)</h3>
<p>For example, let’s run a goodness-of-fit test. Here are our real data:</p>
<pre class="r"><code>realdata &lt;- c(125,50,90,110,80,75,100,400,350,290,350)
plot(xvals,realdata)</code></pre>
<p><img src="LECTURE3_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p>Is this linear regression model (a=10,b=4,var=1000) a good fit to the data?</p>
<pre class="r"><code> #### initialize:
reps &lt;- 1000    # number of replicate datasets to generate
samplesize &lt;- length(xvals)
results &lt;- array(0,dim=c(samplesize,reps))   # storage array for results
for(i in 1:reps){
  exp_vals &lt;- deterministic_component(xvals,a=10,b=4)
  sim_vals &lt;- stochastic_component(exp_vals,1000)  # stochastic wrapper!
  results[,i] &lt;- sim_vals
}

    # now make a boxplot of the results
boxplot(lapply(1:nrow(results), function(i) results[i,])) </code></pre>
<p><img src="LECTURE3_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p>Now let’s overlay the real data.</p>
<pre class="r"><code>boxplot(lapply(1:nrow(results), function(i) results[i,]),xaxt=&quot;n&quot;)
axis(1,at=c(1:length(xvals)),labels=xvals)
points(c(1:length(xvals)),realdata,pch=20,cex=3,col=&quot;red&quot;,xaxt=&quot;n&quot;)</code></pre>
<p><img src="LECTURE3_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>How well does this model fit the data? Is this particular model likely to produce these data? (we will revisit this concept more quantitatively when we get to likelihood-based model fitting!)</p>
</div>
<div id="generating-sampling-distributions-i.e.-the-distribution-of-test-statistcs-for-many-many-independent-samples" class="section level3">
<h3>Generating <em>sampling distributions</em> (i.e., the distribution of test statistcs for many many independent samples)</h3>
<p>For example, the ‘brute force’ t-test from the first lecture:</p>
<pre class="r"><code>reps &lt;- 1000                    # number of replicate samples to generate
null_difs &lt;- numeric(reps)              # storage vector for the test statistic for each sample

for(i in 1:reps){
  sampleA &lt;- sample(popData_null,size=sample.size)        # sample representing &quot;groups&quot; A and B under the null hypothesis
  sampleB &lt;- sample(popData_null,size=sample.size)
  null_difs[i] &lt;- mean(sampleA)-mean(sampleB)         # test statistic (model result)
}

hist(null_difs)           # plot out the sampling distribution
abline(v=observed_dif,col=&quot;green&quot;,lwd=3)</code></pre>
<p><strong>NOTE</strong>: Frequentist statistical tests are based on a data sample that is inherently a single replicate from a theoretically infinite number of possibilites. However, the interpretation of the results is implicitly based on the idea of replication (“if the null hypothesis were true, and the experiment were <em>replicated</em> lots and lots of times, results as or more extreme as the observed results could be expected from x% of replicates”)</p>
</div>
<div id="power-analysis-can-my-sampling-design-detect-the-signal" class="section level3">
<h3>Power analysis!! (can my sampling design detect the “signal”?)</h3>
<p>When designing experiments or field monitoring protocols, we often ask questions like:</p>
<ul>
<li>What sample size do I need to be able to address my research questions?</li>
<li>What is the smallest effect size I can reliably detect with my sampling design?</li>
<li>What sources of sampling or measurement error should I make the greatest effort to minimize?</li>
</ul>
<p>In such cases, probably the most straightforward way to address these questions is to simulate data under various sampling strategies and error structures, and see how well we can recover the “true” signal through the noise!</p>
</div>
<div id="power-analysis-example" class="section level3">
<h3>Power analysis, example</h3>
<p>Imagine we are designing a monitoring program for a population of an at-risk species, and we want to have at least a 75% chance of detecting a decline of 25% or more over a 10 year period. Let’s assume that we are using visual counts, and that the probability of encountering each organism visually is 2% per person-day. The most recent population estimate was 1000.</p>
<p>What we know:</p>
<ul>
<li>A single person has a 2% chance of detecting each animal in the population in a day of surveying</li>
<li>The initial abundance is 1000</li>
<li>We need to detect a decline as small as 25% over 10 years with at least 75% probability.</li>
</ul>
<p>First, let’s set the groundwork by making some helper functions (break the problem into smaller chunks):</p>
<p>This function takes the true number in the population and returns the observed number:</p>
<pre class="r"><code>NumObserved &lt;- function(TrueN=1000,surveyors=1,days=3){
  probPerPersonDay &lt;- 0.02
  probPerDay &lt;- 1-(1-probPerPersonDay)^surveyors
  probPerSurvey &lt;- 1-(1-probPerDay)^days
  nobs &lt;- rbinom(1,size=TrueN,prob=probPerSurvey)
  return(nobs)
}
NumObserved(TrueN=500,surveyors=2,days=7)</code></pre>
<pre><code>## [1] 132</code></pre>
<p>This function gives us the current-year abundance using last years abundance and trend information</p>
<pre class="r"><code>ThisYearAbund &lt;- function(LastYearAbund=1000,trend=-0.03){
  CurAbund &lt;- LastYearAbund + trend*LastYearAbund
  CurAbund &lt;- floor(CurAbund)  # can&#39;t have fractional individuals!
  return(CurAbund)
}
ThisYearAbund(LastYearAbund=500,trend=-0.03)</code></pre>
<pre><code>## [1] 485</code></pre>
<p>This function will simulate a single dataset (time series of observations over a given number of years)!</p>
<pre class="r"><code>SimulateMonitoringData &lt;- function(initabund=1000,trend=-0.03,years=25,observers=1,days=3,survint=2){
  prevabund &lt;- initabund
  detected &lt;- numeric(years)     # set up storate variable
  for(y in 1:years){
    thisAbund &lt;- ThisYearAbund(prevabund,trend)             # compute the current abundance on the basis of the trend
    detected[y] &lt;- NumObserved(thisAbund,observers,days)     # sample the current population using this monitoring scheme
    prevabund &lt;- thisAbund   # this years abundance becomes the previous years abundance
  }
  surveyed &lt;- c(1:years)%%survint==0    # which years were surveys actually performed?
  detected[!surveyed] &lt;- NA
  return(detected)
}

SimulateMonitoringData(initabund=1000,trend=-0.03,years=25,observers=1,days=3,survint=2)</code></pre>
<pre><code>##  [1] NA 45 NA 60 NA 43 NA 31 NA 49 NA 35 NA 34 NA 38 NA 38 NA 32 NA 31 NA
## [24] 26 NA</code></pre>
<p>Now we can develop a function for determining if a decline was in fact detected by the method:</p>
<pre class="r"><code>IsDecline &lt;- function(monitoringData,alpha=0.05){
  time &lt;- 1:length(monitoringData)
  model &lt;- lm(monitoringData~time)    # for now, let&#39;s use ordinary linear regression
  p_value &lt;- summary(model)$coefficients[&quot;time&quot;,&quot;Pr(&gt;|t|)&quot;]
  isdecline &lt;- ifelse(summary(model)$coefficients[&quot;time&quot;,&quot;Estimate&quot;]&lt;0,TRUE,FALSE)
  sig_decline &lt;- ifelse((p_value&lt;=alpha)&amp;(isdecline),TRUE,FALSE)    # if declining and significant trend
  return(sig_decline)
}

IsDecline(monitoringData=c(10,20,NA,15,1),alpha=0.05)</code></pre>
<pre><code>## [1] FALSE</code></pre>
<p>Now we can develop a “power” function that gives us the statistical power for given monitoring scenarios…</p>
<p>This is part of this week’s lab assignment!</p>
<pre class="r"><code>nreps &lt;- 10000
initabund &lt;- 1000
GetPower &lt;- function(observers=1,days=3,alpha=0.05,years=25,survint=2){
     # fill this in!
  return(Power)
}</code></pre>
<pre><code>## The statistical power to detect a decline for the default parameters is: 0.383</code></pre>
<p>And we can evaluate what types of monitoring programs might be acceptable:</p>
<p><img src="LECTURE3_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
