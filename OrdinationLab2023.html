<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Kierstin Acuna &amp; Martin Genova" />

<meta name="date" content="2023-12-04" />

<title>Ordination Lab</title>

<script src="site_libs/header-attrs-2.24/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cerulean.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">NRES 746</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Schedule
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="schedule.html">Course Schedule</a>
    </li>
    <li>
      <a href="Syllabus.pdf">Syllabus</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Lectures
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="INTRO.html">Introduction to NRES 746</a>
    </li>
    <li>
      <a href="LECTURE1.html">Why focus on algorithms?</a>
    </li>
    <li>
      <a href="LECTURE2.html">Working with probabilities</a>
    </li>
    <li>
      <a href="LECTURE3.html">The Virtual Ecologist</a>
    </li>
    <li>
      <a href="LECTURE4.html">Likelihood</a>
    </li>
    <li>
      <a href="LECTURE5.html">Optimization</a>
    </li>
    <li>
      <a href="LECTURE6.html">Bayesian #1: concepts</a>
    </li>
    <li>
      <a href="LECTURE7.html">Bayesian #2: mcmc</a>
    </li>
    <li>
      <a href="LECTURE8.html">Model Selection</a>
    </li>
    <li>
      <a href="LECTURE9.html">Performance Evaluation</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Lab exercises
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="LAB_Instructions.html">Instructions for Labs</a>
    </li>
    <li>
      <a href="LAB3demo.html">Lab 3: Likelihood (intro)</a>
    </li>
    <li>
      <a href="LAB5.html">Lab 5: Model selection (optional)</a>
    </li>
    <li>
      <a href="FigureDemo.html">Demo: Figures in R</a>
    </li>
    <li>
      <a href="GIT_tutorial.html">Demo: version control in Git</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Student led topics
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="GLMM.html">GLMMs</a>
    </li>
    <li>
      <a href="GLMM_Lab.html">GLMMs (lab)</a>
    </li>
    <li>
      <a href="GAMs_Lab.html">GAMs (lab)</a>
    </li>
    <li>
      <a href="Rastering.html">RSFs (raster demo)</a>
    </li>
    <li>
      <a href="RSF_Lab.html">RSFs (lab)</a>
    </li>
    <li>
      <a href="rf2023.html">Random Forest (demo)</a>
    </li>
    <li>
      <a href="rfregression.html">Random Forest (lab)</a>
    </li>
    <li>
      <a href="SpatialRegression.html">Spatial Regression (demo and lab)</a>
    </li>
    <li>
      <a href="Ordination2023.html">Ordination</a>
    </li>
    <li>
      <a href="OrdinationLab2023.html">Ordination (lab)</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Data sets
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="TreeData.csv">Tree Data</a>
    </li>
    <li>
      <a href="ReedfrogPred.csv">Reed Frog Predation Data</a>
    </li>
    <li>
      <a href="ReedfrogFuncresp.csv">Reed Frog Func Resp</a>
    </li>
  </ul>
</li>
<li>
  <a href="Links.html">Links</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Ordination Lab</h1>
<h4 class="author">Kierstin Acuna &amp; Martin Genova</h4>
<h4 class="date">2023-12-04</h4>

</div>


<p>You can load up the lab script <a
href="OrdinationLab2023_script.R">here</a></p>
<div id="lecture-review" class="section level2">
<h2>Lecture Review</h2>
<p>In last week’s lecture, we covered the basics of ordination. We
reviewed a bit of matrix algebra, learned to compute the most common
distance metrics (Euclidean and Bray-Curtis), and covered unconstrained
and constrained ordination techniques.</p>
<p>As a reminder, unconstrained ordination methods do not require any
prior knowledge or assumptions about the data, and they are primarily
used for visualization. These methods include PCA, PCoA, CA, and
NMDS.</p>
<p>In contrast, constrained ordination methods do require prior
knowledge and/or assumptions about the data. Constrained ordination
methods combine concepts from ordination and regression to test
hypotheses. These methods include RDA and CCA.</p>
<p>What do we mean by prior knowledge or assumptions about the data?
Typically in constrained ordination, we are trying to identify the
relationships between a matrix of response variables and a matrix of
predictor variables. We partition the variation within the response
variables into two parts: the part that <em>can</em> be explained by
predictor variables, and the part that <em>cannot</em> be explained by
predictor variables. The variation from the response variables that
<em>can</em> be explained by the predictor variables is used to create
our <em>constrained ordination axes</em>. These axes are
<em>constrained</em> by the response variables.</p>
<!-- MG Note: I think there should be an example of an interpretation of an RDA plot from a paper to set up the last question about how to interpret an RDA plot. I don't know how to interpret an RDA plot compared to a PCA, PCoA, or CA plot (and I don't cover that in the lecture) so having an example would be a good way to help them interpret the plot they make in the last question -->
</div>
<div id="rda-review" class="section level2">
<h2>RDA Review</h2>
<p>The basic steps of redundancy analysis (RDA) are:</p>
<ol style="list-style-type: decimal">
<li>Regress each response variable in y over the predictor variables in
x<br />
<img src="images/Lab_1.png" /></li>
<li>Perform a PCA on the model predictions<br />
<img src="images/Lab_2.png" /></li>
</ol>
<p>Of course, the actual RDA function from the vegan package is a bit
more sophisticated than this. It involves <a
href="https://en.wikipedia.org/wiki/QR_decomposition">QR
decomposition</a> and some complex matrix algebra. But, today we will
focus on using RDA, rather than getting into the weeds with matrix
math.</p>
<div id="doubs-fish-data" class="section level3">
<h3>Doubs Fish Data</h3>
<p>For this example, we will be using the Doubs fish data (Verneaux,
1973). It contains 3 datasets. Doubs.fish is a dataset containing counts
of 27 species observed across 30 sites in the Doubs river in France.
Doubs.env and Doubs.geo are datasets containing attributes on each site,
such as longitude and latitude, slope, pH, and dissolved oxygen
concentration.</p>
<pre class="r"><code># Load libraries ----
library(codep)</code></pre>
<pre><code>## Warning: package &#39;codep&#39; was built under R version 4.3.2</code></pre>
<pre class="r"><code>library(vegan)

# Load Doubs fish Data ----
data(Doubs)
species &lt;- as.data.frame(Doubs.fish[-8,])
vars &lt;- as.data.frame(cbind(Doubs.env[-8,],Doubs.geo[-8,]))</code></pre>
<p>Let’s take a closer look at the data, starting with the distribution
of abundance values we find.</p>
<pre class="r"><code>## Explore the data ----
# Count the number of species frequencies in each abundance class
ab &lt;- table(unlist(species))
# Plot distribution of species frequencies
barplot(ab, xlab = &quot;Abundance class&quot;, ylab = &quot;Frequency&quot;, col = grey(5:0/5))</code></pre>
<p><img src="OrdinationLab2023_files/figure-html/Exploring%20the%20data-1.png" width="672" /></p>
<p>That’s a lot of zeros!</p>
<p>We can also look at the spread of our predictor variables. The help
page for the Doubs data gives explanations of what the variables
mean.</p>
<pre class="r"><code># Look at the spread of the predictor variables
# ?Doubs
summary(vars)</code></pre>
<pre><code>##       slo              flo              pH             har        
##  Min.   : 0.200   Min.   : 0.84   Min.   :7.700   Min.   : 40.00  
##  1st Qu.: 0.500   1st Qu.: 4.80   1st Qu.:7.900   1st Qu.: 84.00  
##  Median : 1.200   Median :23.00   Median :8.000   Median : 88.00  
##  Mean   : 3.531   Mean   :22.92   Mean   :8.048   Mean   : 85.83  
##  3rd Qu.: 3.000   3rd Qu.:28.80   3rd Qu.:8.100   3rd Qu.: 97.00  
##  Max.   :48.000   Max.   :69.00   Max.   :8.600   Max.   :110.00  
##       pho            nit             amm              oxy        
##  Min.   :0.01   Min.   :0.150   Min.   :0.0000   Min.   : 4.100  
##  1st Qu.:0.10   1st Qu.:0.520   1st Qu.:0.0000   1st Qu.: 8.100  
##  Median :0.30   Median :1.600   Median :0.1000   Median :10.200  
##  Mean   :0.57   Mean   :1.697   Mean   :0.2124   Mean   : 9.472  
##  3rd Qu.:0.58   3rd Qu.:2.500   3rd Qu.:0.2000   3rd Qu.:11.000  
##  Max.   :4.22   Max.   :6.200   Max.   :1.8000   Max.   :12.400  
##       bdo              Lon             Lat             DFS       
##  Min.   : 1.300   Min.   :5.083   Min.   :46.71   Min.   :  0.3  
##  1st Qu.: 2.700   1st Qu.:6.124   1st Qu.:46.90   1st Qu.: 70.5  
##  Median : 4.100   Median :6.338   Median :47.20   Median :185.9  
##  Mean   : 5.014   Mean   :6.359   Mean   :47.13   Mean   :193.0  
##  3rd Qu.: 5.200   3rd Qu.:6.791   3rd Qu.:47.33   3rd Qu.:304.3  
##  Max.   :16.700   Max.   :7.168   Max.   :47.48   Max.   :453.0  
##       Alt       
##  Min.   :172.0  
##  1st Qu.:246.0  
##  Median :375.0  
##  Mean   :470.9  
##  3rd Qu.:752.0  
##  Max.   :934.0</code></pre>
<p><img src="images/Lab_3.png" /></p>
<p>The predictor variables are all in different units, and are on very
different scales!</p>
</div>
</div>
<div id="exercise-1" class="section level2">
<h2>Exercise 1</h2>
<p>Before we can perform an RDA, we need to center and scale the
predictor variables, as well as account for the double-zero problem. In
the previous lecture, we talked about how we can use different distance
metrics, such as the Bray-Curtis dissimilarity to account for the
double-zero problem. Since we are using the canned RDA function, we
don’t have the option to use the Bray-Curtis dissimilarity. The RDA
function uses the euclidean distance metric. Therefore, we need to fix
the double-zero problem before we feed the data into the RDA
function.</p>
<p>We can use the hellinger-transformation to account for the
double-zero problem. The hellinger transformation takes raw abundance
values, and transforms them into the square root of the relative
abundance. The formula for the hellinger transformation is:<br />
<img src="images/Lab_4.png" /></p>
<p>where <em>j</em> represents species and <em>i</em> represents sites
(<em>y<sub>ij</sub></em> represents species <em>j</em> in site
<em>i</em>). <em>y<sub>i<strong>.</strong></sub></em> represents the
summed abundance of all species in site <em>i</em>.</p>
<p>Write a function called RDA_prep() that uses the hellinger
transformation and the scale function to prepare the data for RDA. This
function should be specified as follows:</p>
<p><strong>Input:</strong></p>
<ul>
<li>x = a dataframe containing the predictor variables<br />
</li>
<li>y = a dataframe containing the response variables</li>
</ul>
<p><strong>Suggested Algorithm:</strong></p>
<ol style="list-style-type: decimal">
<li>Using the hellinger formula and a for loop, hellinger-transform the
y dataframe. (Hint: convert y to a matrix first).<br />
</li>
<li>Use the scale function to center and scale the x dataframe</li>
</ol>
<p><strong>Return:</strong></p>
<ul>
<li>out = a list containing x (the centered and scaled x dataframe) and
y (the hellinger-transformed y dataframe)</li>
</ul>
<p>You can use the following code to check your answer:</p>
<pre class="r"><code>decostand(species, &quot;hellinger&quot;)</code></pre>
<p>After you’ve made your function, use it to prepare the Doubs fish
data for RDA!</p>
</div>
<div id="exercise-2" class="section level2">
<h2>Exercise 2</h2>
<p>Now that our data is ready, let’s practice using RDA for variable
selection! In real life when we are creating models for inference, we
should always select variables based on ecological reasoning. But since
none of us work on fish in the Doubs river, and we’re just trying to get
some practice using these functions, we’re just going to throw all the
data we have at this model!</p>
<p>The ordiR2step() function from the vegan package can help us with
variable selection. The concept is similar to the <a
href="https://www.rdocumentation.org/packages/MuMIn/versions/1.47.5/topics/dredge">MuMIn::dredge()
function</a>. Essentially, it takes a null model and a global model, and
then adds predictor variables from the global model to the null model
stepwise. If a predictor variable increases the adjusted-R<sup>2</sup>
value, it keeps it. This works because the adjusted-R<sup>2</sup> value
calculation contains a penalty for the number of parameters fit, meaning
that adding more parameters does not always increase the
adjusted-R<sup>2</sup>.</p>
<p>The two main arguments we need to specify for the ordiR2step()
function are object and scope. Object is the null model we want to add
to, and scope is the fully specified model we want to pull predictor
variables from.</p>
<p>For this exercise, use the rda() function to create null and global
models. Then, use the ordiR2step function to choose the best predictor
variables. In your word document, answer the following questions:</p>
<ul>
<li>What variables did ordiR2step select?<br />
</li>
<li>Can you think of a scenario where it would be appropriate to use
ordiR2step (or dredge) for variable selection?</li>
</ul>
</div>
<div id="exercise-3" class="section level2">
<h2>Exercise 3</h2>
<p>So far, we’ve scaled and transformed our data, and used a variable
selection tool to narrow down our predictor variables. Say we want to
test the hypothesis that our selected predictor variables are impacting
the fish community in the Doubs river. There are functions that allow us
to obtain R<sup>2</sup> and p-values from an RDA!</p>
<p>The RsquareAdj() function extracts the percent of the variation in
the response matrix (Doubs fish community) explained by the predictor
matrix (environmental variables). This is also called the
<em>constrained variance</em>. Then, it adjusts the constrained variance
for the number of predictor variables used in the model to obtain the
adjusted-R<sup>2</sup> value.</p>
<p>The anova.cca() function allows us to test the significance of the
predictor variables used in our RDA by implementing an ANOVA-like
permutation test. Essentially, if the argument ‘by = “terms”’ is
specified, the function will sequentially assess if adding each
predictor variable makes a significant difference in the amount of
variation explained compared to a null model. It’s important to note
that the order of terms will affect their significance, as they are
assessed sequentially from first to last.</p>
<p>In this last exercise, we will run an RDA on our selected variables,
plot the output, and assess its R<sup>2</sup> value and significance.
After completing these tasks, answer the following questions in your
word document:</p>
<ul>
<li>What values did you get for the adjusted-R<sup>2</sup> and
p-values?<br />
</li>
<li>Are there any conclusions you can draw from your RDA plot?</li>
</ul>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
