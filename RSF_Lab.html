<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Chloe Collier-Allen, Sean McCain, Noa Ratia" />


<title>Resource Selection Functions (RSF) in R and JAGS</title>

<script src="site_libs/header-attrs-2.24/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cerulean.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #204a87; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #204a87; font-weight: bold; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #ce5c00; font-weight: bold; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>







<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}

.tocify-subheader {
  display: inline;
}
.tocify-subheader .tocify-item {
  font-size: 0.95em;
}

</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">NRES 746</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Schedule
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="schedule.html">Course Schedule</a>
    </li>
    <li>
      <a href="Syllabus.pdf">Syllabus</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Lectures
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="INTRO.html">Introduction to NRES 746</a>
    </li>
    <li>
      <a href="LECTURE1.html">Why focus on algorithms?</a>
    </li>
    <li>
      <a href="LECTURE2.html">Working with probabilities</a>
    </li>
    <li>
      <a href="LECTURE3.html">The Virtual Ecologist</a>
    </li>
    <li>
      <a href="LECTURE4.html">Likelihood</a>
    </li>
    <li>
      <a href="LECTURE5.html">Optimization</a>
    </li>
    <li>
      <a href="LECTURE6.html">Bayesian #1: concepts</a>
    </li>
    <li>
      <a href="LECTURE7.html">Bayesian #2: mcmc</a>
    </li>
    <li>
      <a href="LECTURE8.html">Model Selection</a>
    </li>
    <li>
      <a href="LECTURE9.html">Performance Evaluation</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Lab exercises
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="LAB_Instructions.html">Instructions for Labs</a>
    </li>
    <li>
      <a href="LAB3demo.html">Lab 3: Likelihood (intro)</a>
    </li>
    <li>
      <a href="LAB5.html">Lab 5: Model selection (optional)</a>
    </li>
    <li>
      <a href="FigureDemo.html">Demo: Figures in R</a>
    </li>
    <li>
      <a href="GIT_tutorial.html">Demo: version control in Git</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Student led topics
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="GLMM.html">GLMMs</a>
    </li>
    <li>
      <a href="GLMM_Lab.html">GLMMs (lab)</a>
    </li>
    <li>
      <a href="GAMs_Lab.html">GAMs (lab)</a>
    </li>
    <li>
      <a href="Rastering.html">RSFs (raster demo)</a>
    </li>
    <li>
      <a href="RSF_Lab.html">RSFs (lab)</a>
    </li>
    <li>
      <a href="rf2023.html">Random Forest (demo)</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Data sets
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="TreeData.csv">Tree Data</a>
    </li>
    <li>
      <a href="ReedfrogPred.csv">Reed Frog Predation Data</a>
    </li>
    <li>
      <a href="ReedfrogFuncresp.csv">Reed Frog Func Resp</a>
    </li>
  </ul>
</li>
<li>
  <a href="Links.html">Links</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Resource Selection Functions (RSF) in R and
JAGS</h1>
<h4 class="author">Chloe Collier-Allen, Sean McCain, Noa Ratia</h4>

</div>


<p>For the R code use this <a href="RSF_Lab.R">link</a></p>
<div id="lab-introduction" class="section level2">
<h2>Lab Introduction</h2>
<p>Now that we have covered how resource selection functions (RSFs)
works in theory and how they can be used, let’s try to build a model
based on some real-world data! In this lab, our goal is to create an RSF
for Bighorn sheep in North Dakota, adapting a data set collected by
Sean. You will be given a CSV-file containing the GPS coordinates of
collar-marked sheep, where each row represents a point in time where an
individual was located. By combining this data with covariates (such as
information about vegetation), or adding random slopes and interactions,
we can gain a better understanding how this particular species uses the
landscape, or what type of <em>resources they select for.</em> Be
dangerous! We encourage you to try adding and removing your own
covariates, intercepts, quadratic terms or whatever your heart calls you
to do. We will then towards the the end of the lab attempt to answer
some questions about what the sheep are selecting for in this region,
and discuss what factors seem to be the most relevant in describing
their spatial distribution.</p>
<center>
<div class="float">
<img src="sheep.jpg"
alt="Bighorn sheep. Image source: National Geographic." />
<div class="figcaption">Bighorn sheep. Image source: National
Geographic.</div>
</div>
</center>
<hr />
</div>
<div id="data-preparation" class="section level2">
<h2>Data Preparation</h2>
<p>Let’s begin by loading some packages. You might have to install a few
of these before running the code yourself… If prompted in R, click
“Install dependencies” to have them all installed in one go!</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(ResourceSelection)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="fu">library</span>(terra)</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="fu">library</span>(spdep)</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="fu">library</span>(sp)</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="fu">library</span>(adehabitatHR)</span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a><span class="co">#library(rgdal) # Removed from CRAN in October! Replaced by terra.</span></span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a><span class="fu">library</span>(amt, <span class="at">quietly =</span> T)</span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a><span class="fu">library</span>(raster, <span class="at">quietly =</span> T)</span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a><span class="fu">library</span>(glmmTMB)</span></code></pre></div>
<p>Now, let’s read in the GPS collar data. Download the <a
href="rsf_intro.csv">“rsf_intro.csv”</a> file if you want to tag along,
and put it in your working directory.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>sheeps <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;rsf_intro.csv&quot;</span>)</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="fu">head</span>(sheeps) <span class="co"># What does the first few rows look like?</span></span></code></pre></div>
<pre><code>##    ID Sex JulianDay  Easting Northing
## 1 209   F        91 606774.8  5227353
## 2 334   M        91 610886.3  5262915
## 3 362   F        91 655094.8  5279342
## 4 374   M        91 652392.3  5281385
## 5 375   F        91 650756.4  5275545
## 6 376   F        91 604994.3  5250519</code></pre>
<p>As you can see, the data set has 5 columns:</p>
<ul>
<li>ID: Individual identification number. (How many individuals do you
think we have?)</li>
<li>Sex: Categorical variable (M/F). The sex of each individual.</li>
<li>Julian Day: April 1-June 30, 2020. You’ll notice that the Julian
date is usually much easier to work with in R than the actual
dates!</li>
<li>Easting/Northing: GPS coordinates using the coordinate system NAD83,
UTM Zone 13.</li>
</ul>
<div id="data-distribution" class="section level4">
<h4>Data distribution</h4>
<p>Let’s continue by looking at the data distribution throughout the
spring of 2020.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="fu">ggplot</span>(sheeps, <span class="fu">aes</span>(<span class="at">x =</span> JulianDay)) <span class="sc">+</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">1</span>, <span class="at">fill =</span> <span class="st">&quot;gray&quot;</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>comma, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fu">max</span>(<span class="fu">table</span>(sheeps<span class="sc">$</span>JulianDay)), <span class="at">by =</span> <span class="dv">100000</span>)) <span class="sc">+</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Spring &#39;20 Data Distribution&quot;</span>, <span class="at">x =</span> <span class="st">&quot;April 1-June 30&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Number of Records&quot;</span>) <span class="sc">+</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a>    <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()</span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="RSF_Lab_files/figure-html/distplot-1.png" width="100%" />
Hm, the plot indicates that something something strange is going on. The
GPS collar data should be somewhat evenly distributed throughout the
spring, though there seems to be a lower number of records from the
Julian date ~110-150. We need to keep this uneven sampling in mind when
we create our models…</p>
</div>
<div id="id-as-a-random-effect" class="section level4">
<h4>ID as a random effect</h4>
<p>To do this, We will be using ID as our predictor, so let’s begin by
identify how many individuals we have.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="fu">colnames</span>(sheeps)[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">&#39;ID&#39;</span> <span class="co"># Bug fix, don&#39;t mind</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>n_indivs <span class="ot">&lt;-</span> sheeps <span class="sc">%&gt;%</span> </span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>  <span class="fu">distinct</span>(ID) <span class="sc">%&gt;%</span> </span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>  <span class="fu">n_distinct</span>() </span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>n_indivs <span class="do">## 20 individuals </span></span></code></pre></div>
<pre><code>## [1] 20</code></pre>
<p>OK, in this data set we’re working with 20 unique individuals! Note
that for this project, each collar corresponds to one individual. This
often is <em>NOT</em> the case in collar studies and must be remedied
prior to analysis. Additionally, individuals sometimes wear more than
one collar - both of these scenarios have implications for how we need
to organize the data prior to analysis.</p>
<p>Let’s proceed by identifying the male to female ratio:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="fu">ggplot</span>(sheeps, <span class="fu">aes</span>(<span class="at">x=</span>Sex, <span class="at">fill=</span>Sex))<span class="sc">+</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span> </span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span> <span class="st">&quot;Number of Records for Males vs. Females&quot;</span>, </span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>       <span class="at">x=</span><span class="st">&quot;Sex&quot;</span>, </span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>       <span class="at">y=</span><span class="st">&quot;Number of Records&quot;</span>) <span class="sc">+</span></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="RSF_Lab_files/figure-html/sex_ratio-1.png" width="672" /></p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>mf_counts <span class="ot">&lt;-</span> <span class="fu">table</span>(sheeps<span class="sc">$</span>Sex)</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>mf_counts</span></code></pre></div>
<pre><code>## 
##   F   M 
## 857 258</code></pre>
<p>The plot and the R output tells us that the data points are dominated
by female sheep; nearly 3 times as many GPS coordinates are sampled from
female sheep than male. How many times have each individual been
recorded?</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>count_table <span class="ot">&lt;-</span> <span class="fu">table</span>(sheeps<span class="sc">$</span>ID)</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a><span class="fu">barplot</span>(count_table, <span class="at">main =</span> <span class="st">&quot;Number of Records for Each Individual&quot;</span>,</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">&quot;Individual&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Number of Records&quot;</span>,</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>        <span class="at">col =</span> <span class="st">&quot;skyblue&quot;</span>, <span class="at">border =</span> <span class="st">&quot;black&quot;</span>)</span></code></pre></div>
<p><img src="RSF_Lab_files/figure-html/count_table-1.png" width="672" /></p>
<p>Finally, let’s visualize how the sheep are distributed, divided by
sex:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="fu">plot</span>(Northing<span class="sc">~</span>Easting, sheeps, <span class="at">col=</span><span class="fu">ifelse</span>(Sex<span class="sc">==</span><span class="st">&quot;M&quot;</span>,<span class="st">&quot;blue&quot;</span>,<span class="st">&quot;red&quot;</span>), <span class="at">pch=</span><span class="dv">16</span>)</span></code></pre></div>
<p><img src="RSF_Lab_files/figure-html/spatial_plot-1.png" width="672" /></p>
<p>We can already tell that males and females may not be overlapping
throughout this study area. This has implications for any models we
create where we use sex as a categorical variable (e.g., a male
vs. female resource selection model).</p>
<p>We should also note that the data is currently in NAD83 UTM Zone 13.
This correctly corresponds with the region of North Dakota we are
interested in. In the future when we import raster images, we will need
to ensure the data remains in this coordinate reference system (CRS)
and, as well as the raster images themselves. More on this later on!</p>
</div>
<div id="study-area-using-mcps" class="section level4">
<h4>Study area using MCPs</h4>
<p>Let’s continue by creating a study area for our model using the MCP
package. MCP helps us estimate a home range for our population (or data
set) using a Minimum Convex Polygon. You can think of the package as
creating a polygon with the smallest size possible, while still
including all of our data points by trailing the ones at the edge of our
habitat.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="co"># (In this example, we will create an MCP using a helper package called SpatialPoints)</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="co"># SpatialPoints data frame objects don&#39;t like missing values</span></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a><span class="co"># Let&#39;s remove the first two rows that contain NA values and...</span></span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a><span class="co"># Only include the x and y coordinates for making our MCP:</span></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>sheeps.sp <span class="ot">&lt;-</span> sheeps[, <span class="fu">c</span>(<span class="st">&quot;Easting&quot;</span>, <span class="st">&quot;Northing&quot;</span>)] </span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a>spatial <span class="ot">&lt;-</span> <span class="fu">SpatialPoints</span>(sheeps.sp)</span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a><span class="co"># Calculate MCPs for sheep:</span></span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a>sheep.mcp <span class="ot">&lt;-</span> <span class="fu">mcp</span>(spatial, <span class="at">percent =</span> <span class="dv">100</span>)</span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a></span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a><span class="co"># Let&#39;s examine the output!</span></span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a>sheep.mcp <span class="co"># Calling the MCP object will give us an estimate of area</span></span></code></pre></div>
<pre><code>## Object of class &quot;SpatialPolygonsDataFrame&quot; (package sp):
## 
## Number of SpatialPolygons:  1
## 
## Variables measured:
##   id     area
## a  a 170077.7</code></pre>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="fu">plot</span>(Northing<span class="sc">~</span>Easting, sheeps, <span class="at">col=</span><span class="fu">ifelse</span>(Sex<span class="sc">==</span><span class="st">&quot;M&quot;</span>,<span class="st">&quot;blue&quot;</span>,<span class="st">&quot;red&quot;</span>), <span class="at">pch=</span><span class="dv">16</span>)</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a><span class="fu">plot</span>(sheep.mcp, <span class="at">col =</span> <span class="fu">alpha</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="fl">0.5</span>), <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="RSF_Lab_files/figure-html/MCP-1.png" width="672" /></p>
<p>Perhaps not the prettiest plot, but it does the job! Is this a
realistic estimate of the population’s habitat range, though? Ideally,
we should create a “buffer” around our MCP to better capture the
population’s available habitat. For the purpose of this lab, however, we
are assuming this is the extent of the sheeps’ available habitat.</p>
</div>
<div id="using-random-points" class="section level4">
<h4>Using random points</h4>
<p>Random points are essential to building a statistically significant
resource selection function. As you might recall from our lecture, the
purpose of generating random points is to estimate the overall habitat
availability and comparing this availability to the landscape
characteristics your organism is actually selecting for.You can think of
random points as a way to generate the null model which you will be
testing against your hypothesis.</p>
<p>There is a more statistically sound method of generating random
points as a function of individual selection, but for the purposes of
this exercise we will be generating random points using a 1:1 ratio
between the number of random points and data points we have in the data
set. In other words, we have a total of 1115 “used” points, so we will
generate 1115 “random” points throughout our study area to simulate a no
selection preference.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a>sheep.mcp <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(sheep.mcp) <span class="co"># Let&#39;s use our MCP that we created and convert it to a spatial data frame</span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a><span class="fu">class</span>(sheep.mcp) <span class="co"># You can use the &quot;class&quot; function to verify that your &quot;sheep.mcp&quot; object is indeed a data frame!</span></span></code></pre></div>
<pre><code>## [1] &quot;sf&quot;         &quot;data.frame&quot;</code></pre>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a>rand <span class="ot">&lt;-</span> <span class="fu">st_sample</span>(sheep.mcp, <span class="at">size =</span> <span class="fu">nrow</span>(sheeps)) <span class="co"># Let&#39;s generate a number of random data points equal to the length of our data set (1:1 ratio).</span></span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a>rand_final <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(rand) <span class="co"># Let us also make sure that we save their coordinates </span></span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a>rand_final <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(rand_final) <span class="co"># and convert this to a data frame</span></span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a><span class="fu">plot</span>(Northing<span class="sc">~</span>Easting, sheeps, <span class="at">col=</span><span class="fu">ifelse</span>(Sex<span class="sc">==</span><span class="st">&quot;M&quot;</span>,<span class="st">&quot;blue&quot;</span>,<span class="st">&quot;red&quot;</span>), <span class="at">pch=</span><span class="dv">16</span>)</span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a><span class="fu">plot</span>(sheep.mcp, <span class="at">col =</span> <span class="fu">alpha</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="fl">0.5</span>), <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb17-8"><a href="#cb17-8" tabindex="-1"></a><span class="fu">plot</span>(rand, <span class="at">add=</span>T, <span class="at">pch=</span><span class="dv">16</span>, <span class="at">col=</span><span class="st">&quot;green&quot;</span>, <span class="at">cex=</span><span class="fl">0.5</span>) <span class="co"># Let&#39;s plot the points!</span></span></code></pre></div>
<p><img src="RSF_Lab_files/figure-html/rand_points-1.png" width="672" /></p>
<p>Now, let’s merge our randomly generated points with our original data
frame using some <em>SERIOUS</em> hardcoding</p>
<p><em>VERY IMPORTANT!</em> When merging the random points data frame
with the used points data frame, we still need a way to identify which
data points are which. For avoid confusion, let’s create a column named
“Used”. Every used location (points in our data set) receives a “1” and
every random location (our generated points) receives a “0”.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="fu">colnames</span>(rand_final)[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Easting&quot;</span> </span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a><span class="fu">colnames</span>(rand_final)[<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Northing&quot;</span></span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a>rand_final<span class="sc">$</span>Used <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="co"># Random Points</span></span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a>sheeps<span class="sc">$</span>Used <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="co"># Used Points</span></span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a>sheeps<span class="sc">$</span>Num <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">1115</span></span>
<span id="cb18-6"><a href="#cb18-6" tabindex="-1"></a>rand_final<span class="sc">$</span>Num <span class="ot">&lt;-</span> <span class="dv">1115</span><span class="sc">:</span><span class="dv">2229</span></span>
<span id="cb18-7"><a href="#cb18-7" tabindex="-1"></a>rand_merge <span class="ot">&lt;-</span> <span class="fu">merge</span>(sheeps,rand_final, <span class="at">by =</span> <span class="st">&quot;Num&quot;</span>, <span class="at">all=</span><span class="cn">TRUE</span>)</span>
<span id="cb18-8"><a href="#cb18-8" tabindex="-1"></a>rand_merge[<span class="fu">is.na</span>(rand_merge)] <span class="ot">&lt;-</span> <span class="st">&quot;&quot;</span></span>
<span id="cb18-9"><a href="#cb18-9" tabindex="-1"></a>rand_merge<span class="sc">$</span>Easting <span class="ot">&lt;-</span> <span class="fu">paste</span>(rand_merge<span class="sc">$</span>Easting.x, rand_merge<span class="sc">$</span>Easting.y)</span>
<span id="cb18-10"><a href="#cb18-10" tabindex="-1"></a>rand_merge<span class="sc">$</span>Northing <span class="ot">&lt;-</span> <span class="fu">paste</span>(rand_merge<span class="sc">$</span>Northing.x, rand_merge<span class="sc">$</span>Northing.y)</span>
<span id="cb18-11"><a href="#cb18-11" tabindex="-1"></a>rand_merge<span class="sc">$</span>Used <span class="ot">&lt;-</span> <span class="fu">paste</span>(rand_merge<span class="sc">$</span>Used.x, rand_merge<span class="sc">$</span>Used.y)</span>
<span id="cb18-12"><a href="#cb18-12" tabindex="-1"></a>rand_merge <span class="ot">&lt;-</span> <span class="fu">subset</span>(rand_merge, <span class="at">select =</span> <span class="sc">-</span><span class="fu">c</span>(Easting.x, Easting.y, Northing.x, Northing.y, Used.x, Used.y))</span></code></pre></div>
<p>Continue by merging and copy “Used” values to “Random” values:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a>copydata <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;ID&quot;</span>, <span class="st">&quot;Sex&quot;</span>, <span class="st">&quot;JulianDay&quot;</span>)</span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a>rand_merge[<span class="dv">1116</span><span class="sc">:</span><span class="dv">2229</span>, copydata] <span class="ot">&lt;-</span> rand_merge[<span class="dv">1</span><span class="sc">:</span><span class="dv">1115</span>, copydata]</span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a>all_sheep <span class="ot">&lt;-</span> rand_merge</span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a>all_sheep<span class="sc">$</span>Easting <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(all_sheep<span class="sc">$</span>Easting)</span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a>all_sheep<span class="sc">$</span>Northing <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(all_sheep<span class="sc">$</span>Northing)</span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a>all_sheep <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(all_sheep)</span>
<span id="cb19-7"><a href="#cb19-7" tabindex="-1"></a>missing <span class="ot">&lt;-</span> <span class="fu">apply</span>(all_sheep, <span class="dv">2</span>, <span class="cf">function</span>(x) <span class="fu">any</span>(<span class="fu">is.na</span>(x)))</span>
<span id="cb19-8"><a href="#cb19-8" tabindex="-1"></a>all_sheep <span class="ot">&lt;-</span> all_sheep[<span class="fu">complete.cases</span>(all_sheep), ]</span></code></pre></div>
<p>Our merged data frame now finally contains 1:1 random and used
points. Let’s plot and see what it looks like!</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="fu">plot</span>(Northing<span class="sc">~</span>Easting, rand_merge, <span class="at">col=</span><span class="fu">ifelse</span>(Sex<span class="sc">==</span><span class="st">&quot;M&quot;</span>,<span class="st">&quot;blue&quot;</span>,<span class="st">&quot;red&quot;</span>), <span class="at">pch=</span><span class="dv">16</span>, <span class="at">cex=</span><span class="fl">0.5</span>)</span></code></pre></div>
<pre><code>## Warning in xy.coords(x, y, xlabel, ylabel, log): NAs introduced by coercion

## Warning in xy.coords(x, y, xlabel, ylabel, log): NAs introduced by coercion</code></pre>
<p><img src="RSF_Lab_files/figure-html/plot_merge-1.png" width="672" /></p>
</div>
<div id="load-raster-image" class="section level4">
<h4>Load raster image</h4>
<p>As you can see, the plot above looks very similar to the plot we had
before with our MCP, but now the data is neatly contained in a single
data frame. This will make it easier to apply raster image layers to and
extract covariates for. Let’s proceed by doing exactly that! Make sure
that the provided raster image <a
href="samplestudy.tif">“samplestudy.tif”</a> is in your working
directory before proceeding.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a>raster <span class="ot">&lt;-</span> <span class="st">&quot;samplestudy.tif&quot;</span></span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a>pfg <span class="ot">&lt;-</span> <span class="fu">rast</span>(raster)</span>
<span id="cb22-3"><a href="#cb22-3" tabindex="-1"></a><span class="fu">print</span>(pfg) <span class="co"># This provides us some basic metadata for our beautiful raster file</span></span></code></pre></div>
<pre><code>## class       : SpatRaster 
## dimensions  : 4070, 3898, 1  (nrow, ncol, nlyr)
## resolution  : 35.041, 34.63862  (x, y)
## extent      : -621643.2, -485053.4, 2666396, 2807375  (xmin, xmax, ymin, ymax)
## coord. ref. : NAD_1983_Albers 
## source      : samplestudy.tif 
## name        : samplestudy</code></pre>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a><span class="fu">plot</span>(pfg) <span class="co"># What does it look like?</span></span></code></pre></div>
<p><img src="RSF_Lab_files/figure-html/unnamed-chunk-1-1.png" width="672" /></p>
<p>What you’re looking at is a map of the percentage of perennial forbs
and grasses (PFG) cover in our study area. Each cell (pixel) corresponds
to an area that’s 30x30 meters. White values represent a low cover, and
green values correspond to a high cover. Maybe this could be used as
valuable covariate for our data…? Before we proceed, however, remember
that we need to make sure that our sheep data and raster image have the
same coordinate reference system before we can overlay them with each
other:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="co"># Let&#39;s convert the sheep and raster image to use same datum:  </span></span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a><span class="co"># epsg &lt;- 26913</span></span>
<span id="cb25-3"><a href="#cb25-3" tabindex="-1"></a>crs.dat <span class="ot">&lt;-</span> <span class="fu">CRS</span>(<span class="st">&quot;+init=epsg:26913&quot;</span>)</span>
<span id="cb25-4"><a href="#cb25-4" tabindex="-1"></a>sheep_spat <span class="ot">&lt;-</span> <span class="fu">SpatialPointsDataFrame</span>(<span class="at">coords =</span> all_sheep[,<span class="fu">c</span>(<span class="st">&quot;Easting&quot;</span>,<span class="st">&quot;Northing&quot;</span>)], </span>
<span id="cb25-5"><a href="#cb25-5" tabindex="-1"></a>                                     <span class="at">data=</span>all_sheep, </span>
<span id="cb25-6"><a href="#cb25-6" tabindex="-1"></a>                                     <span class="at">proj4string =</span> crs.dat)</span>
<span id="cb25-7"><a href="#cb25-7" tabindex="-1"></a></span>
<span id="cb25-8"><a href="#cb25-8" tabindex="-1"></a><span class="co">#plot(sheep_spat, pch=16, col=&quot;blue&quot;) # Where are our data points in relation to the raster image?</span></span>
<span id="cb25-9"><a href="#cb25-9" tabindex="-1"></a></span>
<span id="cb25-10"><a href="#cb25-10" tabindex="-1"></a>crs.pfg <span class="ot">&lt;-</span> <span class="fu">crs</span>(pfg)</span>
<span id="cb25-11"><a href="#cb25-11" tabindex="-1"></a>pfg_proj <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">project</span>(pfg, crs.dat) <span class="co"># Projection using the &quot;terra&quot; package</span></span>
<span id="cb25-12"><a href="#cb25-12" tabindex="-1"></a></span>
<span id="cb25-13"><a href="#cb25-13" tabindex="-1"></a><span class="fu">plot</span>(pfg_proj)</span>
<span id="cb25-14"><a href="#cb25-14" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">geometry</span>(sheep_spat), <span class="at">pch=</span><span class="dv">16</span>, <span class="at">cex=</span><span class="fl">0.5</span>, <span class="at">col=</span><span class="st">&quot;blue&quot;</span>, <span class="at">add=</span>T) <span class="co"># Plot both the raster and our data together!</span></span></code></pre></div>
<img src="RSF_Lab_files/figure-html/overlay-1.png" width="672" />
<center>
<em>Look! It’s the flag of Brazil!</em>
</center>
</div>
<div id="assign-covariate-values" class="section level4">
<h4>Assign covariate values!</h4>
<p>Finally, now that we have both our data points (random and used)
referenced with the raster image, we can assign each data point a PFG
value for statistical analysis.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a><span class="co"># Extract point values</span></span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a>point_values <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">extract</span>(pfg_proj, sheep_spat<span class="sc">@</span>coords)</span>
<span id="cb26-3"><a href="#cb26-3" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" tabindex="-1"></a><span class="co"># Add point values back to main data frame ##</span></span>
<span id="cb26-5"><a href="#cb26-5" tabindex="-1"></a></span>
<span id="cb26-6"><a href="#cb26-6" tabindex="-1"></a>all_sheep <span class="ot">&lt;-</span> <span class="fu">cbind</span>(all_sheep,point_values)</span>
<span id="cb26-7"><a href="#cb26-7" tabindex="-1"></a><span class="fu">colnames</span>(all_sheep)[<span class="dv">8</span>] <span class="ot">&lt;-</span> <span class="st">&quot;pfg&quot;</span></span>
<span id="cb26-8"><a href="#cb26-8" tabindex="-1"></a><span class="co"># hist(all_sheep$samplestudy) # Distribution of PFG values for you to explore!</span></span>
<span id="cb26-9"><a href="#cb26-9" tabindex="-1"></a></span>
<span id="cb26-10"><a href="#cb26-10" tabindex="-1"></a><span class="co"># View final data frame #</span></span>
<span id="cb26-11"><a href="#cb26-11" tabindex="-1"></a><span class="fu">head</span>(all_sheep)</span></code></pre></div>
<pre><code>##   Num  ID Sex JulianDay  Easting Northing Used      pfg
## 1   1 209   F        91 606774.8  5227353   1  44.91299
## 2   2 334   M        91 610886.3  5262915   1  32.51279
## 3   3 362   F        91 655094.8  5279342   1  19.32125
## 4   4 374   M        91 652392.3  5281385   1  41.67151
## 5   5 375   F        91 650756.4  5275545   1  85.40177
## 6   6 376   F        91 604994.3  5250519   1  22.91881</code></pre>
<p>That’s it! This demonstrates the general process of extracting values
for a covariate, given a raster image file with the same coordinate
reference system as our population data set. The nature of our spatial
data is generally messy, and building models with this can be
challenging. In the exercises below, you will be given a larger data
frame, containing even more covariates for you to implement into your
resource selection model (depending on how you choose to build it).
Fun!</p>
<hr />
</div>
</div>
<div id="exercises" class="section level2">
<h2>Exercises</h2>
<p>The two methods we will be using today are GLMMs and JAGS models. We
use GLMMs because they allow us to model fixed and random effects.</p>
<p>Fixed Effect: Parameters are <em>fixed</em> and non-random</p>
<ul>
<li>Vegetation parameters (continuous fixed effects)</li>
<li>Topography (continuous fixed effects)</li>
<li>Temperature, Precipitation (continuous fixed effects)</li>
</ul>
<p>Random Effect: Represent a random sample</p>
<ul>
<li><strong>Individual (categorical random effect)</strong></li>
<li>Year (categorical random effect)</li>
<li>Site (categorical random effect)</li>
</ul>
<p>We use random effects in this framework because our data points are
not independent; we have numerous recorded locations from the same sheep
individuals that are spatially autocorrelated. When modeling random
effects, we also assume that our data are normally distributed.</p>
<hr />
<p>In the lab introduction above, we extracted data for the cover of
perennial grasses and forbs (PFG) and added it as a column into our data
frame. Now, to make things more interesting, we have added a couple of
more covariates for you to include in your models. <em>Please begin the
lab by downloading the <a href="RSF_Lab.csv">“RSF_Lab.csv”</a>
file.</em></p>
<pre><code>##    ID ID2 Sex Used JulianDay  Easting Northing elevation shrub pfg afg tree
## 1 209   1   F    1       150 602606.4  5242240       691     1  18   2    1
## 2 209   1   F    1       151 602798.3  5242372       694     0  34   3    0
## 3 209   1   F    1       153 604346.4  5240871       698     0  27   4    0
## 4 209   1   F    1       154 605456.3  5238840       691     0  33   3    0
## 5 209   1   F    1       155 605366.0  5238646       670     0  47   0    0
## 6 209   1   F    1       156 605404.7  5238978       704     0  35   1    0</code></pre>
<p>As you can see, in addition to PFG, the new covariates are (extracted
using a similar process as described above):</p>
<ul>
<li>Annual forbs and grasses (AFG), percentage cover per cell,
0-100%</li>
<li>Shrubs, percentage cover per cell, 0-100%</li>
<li>Trees, percentage cover per cell, 0-100%</li>
<li>Elevation, in meters above sea level.</li>
</ul>
<p>There’s also a new column for ID (ID2), which may be of help when
creating your models.</p>
<p>You can now get started with the exercises! For both of these, we
provide you with some general questions below for you to consider. All
of them can essentially be explained with resource selection models!</p>
<ul>
<li>Which covariates do sheep appear to be selecting for or against? For
example, do they prefer areas that are covered with trees more than
shrubs?</li>
<li>Is there a difference in resource selection between males and
females?</li>
<li>Based on your model, do you think you have a decent understanding of
what sheep are selecting for in this region? Why or why not?</li>
</ul>
<div id="exercise-1" class="section level4">
<h4>Exercise 1</h4>
<p>Our first exercise takes a frequentist approach to building a
resource selection model. We suggest using a GLMM - below is a simple
example - though it’s up to you to choose your covariates and random
effects. Note that this simple model uses (1|ID) to represent a random
intercept. Consider what link-function would be appropriate to use. To
avoid convergence issues, you might also have to transform the covariate
columns. Good luck!</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a>all_sheep<span class="sc">$</span>Used <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(all_sheep<span class="sc">$</span>Used)</span>
<span id="cb29-2"><a href="#cb29-2" tabindex="-1"></a>all_sheep<span class="sc">$</span>JulianDay <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(all_sheep<span class="sc">$</span>JulianDay)</span>
<span id="cb29-3"><a href="#cb29-3" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" tabindex="-1"></a>mean.pfg <span class="ot">&lt;-</span> <span class="fu">mean</span>(all_sheep<span class="sc">$</span>pfg)</span>
<span id="cb29-5"><a href="#cb29-5" tabindex="-1"></a>sd.pfg <span class="ot">&lt;-</span>  <span class="fu">sd</span>(all_sheep<span class="sc">$</span>pfg)</span>
<span id="cb29-6"><a href="#cb29-6" tabindex="-1"></a>all_sheep<span class="sc">$</span>pfg.s <span class="ot">&lt;-</span> (all_sheep<span class="sc">$</span>pfg<span class="sc">-</span>mean.pfg)<span class="sc">/</span>sd.pfg</span>
<span id="cb29-7"><a href="#cb29-7" tabindex="-1"></a></span>
<span id="cb29-8"><a href="#cb29-8" tabindex="-1"></a>mean.jul <span class="ot">&lt;-</span> <span class="fu">mean</span>(all_sheep<span class="sc">$</span>JulianDay)</span>
<span id="cb29-9"><a href="#cb29-9" tabindex="-1"></a>sd.jul <span class="ot">&lt;-</span>  <span class="fu">sd</span>(all_sheep<span class="sc">$</span>JulianDay)</span>
<span id="cb29-10"><a href="#cb29-10" tabindex="-1"></a>all_sheep<span class="sc">$</span>Julian.s <span class="ot">&lt;-</span> (all_sheep<span class="sc">$</span>JulianDay<span class="sc">-</span>mean.jul)<span class="sc">/</span>sd.jul</span>
<span id="cb29-11"><a href="#cb29-11" tabindex="-1"></a></span>
<span id="cb29-12"><a href="#cb29-12" tabindex="-1"></a>all_sheep<span class="sc">$</span>ID2 <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">as.factor</span>(all_sheep<span class="sc">$</span>ID))</span>
<span id="cb29-13"><a href="#cb29-13" tabindex="-1"></a></span>
<span id="cb29-14"><a href="#cb29-14" tabindex="-1"></a><span class="do">## Build your GLMM:: </span></span>
<span id="cb29-15"><a href="#cb29-15" tabindex="-1"></a></span>
<span id="cb29-16"><a href="#cb29-16" tabindex="-1"></a>spring_mod0 <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(Used <span class="sc">~</span> Sex <span class="sc">+</span> JulianDay <span class="sc">+</span> pfg <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>ID), </span>
<span id="cb29-17"><a href="#cb29-17" tabindex="-1"></a>                      <span class="at">data =</span> all_sheep, <span class="at">family=</span><span class="fu">binomial</span>(<span class="at">link=</span><span class="st">&quot;logit&quot;</span>),</span>
<span id="cb29-18"><a href="#cb29-18" tabindex="-1"></a>                      <span class="at">na.action =</span> <span class="st">&quot;na.fail&quot;</span>, <span class="at">REML=</span><span class="cn">FALSE</span>)</span>
<span id="cb29-19"><a href="#cb29-19" tabindex="-1"></a><span class="co"># summary(spring_mod0)</span></span></code></pre></div>
<p>Hint: For the larger models, we encourage you to use random slopes
and random intercepts, which you can code like this: Used ~ pfg + afg +
(1+pfg|ID) + (1+afg|ID)</p>
</div>
<div id="exercise-2" class="section level4">
<h4>Exercise 2</h4>
<p>This second exercise allows you to build a similar resource selection
model in JAGS/BUGS. To make your lives a little easier (and given the
time constraint), we’ve provided the JAGS code for you below. Try
modifying the likelihood function by including different covariates
other than PFG, and attempt to interpret the posterior distributions.
Have fun!</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a><span class="co"># In this example, we introduce a random effect between individual and perennial forbs and grasses. </span></span>
<span id="cb30-2"><a href="#cb30-2" tabindex="-1"></a><span class="co"># Additionally, this model will allow us to determine the difference between females and males (isfem[o]). </span></span>
<span id="cb30-3"><a href="#cb30-3" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" tabindex="-1"></a><span class="fu">library</span>(jagsUI)</span>
<span id="cb30-5"><a href="#cb30-5" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;</span></span>
<span id="cb30-6"><a href="#cb30-6" tabindex="-1"></a><span class="st">    model{</span></span>
<span id="cb30-7"><a href="#cb30-7" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb30-8"><a href="#cb30-8" tabindex="-1"></a><span class="st">        ## Specify likelihood:: </span></span>
<span id="cb30-9"><a href="#cb30-9" tabindex="-1"></a><span class="st">        for(o in 1:n){</span></span>
<span id="cb30-10"><a href="#cb30-10" tabindex="-1"></a><span class="st">          logit(exp_use[o]) &lt;- b0.l+b1*isfem[o]+b2*JulianDay[o]+b3[ID[o]]*pfg[o]+reff[ID[o]]</span></span>
<span id="cb30-11"><a href="#cb30-11" tabindex="-1"></a><span class="st">          used[o] ~ dbern(exp_use[o])</span></span>
<span id="cb30-12"><a href="#cb30-12" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb30-13"><a href="#cb30-13" tabindex="-1"></a><span class="st">        for(i in 1:nn){</span></span>
<span id="cb30-14"><a href="#cb30-14" tabindex="-1"></a><span class="st">          reff[i] ~ dnorm(0,reff.prec)</span></span>
<span id="cb30-15"><a href="#cb30-15" tabindex="-1"></a><span class="st">          b3[i] ~ dnorm(b3.0,b3.prec) </span></span>
<span id="cb30-16"><a href="#cb30-16" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb30-17"><a href="#cb30-17" tabindex="-1"></a><span class="st">        ## Specify Priors::</span></span>
<span id="cb30-18"><a href="#cb30-18" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb30-19"><a href="#cb30-19" tabindex="-1"></a><span class="st">        b0 ~ dunif(0,1)</span></span>
<span id="cb30-20"><a href="#cb30-20" tabindex="-1"></a><span class="st">        b0.l &lt;- log(b0/(1-b0))</span></span>
<span id="cb30-21"><a href="#cb30-21" tabindex="-1"></a><span class="st">        b1 ~ dnorm(0,0.01)</span></span>
<span id="cb30-22"><a href="#cb30-22" tabindex="-1"></a><span class="st">        b2 ~ dnorm(0,0.01)</span></span>
<span id="cb30-23"><a href="#cb30-23" tabindex="-1"></a><span class="st">        b3.0 ~ dnorm(0,0.01)</span></span>
<span id="cb30-24"><a href="#cb30-24" tabindex="-1"></a><span class="st">        b3.prec &lt;- pow(b3.sd,-2)</span></span>
<span id="cb30-25"><a href="#cb30-25" tabindex="-1"></a><span class="st">        b3.sd ~ dunif(0,10)</span></span>
<span id="cb30-26"><a href="#cb30-26" tabindex="-1"></a><span class="st">        reff.sd ~ dunif(0,10)</span></span>
<span id="cb30-27"><a href="#cb30-27" tabindex="-1"></a><span class="st">        reff.prec &lt;- pow(reff.sd, -2)</span></span>
<span id="cb30-28"><a href="#cb30-28" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb30-29"><a href="#cb30-29" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb30-30"><a href="#cb30-30" tabindex="-1"></a><span class="st">    &quot;</span>, <span class="at">file=</span><span class="st">&quot;jagscode.txt&quot;</span> </span>
<span id="cb30-31"><a href="#cb30-31" tabindex="-1"></a>    </span>
<span id="cb30-32"><a href="#cb30-32" tabindex="-1"></a>)</span>
<span id="cb30-33"><a href="#cb30-33" tabindex="-1"></a><span class="do">## define isfem, JulianDay, pfg, ID, n, nn</span></span>
<span id="cb30-34"><a href="#cb30-34" tabindex="-1"></a></span>
<span id="cb30-35"><a href="#cb30-35" tabindex="-1"></a><span class="do">## Package data for JAGS</span></span>
<span id="cb30-36"><a href="#cb30-36" tabindex="-1"></a></span>
<span id="cb30-37"><a href="#cb30-37" tabindex="-1"></a>jagslist <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb30-38"><a href="#cb30-38" tabindex="-1"></a>  <span class="at">isfem =</span> <span class="fu">ifelse</span>(all_sheep<span class="sc">$</span>Sex<span class="sc">==</span><span class="st">&quot;F&quot;</span>, <span class="dv">1</span>, <span class="dv">0</span>), </span>
<span id="cb30-39"><a href="#cb30-39" tabindex="-1"></a>  <span class="at">JulianDay =</span> all_sheep<span class="sc">$</span>Julian.s,</span>
<span id="cb30-40"><a href="#cb30-40" tabindex="-1"></a>  <span class="at">pfg =</span> all_sheep<span class="sc">$</span>pfg.s, </span>
<span id="cb30-41"><a href="#cb30-41" tabindex="-1"></a>  <span class="at">ID =</span> all_sheep<span class="sc">$</span>ID2, </span>
<span id="cb30-42"><a href="#cb30-42" tabindex="-1"></a>  <span class="at">n =</span> <span class="fu">nrow</span>(all_sheep), </span>
<span id="cb30-43"><a href="#cb30-43" tabindex="-1"></a>  <span class="at">nn =</span> <span class="fu">max</span>(all_sheep<span class="sc">$</span>ID2),</span>
<span id="cb30-44"><a href="#cb30-44" tabindex="-1"></a>  <span class="at">used =</span> all_sheep<span class="sc">$</span>Used</span>
<span id="cb30-45"><a href="#cb30-45" tabindex="-1"></a>  </span>
<span id="cb30-46"><a href="#cb30-46" tabindex="-1"></a>)</span>
<span id="cb30-47"><a href="#cb30-47" tabindex="-1"></a><span class="co">#jagslist</span></span>
<span id="cb30-48"><a href="#cb30-48" tabindex="-1"></a></span>
<span id="cb30-49"><a href="#cb30-49" tabindex="-1"></a><span class="do">### Define inits for Jags:: </span></span>
<span id="cb30-50"><a href="#cb30-50" tabindex="-1"></a></span>
<span id="cb30-51"><a href="#cb30-51" tabindex="-1"></a>initials <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb30-52"><a href="#cb30-52" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb30-53"><a href="#cb30-53" tabindex="-1"></a>    <span class="at">b0 =</span> <span class="fu">runif</span>(<span class="dv">1</span>,<span class="fl">0.4</span>,<span class="fl">0.6</span>), </span>
<span id="cb30-54"><a href="#cb30-54" tabindex="-1"></a>    <span class="at">b1 =</span> <span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="fl">0.1</span>),</span>
<span id="cb30-55"><a href="#cb30-55" tabindex="-1"></a>    <span class="at">b2 =</span> <span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="fl">0.1</span>),</span>
<span id="cb30-56"><a href="#cb30-56" tabindex="-1"></a>    <span class="at">b3.0 =</span> <span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="fl">0.1</span>),</span>
<span id="cb30-57"><a href="#cb30-57" tabindex="-1"></a>    <span class="at">b3.sd =</span> <span class="fu">runif</span>(<span class="dv">1</span>,<span class="fl">0.1</span>,<span class="fl">0.5</span>),</span>
<span id="cb30-58"><a href="#cb30-58" tabindex="-1"></a>    <span class="at">reff.sd =</span> <span class="fu">runif</span>(<span class="dv">1</span>,<span class="fl">0.1</span>,<span class="fl">0.5</span>)</span>
<span id="cb30-59"><a href="#cb30-59" tabindex="-1"></a>  )</span>
<span id="cb30-60"><a href="#cb30-60" tabindex="-1"></a>  </span>
<span id="cb30-61"><a href="#cb30-61" tabindex="-1"></a>}</span>
<span id="cb30-62"><a href="#cb30-62" tabindex="-1"></a><span class="co">#initials()</span></span>
<span id="cb30-63"><a href="#cb30-63" tabindex="-1"></a></span>
<span id="cb30-64"><a href="#cb30-64" tabindex="-1"></a>params <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;b0&quot;</span>,<span class="st">&quot;b1&quot;</span>,<span class="st">&quot;b2&quot;</span>,<span class="st">&quot;b3&quot;</span>, <span class="st">&quot;b3.0&quot;</span>, <span class="st">&quot;b3.prec&quot;</span>,<span class="st">&quot;reff.sd&quot;</span>,<span class="st">&quot;reff&quot;</span>)</span>
<span id="cb30-65"><a href="#cb30-65" tabindex="-1"></a><span class="co">#?jags</span></span>
<span id="cb30-66"><a href="#cb30-66" tabindex="-1"></a></span>
<span id="cb30-67"><a href="#cb30-67" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">jags</span>(<span class="at">data=</span>jagslist, <span class="at">inits=</span>initials, <span class="at">parameters.to.save=</span>params, <span class="at">model.file=</span><span class="st">&quot;jagscode.txt&quot;</span>,</span>
<span id="cb30-68"><a href="#cb30-68" tabindex="-1"></a>              <span class="at">n.chains=</span><span class="dv">3</span>, <span class="at">n.adapt=</span><span class="dv">1000</span>, <span class="at">n.iter=</span><span class="dv">10000</span>, <span class="at">n.burnin=</span><span class="dv">5000</span>, <span class="at">n.thin=</span><span class="dv">2</span>,</span>
<span id="cb30-69"><a href="#cb30-69" tabindex="-1"></a>              <span class="at">parallel=</span><span class="cn">TRUE</span>)</span>
<span id="cb30-70"><a href="#cb30-70" tabindex="-1"></a></span>
<span id="cb30-71"><a href="#cb30-71" tabindex="-1"></a>sims <span class="ot">=</span> model<span class="sc">$</span>sims.list</span>
<span id="cb30-72"><a href="#cb30-72" tabindex="-1"></a></span>
<span id="cb30-73"><a href="#cb30-73" tabindex="-1"></a><span class="co"># Some histograms for you to look at!</span></span>
<span id="cb30-74"><a href="#cb30-74" tabindex="-1"></a><span class="co"># hist(sims$b0)</span></span>
<span id="cb30-75"><a href="#cb30-75" tabindex="-1"></a><span class="co"># hist(sims$b1)</span></span>
<span id="cb30-76"><a href="#cb30-76" tabindex="-1"></a><span class="co"># hist(sims$b2)</span></span>
<span id="cb30-77"><a href="#cb30-77" tabindex="-1"></a><span class="co"># hist(sims$b3[,5]) # effect for individual 1</span></span>
<span id="cb30-78"><a href="#cb30-78" tabindex="-1"></a><span class="co"># hist(sims$b3.0)</span></span>
<span id="cb30-79"><a href="#cb30-79" tabindex="-1"></a><span class="co"># hist(sims$reff.sd)</span></span>
<span id="cb30-80"><a href="#cb30-80" tabindex="-1"></a><span class="co"># hist(sims$reff[,1])</span></span></code></pre></div>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3,h4",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = false;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
