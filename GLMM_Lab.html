<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Hayley Reid, Ivan Provinciato, Jessica Buelow" />


<title>Generalized linear mixed-effects models (GLMM) in R and JAGS: Exercises</title>

<script src="site_libs/header-attrs-2.24/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cerulean.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #204a87; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #204a87; font-weight: bold; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #ce5c00; font-weight: bold; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>







<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">NRES 746</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Schedule
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="schedule.html">Course Schedule</a>
    </li>
    <li>
      <a href="Syllabus.pdf">Syllabus</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Lectures
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="INTRO.html">Introduction to NRES 746</a>
    </li>
    <li>
      <a href="LECTURE1.html">Why focus on algorithms?</a>
    </li>
    <li>
      <a href="LECTURE2.html">Working with probabilities</a>
    </li>
    <li>
      <a href="LECTURE3.html">The Virtual Ecologist</a>
    </li>
    <li>
      <a href="LECTURE4.html">Likelihood</a>
    </li>
    <li>
      <a href="LECTURE5.html">Optimization</a>
    </li>
    <li>
      <a href="LECTURE6.html">Bayesian #1: concepts</a>
    </li>
    <li>
      <a href="LECTURE7.html">Bayesian #2: mcmc</a>
    </li>
    <li>
      <a href="LECTURE8.html">Model Selection</a>
    </li>
    <li>
      <a href="LECTURE9.html">Performance Evaluation</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Lab exercises
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="LAB_Instructions.html">Instructions for Labs</a>
    </li>
    <li>
      <a href="LAB3demo.html">Lab 3: Likelihood (intro)</a>
    </li>
    <li>
      <a href="LAB5.html">Lab 5: Model selection (optional)</a>
    </li>
    <li>
      <a href="FigureDemo.html">Demo: Figures in R</a>
    </li>
    <li>
      <a href="GIT_tutorial.html">Demo: version control in Git</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Student led topics
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="GLMM.html">GLMMs</a>
    </li>
    <li>
      <a href="GAMs_Lab.html">GAMs (lab)</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Data sets
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="TreeData.csv">Tree Data</a>
    </li>
    <li>
      <a href="ReedfrogPred.csv">Reed Frog Predation Data</a>
    </li>
    <li>
      <a href="ReedfrogFuncresp.csv">Reed Frog Func Resp</a>
    </li>
  </ul>
</li>
<li>
  <a href="Links.html">Links</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Generalized linear mixed-effects models
(GLMM) in R and JAGS: Exercises</h1>
<h4 class="author">Hayley Reid, Ivan Provinciato, Jessica Buelow</h4>

</div>


<p>Welcome to the lab exercises for GLMM! In this section, we would like
to present 3 different datasets, each one with a different approach and
different uses of GLMMs.</p>
<div id="a-little-introduction-to-glmmtmb-and-convergence"
class="section level2">
<h2>A little introduction to glmmTMB and convergence</h2>
<p>Our examples in lecture used the lme4 package, which is great for
GLMMs. You can use the lmer() function for linear mixed effects models
or the glmer() function for generalized linear mixed effects models.
However, there is another package that can be used to build GLMMs that
you should be aware of, called glmmTMB. Overall, they are very similar,
and you can often use either one and be just fine. The glmmTMB()
function is more flexible with zero-inflated models and negative
binomial models than the lme4 package, though. Furthermore, if you are
running into convergence issues with lme4, you can try glmmTMB, which
tends to have less convergence issues.</p>
<p>Model convergence is the process where the parameters of a model
stabilize during an iterative optimization process, such as in Maximum
Likelihood Estimation or Bayesian methods. It is particularly relevant
in the fitting of complex models, such as those involving multiple
parameters, hierarchical structures, or random effects. If a model fails
to converge, it means that it was unable to land on a stable set of
parameters. This could indicate an underlying problem with the model,
but it could also potentially be fixed by using the glmmTMB package.</p>
<p>Another possible solution for convergence issues is by running your
model in JAGS. An example for running a GLMM in JAGS can be found in
exercise 3.</p>
</div>
<div id="exercise-1" class="section level2">
<h2>Exercise 1</h2>
<p>Load <a href="Exercise_1.csv">Exercise_1.csv</a></p>
<p>As explained during the lecture, for this exercise you will be
working with a hypothetical dataset. Let’s consider that we captured
birds during one year, in different seasons, and we collected blood
samples from each individual to obtain their hemoglobin level. Thus,
this dataset is composed by only 3 different variables: Unique
individual ID, Seasons of the year and Hemoglobin values for each
individual.</p>
<div id="what-you-have-to-do" class="section level4">
<h4>What you have to do:</h4>
<p>First thing is to explore and plot the data, to see if there is any
kind of relationship among the variables. After that, decide which
is/are the random effects that you need to consider and what kind of
link function you will need to use in this exercise. You might create
different models and then see which one fits better.</p>
</div>
<div id="questions-to-answer" class="section level4">
<h4>Questions to answer:</h4>
<ul>
<li>Which variable(s) you considered as random effect? Why?</li>
<li>Does your chosen model has a good fit of the data?</li>
<li>Try to explain the relationship between season of the year and
hemoglobin and give at least one reason why we are observing this
pattern.</li>
</ul>
</div>
</div>
<div id="exercise-2" class="section level2">
<h2>Exercise 2</h2>
<p>Load <a href="beesurv.csv">beesurv.csv</a></p>
<p>Let’s imagine a scenario where we want to find out what influences
how many bees visit flowers on a given day. We went to each of 10 sites,
surveyed the bee visitation on the flowers present, and recorded the
site number, temperature, wind speed, and number of observed visits to
flowers. We visited each site 10 separate days, which gave us 10 data
points for each site.</p>
<div id="questions-to-answer-1" class="section level4">
<h4>Questions to answer:</h4>
<ul>
<li>What was the distribution of this data?</li>
<li>Which link function did you use?</li>
<li>Which variable(s) did you select as a random effect, and why?</li>
<li>Of the models you built, which did you select as the best fit? How
did you decide (which goodness-of-fit approaches, model evaluation
approaches, etc.)?</li>
</ul>
</div>
</div>
<div id="exercise-3-jags-exercise" class="section level2">
<h2>Exercise 3: Jags Exercise</h2>
<p>We generate a synthetic dataset representing the correlation between
body length and body mass in a fictional snake species. The dataset
includes a random effect designed for analysis using a linear
mixed-effects model. Body length serves as the predictor variable, and
we posit that snakes were captured at various sites. Our analysis
focuses on a random intercept model, where the dataset features a
consistent slope for the influence of body length on body mass across
all sites, but distinct intercepts are assigned to each site. The
underlying assumption of the mixed model is that the site intercepts
follow a normal distribution centered around their mean.</p>
<p>Our objective is to investigate the connection between body length
and body mass in a fictional snake dataset.</p>
<p>Our data characteristics include: Body length as a predictor variable
Body mass as a response variable Site as a random effect</p>
<p>We will use a linear mixed-effects model with the same slope for body
length across all sites, and unique intercepts for each site</p>
<p>We can assume that site intercepts follow a normal distribution
around their mean.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(R2jags) <span class="co"># R package for communication between R and JAGS</span></span></code></pre></div>
<pre><code>## Loading required package: rjags</code></pre>
<pre><code>## Loading required package: coda</code></pre>
<pre><code>## Linked to JAGS 4.3.1</code></pre>
<pre><code>## Loaded modules: basemod,bugs</code></pre>
<pre><code>## 
## Attaching package: &#39;R2jags&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:coda&#39;:
## 
##     traceplot</code></pre>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="fu">library</span>(jagsUI)</span></code></pre></div>
<pre><code>## 
## Attaching package: &#39;jagsUI&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:R2jags&#39;:
## 
##     autojags, jags, traceplot</code></pre>
<pre><code>## The following object is masked from &#39;package:coda&#39;:
## 
##     traceplot</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="co"># Set the seed for reproducibility</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a><span class="co"># Define parameters</span></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>samplesize <span class="ot">&lt;-</span> <span class="dv">200</span>         <span class="co"># Number of observations</span></span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a>nsites <span class="ot">&lt;-</span> <span class="dv">10</span>              <span class="co"># Number of sites</span></span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a>b_length <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">rnorm</span>(samplesize))  <span class="co"># Explanatory variable (body length)</span></span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a><span class="co"># Generate a random grouping variable &#39;sites&#39; with replacement</span></span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a>sites <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, samplesize, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a></span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a><span class="co"># Display the count of observations per site</span></span>
<span id="cb12-13"><a href="#cb12-13" tabindex="-1"></a><span class="fu">table</span>(sites)</span></code></pre></div>
<pre><code>## sites
##  1  2  3  4  5  6  7  8  9 10 
## 18 21 24 21 15 22 20 24 15 20</code></pre>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="co"># True intercept parameters</span></span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>int_true_mean <span class="ot">&lt;-</span> <span class="dv">45</span>       <span class="co"># True mean intercept</span></span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a>int_true_sigma <span class="ot">&lt;-</span> <span class="dv">10</span>      <span class="co"># True standard deviation of intercepts</span></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a>int_true_sites <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> nsites, <span class="at">mean =</span> int_true_mean, <span class="at">sd =</span> int_true_sigma)  <span class="co"># True intercept of each site</span></span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a><span class="co"># Create a matrix to represent the intercept of each snake individual based on its site</span></span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a>sitemat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> samplesize, <span class="at">ncol =</span> nsites)</span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(sitemat)) sitemat[i, sites[i]] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a>int_true <span class="ot">&lt;-</span> sitemat <span class="sc">%*%</span> int_true_sites</span>
<span id="cb14-10"><a href="#cb14-10" tabindex="-1"></a></span>
<span id="cb14-11"><a href="#cb14-11" tabindex="-1"></a><span class="co"># True slope parameter</span></span>
<span id="cb14-12"><a href="#cb14-12" tabindex="-1"></a>slope_true <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb14-13"><a href="#cb14-13" tabindex="-1"></a></span>
<span id="cb14-14"><a href="#cb14-14" tabindex="-1"></a><span class="co"># Calculate true means and standard deviation</span></span>
<span id="cb14-15"><a href="#cb14-15" tabindex="-1"></a>mu <span class="ot">&lt;-</span> int_true <span class="sc">+</span> slope_true <span class="sc">*</span> b_length</span>
<span id="cb14-16"><a href="#cb14-16" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb14-17"><a href="#cb14-17" tabindex="-1"></a></span>
<span id="cb14-18"><a href="#cb14-18" tabindex="-1"></a><span class="co"># Generate response variable &#39;b_mass&#39; based on normal distributions</span></span>
<span id="cb14-19"><a href="#cb14-19" tabindex="-1"></a>b_mass <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(samplesize, <span class="at">mean =</span> mu, <span class="at">sd =</span> sigma)</span>
<span id="cb14-20"><a href="#cb14-20" tabindex="-1"></a></span>
<span id="cb14-21"><a href="#cb14-21" tabindex="-1"></a><span class="co"># Create a data frame &#39;snakes3&#39; with explanatory and response variables</span></span>
<span id="cb14-22"><a href="#cb14-22" tabindex="-1"></a>snakes3 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">b_length =</span> b_length, <span class="at">b_mass =</span> b_mass, <span class="at">site =</span> sites)</span>
<span id="cb14-23"><a href="#cb14-23" tabindex="-1"></a></span>
<span id="cb14-24"><a href="#cb14-24" tabindex="-1"></a><span class="co"># Display the first few rows of the data frame</span></span>
<span id="cb14-25"><a href="#cb14-25" tabindex="-1"></a><span class="fu">head</span>(snakes3)</span></code></pre></div>
<pre><code>##    b_length     b_mass site
## 1 -2.309169  18.346425    7
## 2 -2.053247  27.683564    3
## 3 -1.966617 -12.462933    9
## 4 -1.686693  31.497302    7
## 5 -1.667942  -5.439032    9
## 6 -1.617883   1.521710    4</code></pre>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="co"># Create a scatter plot of &#39;b_mass&#39; against &#39;b_length&#39; colored by site</span></span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a><span class="fu">plot</span>(b_mass <span class="sc">~</span> b_length, <span class="at">col =</span> site, <span class="at">data =</span> snakes3)</span></code></pre></div>
<p><img src="GLMM_Lab_files/figure-html/unnamed-chunk-1-1.png" width="672" /></p>
<p>When preparing the dataset for JAGS analysis, we incorporate the
number of sites as an extra element in the list.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="co"># Prepare data for analysis with JAGS, including the number of sites</span></span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>Nsites <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">levels</span>(<span class="fu">as.factor</span>(snakes3<span class="sc">$</span>site)))</span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a>jagsdata_s3 <span class="ot">&lt;-</span> <span class="fu">with</span>(snakes3, <span class="fu">list</span>(<span class="at">b_mass =</span> b_mass, <span class="at">b_length =</span> b_length, <span class="at">site =</span> site,</span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a>                                  <span class="at">N =</span> <span class="fu">length</span>(b_mass), <span class="at">Nsites =</span> Nsites))</span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a><span class="co"># JAGS model specification function</span></span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" tabindex="-1"></a>filename <span class="ot">=</span> <span class="st">&quot;JAGS.txt&quot;</span></span>
<span id="cb17-9"><a href="#cb17-9" tabindex="-1"></a></span>
<span id="cb17-10"><a href="#cb17-10" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;</span></span>
<span id="cb17-11"><a href="#cb17-11" tabindex="-1"></a><span class="st">model{</span></span>
<span id="cb17-12"><a href="#cb17-12" tabindex="-1"></a><span class="st">  # Likelihood:</span></span>
<span id="cb17-13"><a href="#cb17-13" tabindex="-1"></a><span class="st">  for (i in 1:N){</span></span>
<span id="cb17-14"><a href="#cb17-14" tabindex="-1"></a><span class="st">    b_mass[i] ~ dnorm(mu[i], tau)  # Likelihood of the response variable</span></span>
<span id="cb17-15"><a href="#cb17-15" tabindex="-1"></a><span class="st">    mu[i] &lt;- alpha + a[site[i]] + beta * b_length[i]  # Model for the mean</span></span>
<span id="cb17-16"><a href="#cb17-16" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb17-17"><a href="#cb17-17" tabindex="-1"></a><span class="st">  # Priors:</span></span>
<span id="cb17-18"><a href="#cb17-18" tabindex="-1"></a><span class="st">  alpha ~ dnorm(0, 0.01)      # Prior for the overall intercept</span></span>
<span id="cb17-19"><a href="#cb17-19" tabindex="-1"></a><span class="st">  sigma_a ~ dunif(0, 100)      # Prior for the standard deviation of random effect</span></span>
<span id="cb17-20"><a href="#cb17-20" tabindex="-1"></a><span class="st">  tau_a &lt;- 1 / (sigma_a * sigma_a)  # Convert standard deviation to precision</span></span>
<span id="cb17-21"><a href="#cb17-21" tabindex="-1"></a><span class="st">  for (j in 1:Nsites){</span></span>
<span id="cb17-22"><a href="#cb17-22" tabindex="-1"></a><span class="st">    a[j] ~ dnorm(0, tau_a)    # Prior for random intercept for each site</span></span>
<span id="cb17-23"><a href="#cb17-23" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb17-24"><a href="#cb17-24" tabindex="-1"></a><span class="st">  beta ~ dnorm(0, 0.01)        # Prior for the slope</span></span>
<span id="cb17-25"><a href="#cb17-25" tabindex="-1"></a><span class="st">  sigma ~ dunif(0, 100)        # Prior for the standard deviation of fixed effect</span></span>
<span id="cb17-26"><a href="#cb17-26" tabindex="-1"></a><span class="st">  tau &lt;- 1 / (sigma * sigma)   # Convert standard deviation to precision</span></span>
<span id="cb17-27"><a href="#cb17-27" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb17-28"><a href="#cb17-28" tabindex="-1"></a><span class="st">&quot;</span>,<span class="at">file=</span>filename)</span></code></pre></div>
<p>In addition to the overall intercept (alpha), we calculate a distinct
intercept (a) for each site. These site-specific intercepts follow a
normal distribution centered around the overall intercept, introducing a
variance term (sigma_a). This variance, representing differences between
sites, is an additional parameter recorded during the model fitting
process.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="co"># Initial values function for JAGS</span></span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a>init_values <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">alpha =</span> <span class="fu">rnorm</span>(<span class="dv">1</span>), <span class="at">sigma_a =</span> <span class="fu">runif</span>(<span class="dv">1</span>), <span class="at">beta =</span> <span class="fu">rnorm</span>(<span class="dv">1</span>), <span class="at">sigma =</span> <span class="fu">runif</span>(<span class="dv">1</span>))</span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a>}</span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" tabindex="-1"></a><span class="co"># Parameters to be saved from the JAGS model</span></span>
<span id="cb18-7"><a href="#cb18-7" tabindex="-1"></a>params <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;alpha&quot;</span>, <span class="st">&quot;beta&quot;</span>, <span class="st">&quot;sigma&quot;</span>, <span class="st">&quot;sigma_a&quot;</span>)</span>
<span id="cb18-8"><a href="#cb18-8" tabindex="-1"></a></span>
<span id="cb18-9"><a href="#cb18-9" tabindex="-1"></a><span class="co"># Fit the JAGS model to the data</span></span>
<span id="cb18-10"><a href="#cb18-10" tabindex="-1"></a>fit_lm3 <span class="ot">&lt;-</span> <span class="fu">jags</span>(<span class="at">data =</span> jagsdata_s3, <span class="at">inits =</span> init_values, <span class="at">parameters.to.save =</span> params, <span class="at">model.file =</span> filename,</span>
<span id="cb18-11"><a href="#cb18-11" tabindex="-1"></a>                <span class="at">n.chains =</span> <span class="dv">3</span>, <span class="at">n.iter =</span> <span class="dv">20000</span>, <span class="at">n.burnin =</span> <span class="dv">5000</span>, <span class="at">n.thin =</span> <span class="dv">10</span>, <span class="at">DIC =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## 
## Processing function input....... 
## 
## Done. 
##  
## Compiling model graph
##    Resolving undeclared variables
##    Allocating nodes
## Graph information:
##    Observed stochastic nodes: 200
##    Unobserved stochastic nodes: 14
##    Total graph size: 1024
## 
## Initializing model
## 
## Adaptive phase..... 
## Adaptive phase complete 
##  
## 
##  Burn-in phase, 5000 iterations x 3 chains 
##  
## 
## Sampling from joint posterior, 15000 iterations x 3 chains 
##  
## 
## Calculating statistics....... 
## 
## Done.</code></pre>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="co"># Display the fitted model</span></span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a>fit_lm3</span></code></pre></div>
<pre><code>## JAGS output for model &#39;JAGS.txt&#39;, generated by jagsUI.
## Estimates based on 3 chains of 20000 iterations,
## adaptation = 100 iterations (sufficient),
## burn-in = 5000 iterations and thin rate = 10,
## yielding 4500 total samples from the joint posterior. 
## MCMC ran for 0.119 minutes at time 2023-11-14 08:22:48.075573.
## 
##           mean     sd   2.5%    50%  97.5% overlap0     f  Rhat n.eff
## alpha   24.915 10.079  2.938 26.011 41.351    FALSE 0.986 1.001  2144
## beta     9.923  0.349  9.220  9.930 10.589    FALSE 1.000 1.001  3972
## sigma    4.586  0.237  4.163  4.575  5.080    FALSE 1.000 1.000  4500
## sigma_a 30.090 12.129 14.394 27.514 61.154    FALSE 1.000 1.002  4500
## 
## Successful convergence based on Rhat values (all &lt; 1.1). 
## Rhat is the potential scale reduction factor (at convergence, Rhat=1). 
## For each parameter, n.eff is a crude measure of effective sample size. 
## 
## overlap0 checks if 0 falls in the parameter&#39;s 95% credible interval.
## f is the proportion of the posterior with the same sign as the mean;
## i.e., our confidence that the parameter is positive or negative.</code></pre>
<div id="questions-to-answer-2" class="section level4">
<h4>Questions to answer:</h4>
<ul>
<li><p>Examine the potential scale reduction factor (Rhat) for each
parameter. What does an Rhat value close to 1 indicate about the
convergence of the chains? In the context of this analysis, how would
you interpret the Rhat values for “alpha,” “beta,” “sigma,” and
“sigma_a”? Discuss whether these Rhat values suggest convergence and the
implications for the reliability of the parameter estimates.</p></li>
<li><p>Consider the distribution of the random intercepts (a[j]) for
each site. How might the variability in these intercepts impact the
overall model’s ability to capture site-specific effects on body mass?
Discuss whether the model adequately represents the heterogeneity among
sites, and propose any potential modifications to the model structure to
better account for site-specific characteristics influencing body
mass.</p></li>
<li><p>Investigate the autocorrelation structure within the MCMC chains.
How would you assess the autocorrelation of the parameter “beta” over
the course of the iterations? If autocorrelation is detected, discuss
the potential consequences for the precision of the parameter estimate
and suggest strategies to address or mitigate autocorrelation in the
MCMC sampling process.</p></li>
</ul>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
