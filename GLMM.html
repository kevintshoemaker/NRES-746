<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Hayley Reid, Ivan Provinciato, Jessica Buelow" />


<title>Generalized linear mixed-effects models (GLMM) in R and JAGS</title>

<script src="site_libs/header-attrs-2.24/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cerulean.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #204a87; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #204a87; font-weight: bold; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #ce5c00; font-weight: bold; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>







<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">NRES 746</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Schedule
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="schedule.html">Course Schedule</a>
    </li>
    <li>
      <a href="Syllabus.pdf">Syllabus</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Lectures
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="INTRO.html">Introduction to NRES 746</a>
    </li>
    <li>
      <a href="LECTURE1.html">Why focus on algorithms?</a>
    </li>
    <li>
      <a href="LECTURE2.html">Working with probabilities</a>
    </li>
    <li>
      <a href="LECTURE3.html">The Virtual Ecologist</a>
    </li>
    <li>
      <a href="LECTURE4.html">Likelihood</a>
    </li>
    <li>
      <a href="LECTURE5.html">Optimization</a>
    </li>
    <li>
      <a href="LECTURE6.html">Bayesian #1: concepts</a>
    </li>
    <li>
      <a href="LECTURE7.html">Bayesian #2: mcmc</a>
    </li>
    <li>
      <a href="LECTURE8.html">Model Selection</a>
    </li>
    <li>
      <a href="LECTURE9.html">Performance Evaluation</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Lab exercises
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="LAB_Instructions.html">Instructions for Labs</a>
    </li>
    <li>
      <a href="LAB3demo.html">Lab 3: Likelihood (intro)</a>
    </li>
    <li>
      <a href="LAB5.html">Lab 5: Model selection (optional)</a>
    </li>
    <li>
      <a href="FigureDemo.html">Demo: Figures in R</a>
    </li>
    <li>
      <a href="GIT_tutorial.html">Demo: version control in Git</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Student led topics
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="GLMM.html">GLMMs</a>
    </li>
    <li>
      <a href="LECTURE10.html">Machine learning</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Data sets
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="TreeData.csv">Tree Data</a>
    </li>
    <li>
      <a href="ReedfrogPred.csv">Reed Frog Predation Data</a>
    </li>
    <li>
      <a href="ReedfrogFuncresp.csv">Reed Frog Func Resp</a>
    </li>
  </ul>
</li>
<li>
  <a href="Links.html">Links</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Generalized linear mixed-effects models
(GLMM) in R and JAGS</h1>
<h4 class="author">Hayley Reid, Ivan Provinciato, Jessica Buelow</h4>

</div>


<p>These are the necessary packages we need to run the analysis in this
code.</p>
<p>Here is the code for the lecture in case you want to follow along: <a
href="GLMM.R">GLMM.R</a></p>
<div id="first-things-first-what-are-linear-models"
class="section level2">
<h2>First things first: what are linear models?</h2>
<p>A linear model, or linear regression model, is a model that is used
to predict the value of a dependent variable given the value of an
independent variable. This relationship is represented by a straight
line with a slope and an intercept. Linear regression is relatively
easy, and provides a pretty intuitive output. However, linear models
have some assumptions: continuous variables, normal distribution,
constant variance, and a linear relationship between variables. As such,
there are limitations to linear models. Generalized linear models, on
the other hand, often do not have these limitations.</p>
</div>
<div id="so-what-is-a-generalized-linear-model" class="section level2">
<h2>So, what is a generalized linear model?</h2>
<p>Generalized linear models (GLMs) are regression models that allow us
to express the relationship between the predictors and response
variable, even when they are non-linear, by using a data distribution
and a link function to transform the data. Different link functions can
be used for different distributions of the data, such as “identity” for
normal distribution (an example of linear regression, which is
technically a type of GLM), “log link” for poisson distribution, or
“logit link” for binomial distribution. GLMs also do not require the
variables to be continuous. A common example of a GLM is logistic
regression, which is used with a binomial or bernoulli data
distribution, and a logit function for the link. Below is an
illustration of logistic regression used to represent the relationship
between how many hours students spent studying and whether they passed
or failed an exam (Canley, Wikipedia).</p>
<p><img src="figure1.png" width="100%" /></p>
<p>Let’s get a little more complicated. What, then, is a generalized
linear mixed effect model?</p>
</div>
<div id="what-are-mixed-effect-models" class="section level2">
<h2>What are mixed effect models?</h2>
<p>In any model, we are going to have response and explanatory
(predictor) variables. Usually, predictor variables will only explain
some of the variation that occurs in the response variable. Especially
when we are talking about field studies, it is impossible to collect and
control all variables that might influence the response. For example,
imagine that we want to understand whether and how a certain
hematological parameter in a bird population changes through the year.
There are some variables that can directly affect hematological
parameters, such as food availability, weather conditions and bird
dehydration and these variables are sometimes difficult to collect.</p>
<p>One way to dilute this problem is to increase the number of captured
birds, since more data can usually lead to better conclusions. On the
other hand, among these birds we can have recaptures and birds with
different ages (which is known to also change hematological parameters
as well). Thus, more data will also lead to more variation and
uncertainty. Even though we expect hematological parameters to vary
according to a certain pattern in a bird population, it will not be the
same for all individuals, since they have different diets, different
levels of dominance, different workloads; also, blood parameters vary
according to the time of the day, dehydration level, etc. Furthermore,
when we think in recaptures, it is expected that parameters from the
same bird will be more alike than parameters from different birds.</p>
<p>Although recaptures can increase the number of individuals measured,
it violates the independence of observations that is one of the main
assumptions of a linear regression. Thus, besides the fixed effect
(variation through the year) there is a random effect (individual
variation) occurring in these hematological parameters.</p>
<p>While collecting our data, it is virtually impossible to get enough
information or understand how these random effects will affect our
model. However, there are statistical procedures that we can use that
not only take into account these random effects, but also make it
possible to analyze this kind of collected data. These models that have
both kinds of effects are known as mixed effect models.</p>
</div>
<div id="when-to-use-a-mixed-effect-model" class="section level2">
<h2>When to use a mixed effect model?</h2>
<p>Although the answer for this question seems to be very simple,
identifying random effects within our data is not an easy task. First
thing to bear in mind is that a continuous variable cannot be a random
effect! Moreover, random effects can affect not just the intercept in
our models, but also the slope and understanding how and when to use
these statistical approaches is key to use mixed effect models in the
right way. We believe that the best way to understand the concept is
with some hypothetical examples. Let’s imagine that we are going to
capture and get hematological parameters, such as hemoglobin
concentration, from a certain bird species during a whole year.</p>
<p>For the purpose of this example, we are only going to get parameters
from males, not females. Our main goal is to understand whether birds
make physiological adjustments and the reason for it. To capture these
birds, we are going to use mist nests, which means that we are going to
collect blood samples from every single male bird that we capture. Once
we can’t control the birds that are going to be captured and since we
are going to focus on only one population, some birds are going to be
recaptured at some points during the year and these recaptures can occur
at any time: next day, week, month, etc. As we already know, repeated
measures from the same individuals will not be independent, since they
are not true replicates, but pseudoreplicates instead.</p>
<p>From a previous behavioral study, we know that dominant males will
have access to better resources during the whole year: better food,
better and larger territories and better females. Although we know that
to be dominant these males need to be bigger, there is not a known
variable that we can collect to be 100% sure that one individual is
dominant or not. We expect that hemoglobin levels are going to increase
during the breeding season, since males will be more active to protect
their territories, protect females and rear chicks for all birds.
However, will it increase in the same way for both dominants and “less
dominant” males?</p>
<p>Let’s identify our variables for this example: our response variable
is going to be the “hemoglobin” of the birds, while our predictor
(fixed) variable is going to be “the 4 seasons of the year”. Note: we
might have recaptures! Since dominant and less dominant birds might
differ in their baseline levels, giving each bird a different intercept,
considering the individual ID can help with this as well. One more thing
we need to consider: we know that hemoglobin might change in spite of
dominance level; but will it change in exactly the same way for
dominants and less dominants? If this is true, not just the intercept,
but the slope might be under a random effect as well.</p>
<p>In the lab portion, you will have the chance to work with this
hypothetical example and see if you considered the right variable(s) as
a random effect! Furthermore, in the demo we are going to show in the
class we are going to see how the model treats the predictors
differently for fixed and random effects.</p>
</div>
<div id="packages-available-in-r" class="section level2">
<h2>Packages available in R</h2>
<p>There are some different packages available in R to use for mixed
effects models. “lme4”, “lmerTest”, “nlme”, and “glmmTMB” are the ones
that can be utilized.</p>
<p>For instance, using the “lmerTest” package, this is the syntax you
need to use when you have a:</p>
<div id="random-intercept" class="section level4">
<h4>Random intercept</h4>
<p>Random_intercept &lt;- lmer(Response ~ Fixed_Predictor +
(1|Random_Predictor), data = data, REML = FALSE);</p>
</div>
<div id="random-non-fixed-slope-and-intercept-model"
class="section level4">
<h4>Random (non-fixed) slope and intercept model:</h4>
<p>Random_intercept&amp;slope &lt;- lmer(Response ~ Fixed_Predictor +
(1+ Fixed_Predictor|Random_Predictor), data = data, REML = FALSE) obs:
REML = FALSE is to give the likelihood values.</p>
</div>
</div>
<div id="description-of-data" class="section level2">
<h2>Description of data</h2>
<p>Marine benthic data comes from Zuur et al. (2007).</p>
</div>
<div id="details-of-data" class="section level2">
<h2>Details of data</h2>
<p>Marine benthic data from nine inter-tidal areas along the Dutch
coast. The data were collected by the Dutch institute RIKZ in the summer
of 2002. In each inter-tidal area (denoted by ‘beach’), five samples
were taken, and the macro-fauna and abiotic variables were measured.</p>
<p>Sample: sample number Richness: species richness Exposure: index
composed of the surf zone, slope, grain size, and depth of anaerobic
layer NAP: height of sampling station compared to mean tidal level
Beach: beach identifier</p>
<div id="rikz-dataset" class="section level3">
<h3>Rikz dataset</h3>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="do">### RIKZ dataset-----------------</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="co">#as described in Zuur et al. (2007) and Zuur et al. (2009)</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="do">##download data to follow along:</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>rikz_data <span class="ot">&lt;-</span> <span class="st">&quot;https://uoftcoders.github.io/rcourse/data/rikz_data.txt&quot;</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="fu">download.file</span>(rikz_data, <span class="st">&quot;rikz_data.txt&quot;</span>)</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>rikz_data <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;rikz_data.txt&quot;</span>, <span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">sep=</span><span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="do">### Data exploration-------------------------</span></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a><span class="fu">str</span>(rikz_data)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    45 obs. of  5 variables:
##  $ Richness: int  11 10 13 11 10 8 9 8 19 17 ...
##  $ Exposure: int  10 10 10 10 10 8 8 8 8 8 ...
##  $ NAP     : num  0.045 -1.036 -1.336 0.616 -0.684 ...
##  $ Beach   : int  1 1 1 1 1 2 2 2 2 2 ...
##  $ Site    : int  1 2 3 4 5 1 2 3 4 5 ...</code></pre>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>rikz_data<span class="sc">$</span>Beach <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(rikz_data<span class="sc">$</span>Beach)</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="fu">str</span>(rikz_data)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    45 obs. of  5 variables:
##  $ Richness: int  11 10 13 11 10 8 9 8 19 17 ...
##  $ Exposure: int  10 10 10 10 10 8 8 8 8 8 ...
##  $ NAP     : num  0.045 -1.036 -1.336 0.616 -0.684 ...
##  $ Beach   : Factor w/ 9 levels &quot;1&quot;,&quot;2&quot;,&quot;3&quot;,&quot;4&quot;,..: 1 1 1 1 1 2 2 2 2 2 ...
##  $ Site    : int  1 2 3 4 5 1 2 3 4 5 ...</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="fu">head</span>(rikz_data)</span></code></pre></div>
<pre><code>##   Richness Exposure    NAP Beach Site
## 1       11       10  0.045     1    1
## 2       10       10 -1.036     1    2
## 3       13       10 -1.336     1    3
## 4       11       10  0.616     1    4
## 5       10       10 -0.684     1    5
## 6        8        8  1.190     2    1</code></pre>
<p>We have encoded ‘Beach’ as a factor, which will facilitate plotting
and its use as a random effect downstream.</p>
<p>Let’s perform a linear regression to examine the relationship between
species richness and NAP, pooling data across all beaches.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="do">### Run basic linear model using all of the data--------------------</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>basic.lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(Richness<span class="sc">~</span> NAP, <span class="at">data =</span> rikz_data)</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a><span class="fu">summary</span>(basic.lm)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = Richness ~ NAP, data = rikz_data)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -5.0675 -2.7607 -0.8029  1.3534 13.8723 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   6.6857     0.6578  10.164 5.25e-13 ***
## NAP          -2.8669     0.6307  -4.545 4.42e-05 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 4.16 on 43 degrees of freedom
## Multiple R-squared:  0.3245, Adjusted R-squared:  0.3088 
## F-statistic: 20.66 on 1 and 43 DF,  p-value: 4.418e-05</code></pre>
<p>Based on the model output provided, it appears that there is a
significant negative association between NAP and species richness
(Estimate &lt; 0). Let’s visualize this relationship by creating a
plot.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a><span class="co"># Plot relationship from above model</span></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="fu">ggplot</span>(rikz_data, <span class="fu">aes</span>(<span class="at">x =</span> NAP, <span class="at">y =</span> Richness)) <span class="sc">+</span></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>) <span class="sc">+</span></span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula = &#39;y ~ x&#39;</code></pre>
<p><img src="GLMM_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p>Before placing confidence in this outcome, it’s important to verify
whether the assumptions of the linear regression are satisfied.</p>
<p>We can achieve this by plotting the residuals against the fitted
values to assess homogeneity and independence, as well as creating a
QQ-plot to examine normality</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="co"># Check assumptions.</span></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a><span class="fu">plot</span>(basic.lm)</span></code></pre></div>
<p><img src="GLMM_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p>The first and third panels show a violation of the homogeneity
assumption, with increasing residual variance at higher fitted values.
Panel 2 suggests non-normality, indicated by points deviating from the
dotted line. Despite these compromised assumptions, we’ll disregard
these violations to better illustrate mixed-effects modeling strategies
on untransformed data.</p>
</div>
</div>
<div id="non-independence-of-observations" class="section level2">
<h2>Non-independence of observations</h2>
<p>The species richness data come from multiple sites across various
beaches. Although each beach may demonstrate independence, sites within
a given beach likely share similar species richness due to their
proximity, indicating nested data. This nesting is a result of the
experimental design, specifically the decision to sample five sites
within each beach, rather than an inherent property of the data.</p>
<p>To visually depict the non-independence of observations within the
same beach, we can create a figure similar to the one above, with
clusters differentiated by beach (each beach represented by a different
color).</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="co"># Function to find polygons</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>find_hull <span class="ot">&lt;-</span> <span class="cf">function</span>(df) df[<span class="fu">chull</span>(df<span class="sc">$</span>Richness, df<span class="sc">$</span>NAP), ]</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a><span class="co"># Identify polygons in data</span></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a><span class="fu">library</span>(plyr)</span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a>hulls <span class="ot">&lt;-</span> <span class="fu">ddply</span>(rikz_data, <span class="st">&quot;Beach&quot;</span>, find_hull)</span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a><span class="fu">ggplot</span>(rikz_data, <span class="fu">aes</span>(<span class="at">x =</span> NAP, <span class="at">y =</span> Richness, <span class="at">colour =</span> Beach)) <span class="sc">+</span></span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb12-13"><a href="#cb12-13" tabindex="-1"></a>  <span class="fu">scale_colour_brewer</span>(<span class="at">palette=</span><span class="st">&quot;Set1&quot;</span>) <span class="sc">+</span></span>
<span id="cb12-14"><a href="#cb12-14" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette=</span><span class="st">&quot;Set1&quot;</span>) <span class="sc">+</span></span>
<span id="cb12-15"><a href="#cb12-15" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="at">data=</span>hulls, <span class="fu">aes</span>(<span class="at">fill =</span> Beach), <span class="at">alpha =</span> <span class="fl">0.2</span>)</span></code></pre></div>
<p><img src="GLMM_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>Observations from the same beach usually group together. In an
independent scenario, these groups would completely overlap. However, in
reality, observations within a specific beach are more similar to each
other than to observations from other beaches. It’s crucial to consider
and manage this non-independence in our modeling approach.</p>
</div>
<div id="accounting-for-non-independence" class="section level2">
<h2>Accounting for non-independence</h2>
<p>To deal with this non-independence, we could analyze each beach
separately. However, this is limited by a small sample size (only 5
points per analysis) and the requirement for multiple tests, increasing
the risk of getting false significant results by chance. This method is
not ideal. Instead, a better approach is to include a term for the beach
directly in our model, enabling us to estimate its effects more
reliably.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a>basic.lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(Richness <span class="sc">~</span> NAP <span class="sc">+</span> Beach, <span class="at">data =</span> rikz_data)</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="fu">summary</span>(basic.lm)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = Richness ~ NAP + Beach, data = rikz_data)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -4.8518 -1.5188 -0.1376  0.7905 11.8384 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   9.8059     1.3895   7.057 3.22e-08 ***
## NAP          -2.4928     0.5023  -4.963 1.79e-05 ***
## Beach2        3.0781     1.9720   1.561  0.12755    
## Beach3       -6.4049     1.9503  -3.284  0.00233 ** 
## Beach4       -6.0329     2.0033  -3.011  0.00480 ** 
## Beach5       -0.8983     2.0105  -0.447  0.65778    
## Beach6       -5.2231     1.9682  -2.654  0.01189 *  
## Beach7       -5.4367     2.0506  -2.651  0.01196 *  
## Beach8       -4.5530     1.9972  -2.280  0.02883 *  
## Beach9       -3.7820     2.0060  -1.885  0.06770 .  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 3.06 on 35 degrees of freedom
## Multiple R-squared:  0.7025, Adjusted R-squared:  0.626 
## F-statistic: 9.183 on 9 and 35 DF,  p-value: 5.645e-07</code></pre>
<p>The model estimates a unique effect for each beach, using up 8
degrees of freedom. While this didn’t significantly change our
understanding of NAP’s impact on richness (which remains negative and
significant), adding more terms could affect the interpretation of other
aspects in the model. Even though these beaches are a random subset, we
still need to consider the non-independence of observations within
beaches, making random effects important.</p>
</div>
<div id="random-effect-models-random-intercept" class="section level2">
<h2>Random-effect models: Random intercept</h2>
<p>We want to avoid using 8 degrees of freedom for the ‘Beach’ term in
our model. Yet, we still need to estimate the variance among beaches and
consider the non-independence of sites within them. To do this, we can
treat ‘Beach’ as a random effect while keeping ‘NAP’ as a fixed effect.
This way, we establish a unique y-intercept for each beach (Richness at
NAP = 0) and calculate the variance around this intercept. A small
variance suggests little variability per beach, while a large variance
indicates the opposite. We can implement this approach using
mixed-effects models with the lmer function from the lme4 R package and
obtain parameter estimates using the lmerTest package.</p>
<p>The question we are now asking is: <em>What is the influence of NAP
on species richness while accounting for variation within
beaches?</em></p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="co"># Random intercept model with NAP as fixed effect and Beach as random effect</span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a><span class="fu">library</span>(lme4)</span></code></pre></div>
<pre><code>## Loading required package: Matrix</code></pre>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a>mixed_model_IntOnly <span class="ot">&lt;-</span> <span class="fu">lmer</span>(Richness <span class="sc">~</span> NAP <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>Beach),</span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>                            <span class="at">data =</span> rikz_data, <span class="at">REML =</span> <span class="cn">FALSE</span>)</span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a><span class="fu">summary</span>(mixed_model_IntOnly)</span></code></pre></div>
<pre><code>## Linear mixed model fit by maximum likelihood  [&#39;lmerMod&#39;]
## Formula: Richness ~ NAP + (1 | Beach)
##    Data: rikz_data
## 
##      AIC      BIC   logLik deviance df.resid 
##    249.8    257.1   -120.9    241.8       41 
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -1.4258 -0.5010 -0.1791  0.2452  4.0452 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev.
##  Beach    (Intercept) 7.507    2.740   
##  Residual             9.111    3.018   
## Number of obs: 45, groups:  Beach, 9
## 
## Fixed effects:
##             Estimate Std. Error t value
## (Intercept)   6.5844     1.0321   6.380
## NAP          -2.5757     0.4873  -5.285
## 
## Correlation of Fixed Effects:
##     (Intr)
## NAP -0.164</code></pre>
<p>The term (1|Beach) represents the random effect, where ‘1’ signifies
a random-intercept model, and what follows the ‘|’ denotes a nominal
variable used as the random effect, in this case, ‘Beach.’ It’s crucial
to note that best practice recommends having at least 5 levels for
random effects, and fortunately, we meet this criterion with 9 levels
for ‘Beach.’</p>
<p>The output indicates that the model was fitted using maximum
likelihood, and parameters were estimated using the Satterthwaite
approximation. It provides AIC, BIC, and log-likelihood values specific
to this model.</p>
<p>An important part of the output details the estimated variance for
the random effects, showing that the variance linked to the ‘Beach’
effect is 7.507. In other words, differences between beaches contribute
to 45% of the residual variance after considering fixed effects. It’s
crucial to understand that the denominator here is the total variance,
including the sum of variance components from all random effects,
including residuals.</p>
<p>Finally, the output includes the fixed effect components of the
model, presenting separate intercept, slope, and P-value for the effect
of ‘NAP.’ We can now move on to visualize the fitted values for this
model.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="co"># Let&#39;s predict values based on our model and add these to our dataframe</span></span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a><span class="co"># These are the fitted values for each beach, which are modelled separately.</span></span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a>rikz_data<span class="sc">$</span>fit_InterceptOnly <span class="ot">&lt;-</span> <span class="fu">predict</span>(mixed_model_IntOnly)</span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a><span class="co"># Let&#39;s plot</span></span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a><span class="fu">ggplot</span>(rikz_data, <span class="fu">aes</span>(<span class="at">x =</span> NAP, <span class="at">y =</span> Richness, <span class="at">colour =</span> Beach)) <span class="sc">+</span></span>
<span id="cb19-7"><a href="#cb19-7" tabindex="-1"></a>  <span class="co"># Add fixed effect regression line (i.e. NAP)</span></span>
<span id="cb19-8"><a href="#cb19-8" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="fu">aes</span>(<span class="at">intercept =</span> <span class="st">`</span><span class="at">(Intercept)</span><span class="st">`</span>, <span class="at">slope =</span> NAP),</span>
<span id="cb19-9"><a href="#cb19-9" tabindex="-1"></a>              <span class="at">linewidth =</span> <span class="dv">2</span>,</span>
<span id="cb19-10"><a href="#cb19-10" tabindex="-1"></a>              <span class="fu">as.data.frame</span>(<span class="fu">t</span>(<span class="fu">fixef</span>(mixed_model_IntOnly)))) <span class="sc">+</span></span>
<span id="cb19-11"><a href="#cb19-11" tabindex="-1"></a>  <span class="co"># Add fitted values (i.e. regression) for each beach</span></span>
<span id="cb19-12"><a href="#cb19-12" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> fit_InterceptOnly), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb19-13"><a href="#cb19-13" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb19-14"><a href="#cb19-14" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb19-15"><a href="#cb19-15" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb19-16"><a href="#cb19-16" tabindex="-1"></a>  <span class="fu">scale_colour_brewer</span>(<span class="at">palette=</span><span class="st">&quot;Set1&quot;</span>)</span></code></pre></div>
<pre><code>## Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
## ℹ Please use `linewidth` instead.
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was
## generated.</code></pre>
<p><img src="GLMM_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<p>The thick black line shows the fitted values for the fixed-effect
part of the model. On the other hand, the thin colored lines depict the
fitted values for each beach, each with unique intercepts as expected.
If the estimated variance of the random effect increases, these lines
would spread more around the thick black line. When the variance is 0,
all the colored lines would precisely match the thick black line.</p>
</div>
<div id="random-effect-models-random-intercept-slope"
class="section level2">
<h2>Random-effect models: Random intercept-slope</h2>
<p>The previous model allows the intercept for each beach to change
around the overall population-level intercept. However, what if the
differences among beaches go beyond just the average richness, and how
richness responds to NAP varies on each beach? In standard regression
terms, this would mean adding NAP, Beach, and NAP x Beach effects to the
model. However, including these fixed effects would use up a lot of
degrees of freedom, and since we’ve already decided that differences
between beaches are not our main focus, this approach is not ideal.</p>
<p>Luckily, there’s another option. We can still consider variations in
how beaches react to NAP by using a random intercept-slope model.</p>
<p>We can fit the random intercept-slope model to these data using the
code below…</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="co"># Random intercept and slope model</span></span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a>mixed_model_IntSlope <span class="ot">&lt;-</span> <span class="fu">lmer</span>(Richness <span class="sc">~</span> NAP <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> NAP<span class="sc">|</span>Beach),</span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a>                             <span class="at">data =</span> rikz_data, <span class="at">REML =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## boundary (singular) fit: see help(&#39;isSingular&#39;)</code></pre>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="fu">summary</span>(mixed_model_IntSlope)</span></code></pre></div>
<pre><code>## Linear mixed model fit by maximum likelihood  [&#39;lmerMod&#39;]
## Formula: Richness ~ NAP + (1 + NAP | Beach)
##    Data: rikz_data
## 
##      AIC      BIC   logLik deviance df.resid 
##    246.7    257.5   -117.3    234.7       39 
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -1.7985 -0.3418 -0.1827  0.1749  3.1389 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev. Corr 
##  Beach    (Intercept) 10.949   3.309         
##           NAP          2.502   1.582    -1.00
##  Residual              7.174   2.678         
## Number of obs: 45, groups:  Beach, 9
## 
## Fixed effects:
##             Estimate Std. Error t value
## (Intercept)   6.5818     1.1883   5.539
## NAP          -2.8293     0.6849  -4.131
## 
## Correlation of Fixed Effects:
##     (Intr)
## NAP -0.810
## optimizer (nloptwrap) convergence code: 0 (OK)
## boundary (singular) fit: see help(&#39;isSingular&#39;)</code></pre>
<p>The model above allows for variations in both the starting point and
the slope of the relationship between Richness and NAP across different
beaches. The only difference is the addition of an extra variance
component in the random effects, which measures the variation in slopes
among beaches. It also includes a correlation term (Cor), estimating the
connection between the variations in starting points and slopes. A value
of -1 suggests that beaches with higher starting points also have more
noticeably negative slopes, as shown in the figure.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a>rikz_data<span class="sc">$</span>fit_IntSlope <span class="ot">&lt;-</span> <span class="fu">predict</span>(mixed_model_IntSlope)</span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a><span class="fu">ggplot</span>(rikz_data, <span class="fu">aes</span>(<span class="at">x =</span> NAP, <span class="at">y =</span> Richness, <span class="at">colour =</span> Beach)) <span class="sc">+</span></span>
<span id="cb25-3"><a href="#cb25-3" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="fu">aes</span>(<span class="at">intercept =</span> <span class="st">`</span><span class="at">(Intercept)</span><span class="st">`</span>, <span class="at">slope =</span> NAP),</span>
<span id="cb25-4"><a href="#cb25-4" tabindex="-1"></a>              <span class="at">size =</span> <span class="dv">2</span>,</span>
<span id="cb25-5"><a href="#cb25-5" tabindex="-1"></a>              <span class="fu">as.data.frame</span>(<span class="fu">t</span>(<span class="fu">fixef</span>(mixed_model_IntSlope)))) <span class="sc">+</span></span>
<span id="cb25-6"><a href="#cb25-6" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> fit_IntSlope), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb25-7"><a href="#cb25-7" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb25-8"><a href="#cb25-8" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb25-9"><a href="#cb25-9" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb25-10"><a href="#cb25-10" tabindex="-1"></a>  <span class="fu">scale_colour_brewer</span>(<span class="at">palette=</span><span class="st">&quot;Set1&quot;</span>)</span></code></pre></div>
<p><img src="GLMM_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
</div>
<div id="random-effects-only-model" class="section level2">
<h2>Random effects only model</h2>
<p>It’s important to recognize that specifying fixed effects is not
always mandatory, just as it is not always essential to specify random
effects.</p>
<p>For example, we could run the following model…</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a>mixed_model_NoFix <span class="ot">&lt;-</span> <span class="fu">lmer</span>(Richness <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>Beach),</span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a>                          <span class="at">data =</span> rikz_data, <span class="at">REML =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-3"><a href="#cb26-3" tabindex="-1"></a><span class="fu">summary</span>(mixed_model_NoFix)</span></code></pre></div>
<pre><code>## Linear mixed model fit by REML [&#39;lmerMod&#39;]
## Formula: Richness ~ 1 + (1 | Beach)
##    Data: rikz_data
## 
## REML criterion at convergence: 261.1
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -1.7797 -0.5070 -0.0980  0.2547  3.8063 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev.
##  Beach    (Intercept) 10.48    3.237   
##  Residual             15.51    3.938   
## Number of obs: 45, groups:  Beach, 9
## 
## Fixed effects:
##             Estimate Std. Error t value
## (Intercept)    5.689      1.228   4.631</code></pre>
<p>Now that we have outlined these three different models, how do we
decide which one to choose? After all, they all provide slightly
different estimates for the effects of NAP (assuming NAP is included)
and P-values.</p>
</div>
<div
id="great-you-have-models-now.-how-do-you-decide-which-one-is-the-best-with-model-selection-approaches."
class="section level2">
<h2>Great! You have models now. How do you decide which one is the best?
With model selection approaches.</h2>
<p>There are a few different ways to select a model. The most common
model selection approach is AIC (Akaike information criterion). As we
recently discussed in this class, AIC values represent the distance
between your model and the “true” model. AIC values are an estimate of
the amount of information lost by your model, so the lower the number
(relatively), the better. To estimate this, AIC balances the
goodness-of-fit and the simplicity of the model. A model with all of the
possible variables may be the “best” fit, but is not necessarily the
correct choice, as it could be overfitting the data. AIC takes this into
account by penalizing added variables in order to find the balance. AIC
values do not mean anything on their own, and should be used only for
comparison between models. You can compare AIC values of different
models in R using the AIC() function.</p>
<p>Another model selection approach is BIC (Bayesian information
criterion), which is very similar to AIC. Like AIC, the lower the BIC
value (relatively), the better. The difference between AIC and BIC is
that the penalty for added variables is greater for BIC, so simpler
models are even more favored with BIC than AIC. You can compare BIC
values in R using the BIC() function.</p>
<p>Finally, you could use a likelihood ratio test (LRT) for model
selection. The LRT can be used to compare the goodness of fit of two
models, generally a more complex model and a simpler model, which will
include some subset of the parameters in the more complex model, making
it a nested model. This approach is used to see if adding (or removing)
additional parameters makes the model a better fit. You can perform the
LRT manually, as we learned in this class, or you can use the lrtest()
function from the lmtest package. The output of this function will give
you a chi-squared test statistic, and a p-value. If the p-value is less
than your critical value (0.05, for example), the full model is a better
fit. If the p-value is more than the critical value, the full model and
nested model fit the data equally well, so you would want to use the
nested model, since it is more simple.</p>
</div>
<div id="model-selection" class="section level2">
<h2>Model selection</h2>
<p>We created three models:</p>
<p>A random intercept model featuring NAP as a fixed effect, with the
random effect enabling variability in the intercept (species richness)
across beaches. A random intercept and slope model, incorporating NAP as
a fixed effect, and allowing both the intercept (richness) and slope
(response of richness to NAP) to vary among beaches. An intercept-only
model with no fixed effects but permitting variation in richness across
beaches.</p>
<p>Given these three models, we might want to figure out which one fits
our observed data best, allowing us to interpret the model and make
inferences about our population.</p>
<p>Let’s create two models, this time adding an interaction between NAP
and Exposure as extra effects.</p>
<p>Start with a saturated model that includes all fixed effects and
their interactions, along with random effects. If including all fixed
effects is not practical, prioritize the ones you consider most crucial
based on your understanding of the system. Optimize the random-effect
structure of the model using the saturated model. Compare models with a
saturated fixed-effects structure to those with different random-effect
structures. Fit the models using Restricted Maximum Likelihood (REML =
TRUE) and determine the best random-effect structure by choosing the one
with the lowest AIC.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a><span class="co"># Define 2 models. Fit both with REML.</span></span>
<span id="cb28-2"><a href="#cb28-2" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" tabindex="-1"></a>mixed_model_IntOnly <span class="ot">&lt;-</span> <span class="fu">lmer</span>(Richness <span class="sc">~</span> NAP<span class="sc">*</span>Exposure <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>Beach), <span class="at">REML =</span> <span class="cn">TRUE</span>, </span>
<span id="cb28-4"><a href="#cb28-4" tabindex="-1"></a>                            <span class="at">data =</span> rikz_data)</span>
<span id="cb28-5"><a href="#cb28-5" tabindex="-1"></a>mixed_model_IntSlope <span class="ot">&lt;-</span> <span class="fu">lmer</span>(Richness <span class="sc">~</span> NAP<span class="sc">*</span>Exposure <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> NAP<span class="sc">|</span>Beach), <span class="at">REML =</span> <span class="cn">TRUE</span>, </span>
<span id="cb28-6"><a href="#cb28-6" tabindex="-1"></a>                             <span class="at">data =</span> rikz_data)</span></code></pre></div>
<pre><code>## boundary (singular) fit: see help(&#39;isSingular&#39;)</code></pre>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a><span class="fu">library</span>(MuMIn)</span>
<span id="cb30-2"><a href="#cb30-2" tabindex="-1"></a><span class="fu">AICc</span>(mixed_model_IntOnly, mixed_model_IntSlope)</span></code></pre></div>
<pre><code>##                      df     AICc
## mixed_model_IntOnly   6 235.2327
## mixed_model_IntSlope  8 237.2527</code></pre>
<p>The output suggests that using only a random intercept fits the data
better (resulting in a lower AICc). So, the best random-effect structure
includes only a random intercept for each beach, without adding a random
slope.</p>
<p>The next step is to adjust the model with the best random-effect
structure using Maximum Likelihood (ML) and compare different
fixed-effect structures. Let’s fit these models below and check their
AICcs.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a><span class="co"># Full model with both fixed effects and their interaction</span></span>
<span id="cb32-2"><a href="#cb32-2" tabindex="-1"></a>mixed_model_IntOnly_Full <span class="ot">&lt;-</span> <span class="fu">lmer</span>(Richness <span class="sc">~</span> NAP<span class="sc">*</span>Exposure <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>Beach), <span class="at">REML =</span> <span class="cn">FALSE</span>, </span>
<span id="cb32-3"><a href="#cb32-3" tabindex="-1"></a>                                 <span class="at">data =</span> rikz_data)</span></code></pre></div>
<pre><code>## boundary (singular) fit: see help(&#39;isSingular&#39;)</code></pre>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" tabindex="-1"></a><span class="co"># No interaction</span></span>
<span id="cb34-2"><a href="#cb34-2" tabindex="-1"></a>mixed_model_IntOnly_NoInter <span class="ot">&lt;-</span> <span class="fu">lmer</span>(Richness <span class="sc">~</span> NAP <span class="sc">+</span> Exposure <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>Beach), </span>
<span id="cb34-3"><a href="#cb34-3" tabindex="-1"></a>                                    <span class="at">REML =</span> <span class="cn">FALSE</span>, </span>
<span id="cb34-4"><a href="#cb34-4" tabindex="-1"></a>                                    <span class="at">data =</span> rikz_data)</span></code></pre></div>
<pre><code>## boundary (singular) fit: see help(&#39;isSingular&#39;)</code></pre>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" tabindex="-1"></a><span class="co"># No interaction or main effect of exposure</span></span>
<span id="cb36-2"><a href="#cb36-2" tabindex="-1"></a>mixed_model_IntOnly_NAP <span class="ot">&lt;-</span> <span class="fu">lmer</span>(Richness <span class="sc">~</span> NAP <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>Beach), </span>
<span id="cb36-3"><a href="#cb36-3" tabindex="-1"></a>                                <span class="at">REML =</span> <span class="cn">FALSE</span>, </span>
<span id="cb36-4"><a href="#cb36-4" tabindex="-1"></a>                                <span class="at">data =</span> rikz_data)</span>
<span id="cb36-5"><a href="#cb36-5" tabindex="-1"></a></span>
<span id="cb36-6"><a href="#cb36-6" tabindex="-1"></a><span class="co"># No interaction or main effect of NAP</span></span>
<span id="cb36-7"><a href="#cb36-7" tabindex="-1"></a>mixed_model_IntOnly_Exp <span class="ot">&lt;-</span> <span class="fu">lmer</span>(Richness <span class="sc">~</span> Exposure <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>Beach), </span>
<span id="cb36-8"><a href="#cb36-8" tabindex="-1"></a>                                <span class="at">REML =</span> <span class="cn">FALSE</span>, </span>
<span id="cb36-9"><a href="#cb36-9" tabindex="-1"></a>                                <span class="at">data =</span> rikz_data)</span>
<span id="cb36-10"><a href="#cb36-10" tabindex="-1"></a></span>
<span id="cb36-11"><a href="#cb36-11" tabindex="-1"></a><span class="co"># No fixed effects</span></span>
<span id="cb36-12"><a href="#cb36-12" tabindex="-1"></a>mixed_model_IntOnly_NoFix <span class="ot">&lt;-</span> <span class="fu">lmer</span>(Richness <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>Beach), </span>
<span id="cb36-13"><a href="#cb36-13" tabindex="-1"></a>                                  <span class="at">REML =</span> <span class="cn">FALSE</span>, </span>
<span id="cb36-14"><a href="#cb36-14" tabindex="-1"></a>                                  <span class="at">data =</span> rikz_data)</span>
<span id="cb36-15"><a href="#cb36-15" tabindex="-1"></a></span>
<span id="cb36-16"><a href="#cb36-16" tabindex="-1"></a></span>
<span id="cb36-17"><a href="#cb36-17" tabindex="-1"></a><span class="fu">AICc</span>(mixed_model_IntOnly_Full, mixed_model_IntOnly_NoInter,</span>
<span id="cb36-18"><a href="#cb36-18" tabindex="-1"></a>     mixed_model_IntOnly_NAP, mixed_model_IntOnly_Exp,</span>
<span id="cb36-19"><a href="#cb36-19" tabindex="-1"></a>     mixed_model_IntOnly_NoFix)</span></code></pre></div>
<pre><code>##                             df     AICc
## mixed_model_IntOnly_Full     6 236.5947
## mixed_model_IntOnly_NoInter  5 238.1467
## mixed_model_IntOnly_NAP      4 250.8291
## mixed_model_IntOnly_Exp      4 261.7996
## mixed_model_IntOnly_NoFix    3 269.8889</code></pre>
<p>From the output, it seems that the model including NAP, Exposure, and
their interaction provides the best fit to the data.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" tabindex="-1"></a><span class="co"># Summarize best-fit model</span></span>
<span id="cb38-2"><a href="#cb38-2" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">update</span>(mixed_model_IntOnly_Full, <span class="at">REML =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<pre><code>## Linear mixed model fit by REML [&#39;lmerMod&#39;]
## Formula: Richness ~ NAP * Exposure + (1 | Beach)
##    Data: rikz_data
## 
## REML criterion at convergence: 221
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -1.4138 -0.4394 -0.1063  0.1511  4.3635 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev.
##  Beach    (Intercept) 0.3063   0.5534  
##  Residual             8.7447   2.9571  
## Number of obs: 45, groups:  Beach, 9
## 
## Fixed effects:
##              Estimate Std. Error t value
## (Intercept)   40.7149     5.6164   7.249
## NAP          -13.5864     5.4298  -2.502
## Exposure      -3.3385     0.5485  -6.087
## NAP:Exposure   1.0625     0.5278   2.013
## 
## Correlation of Fixed Effects:
##             (Intr) NAP    Exposr
## NAP         -0.300              
## Exposure    -0.996  0.301       
## NAP:Exposur  0.302 -0.997 -0.306</code></pre>
</div>
<div id="interpret-model-output" class="section level2">
<h2>Interpret model output</h2>
<p>Summarizing the results, an increase in both NAP and Exposure is
associated with a decrease in species richness (P &lt; 0.05).
Additionally, there is an almost significant interaction between NAP and
Exposure. Even though Beach is included as a random effect, there is
minimal variation attributed to differences between beaches compared to
the previous model. The key difference is the inclusion of Exposure as a
fixed effect in the current model. This suggests that a significant part
of the variation observed among beaches in lecture 8 was likely
influenced by differences in exposure, now captured by the fixed
effects.</p>
</div>
<div
id="what-if-you-want-to-evaluate-your-model-on-its-own-not-compared-to-other-models"
class="section level2">
<h2>What if you want to evaluate your model on its own, not compared to
other models?</h2>
<p>It is a good idea to make sure your model is a good fit of the data
on its own. If you only compare it to other models, it could just be the
best-fit out of a bad bunch of models. A good way to evaluate your model
is with the DHARMa package in R. DHARMa uses your model to simulate
data, and compares this simulated data to the actual data, which is a
good way to see how well-fit the model is for the actual data. For
example, you can use the simulateResiduals() and testResiduals()
functions on your model to come up with plots like this (from the cran
DHARMa page).</p>
<p><img src="figure2.png" width="100%" /></p>
<p>On the left is a plot of the expected (simulated) and observed
(actual) values, which should have a relatively neat linear
relationship. In this example, they do. On the right is a plot of the
residuals for the predicted values based on the model, and we should
expect relatively even, straight, horizontal lines. This would appear to
be a pretty well-fit model. What does it look like when there are
problems with your model?</p>
<p><img src="figure3.png" width="100%" /></p>
<p>In these plots, we can see that there are problems, which DHARMa
highlights in red. These plots show signs of overdispersion, meaning
there is more variance in the data than expected based on the model, so
adjustments should be made to the model. A common type of overdispersion
is zero-inflation, when there are more zeros in the data than would be
expected given the model. If your model evaluation is showing signs of
overdispersion, you may want to check your data distribution - if you
haven’t already. The DHARMa package does have a special function for
testing zero-inflation: testZeroInflation(). This will give you a plot
of the expected distribution of zeros and actual distribution of
zeros.</p>
<p><img src="figure4.png" width="100%" /></p>
<p>A plot like this is an indication that you may want to use a
zero-inflated model.</p>
<p>Note: this isn’t everything the DHARMa package can do for you, but
rather covers some of the most common uses. Also, there isn’t a strict
rule for how to interpret these results. As stated in the DHARMa manual:
“DHARMa only flags a difference between the observed and expected data -
the user has to decide whether this difference is actually a problem for
the analysis!”</p>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
