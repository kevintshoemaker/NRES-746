<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Sonia Heckler, Everald Mclennon and Nick Miley" />


<title>Time Series Lab</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cerulean.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}

.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">NRES 746</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Schedule
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="schedule.html">Course Schedule</a>
    </li>
    <li>
      <a href="labschedule.html">Lab Schedule</a>
    </li>
    <li>
      <a href="Syllabus2.pdf">Syllabus</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Lectures
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="INTRO.html">Introduction to NRES 746</a>
    </li>
    <li>
      <a href="LECTURE1.html">Why focus on algorithms?</a>
    </li>
    <li>
      <a href="LECTURE2.html">Working with probabilities</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Lab exercises
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="LAB1.html">Lab 1: Algorithms in R</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Data sets
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="TreeData.csv">Tree Data</a>
    </li>
  </ul>
</li>
<li>
  <a href="Links.html">Links</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Time Series Lab</h1>
<h4 class="author"><em>Sonia Heckler, Everald Mclennon and Nick Miley</em></h4>

</div>


<div id="holt-winters-exponential-smoothing" class="section level1">
<h1>Holt-Winters Exponential Smoothing</h1>
<pre class="r"><code>library(tseries) #for base ts stuff</code></pre>
<pre><code>## Warning: package &#39;tseries&#39; was built under R version 3.3.2</code></pre>
<pre class="r"><code>library(forecast) #for holtz-winters stuff</code></pre>
<pre><code>## Warning: package &#39;forecast&#39; was built under R version 3.3.2</code></pre>
<pre><code>## Loading required package: zoo</code></pre>
<pre><code>## 
## Attaching package: &#39;zoo&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     as.Date, as.Date.numeric</code></pre>
<pre><code>## Loading required package: timeDate</code></pre>
<pre><code>## Warning: package &#39;timeDate&#39; was built under R version 3.3.2</code></pre>
<pre><code>## This is forecast 7.3</code></pre>
<pre class="r"><code>library(TTR)</code></pre>
<pre><code>## Warning: package &#39;TTR&#39; was built under R version 3.3.2</code></pre>
<pre class="r"><code>library(stats)


PPT_mth&lt;-read.csv(&quot;PRISM_ppt_1895-2015Mo2.csv&quot;, head=T, skip=10) 

#list(PPT_mth)
str(PPT_mth) # looking at the structure of the data</code></pre>
<pre><code>## &#39;data.frame&#39;:    876 obs. of  2 variables:
##  $ Date        : Factor w/ 876 levels &quot;1895-01&quot;,&quot;1895-02&quot;,..: 1 2 3 4 5 6 7 8 9 10 ...
##  $ ppt..inches.: num  2.35 0.96 0.31 0.12 1.32 0.61 5.73 3.52 1.99 1.74 ...</code></pre>
<pre class="r"><code>ts(PPT_mth$ppt..inches,start=c(1895,1), frequency =12, end=c(1968)) -&gt;pptimeseries # reading in the data in a time series format

str(pptimeseries) # looking at the structure of ppt</code></pre>
<pre><code>##  Time-Series [1:877] from 1895 to 1968: 2.35 0.96 0.31 0.12 1.32 0.61 5.73 3.52 1.99 1.74 ...</code></pre>
<pre class="r"><code>plot.ts(pptimeseries, main=&quot;Monthly precipitation&quot;, xlab=&quot;Years&quot;, ylab= &quot;Precipitation (inches)&quot;) # Plotting the timeseries</code></pre>
<p><img src="Time_Series_Lab_files/figure-html/unnamed-chunk-1-1.png" width="672" /></p>
<pre class="r"><code># Decomposition of the additive time series
pptimeseriescomponents&lt;-decompose(pptimeseries)


# Plotting the trend, seasonal and irregular(random) components
plot(pptimeseriescomponents)</code></pre>
<p><img src="Time_Series_Lab_files/figure-html/unnamed-chunk-1-2.png" width="672" /></p>
<pre class="r"><code>#Using HoltWinters to predict timeseries
HoltWinters(pptimeseries) -&gt; pptimeseries2 # predicting using HoltWinters() function
plot(pptimeseries2, lwd=2) # Plotting the forecast against the original data
legend(&quot;topleft&quot;, col=c(&quot;black&quot;,&quot;red&quot;), c(&quot;Observed&quot;, &quot;Fitted&quot;), lty=1,cex = 0.8)</code></pre>
<p><img src="Time_Series_Lab_files/figure-html/unnamed-chunk-1-3.png" width="672" /></p>
<pre class="r"><code># To make foreast for furture times not included in original time series
pptimeseries3 &lt;-forecast.HoltWinters(pptimeseries2, h=48) 
plot.forecast(pptimeseries3)</code></pre>
<p><img src="Time_Series_Lab_files/figure-html/unnamed-chunk-1-4.png" width="672" /></p>
<pre class="r"><code># Investigation whether the model can be improved upon


#auto-corrillation function
acf(pptimeseries3$residuals, na.action=na.pass, lag.max=20)</code></pre>
<p><img src="Time_Series_Lab_files/figure-html/unnamed-chunk-1-5.png" width="672" /></p>
<pre class="r"><code>#The in-sample forecast errors are stored in the named element &quot;residuals&quot; of the list variable returned by forecast.HoltWinters().
Box.test(pptimeseries3$residuals, lag=20, type=&quot;Ljung-Box&quot;)</code></pre>
<pre><code>## 
##  Box-Ljung test
## 
## data:  pptimeseries3$residuals
## X-squared = 19.883, df = 20, p-value = 0.4652</code></pre>
<pre class="r"><code># make a time plot to look at variance
plot.ts(pptimeseries3$residuals) </code></pre>
<p><img src="Time_Series_Lab_files/figure-html/unnamed-chunk-1-6.png" width="672" /></p>
<pre class="r"><code>na.remove(pptimeseries3$residuals) -&gt; PPT_S_R
# Function to check if errors are normally distributed
plotForecastErrors &lt;- function(PPT_S_R)
{

  # make a histogram of the forecast errors:
  mybinsize &lt;- IQR(PPT_S_R)/4
  mysd   &lt;- sd(PPT_S_R)
  mymin  &lt;- min(PPT_S_R) - mysd*5
  mymax  &lt;- max(PPT_S_R) + mysd*3
  
# generate normally distributed data with mean 0 and standard deviation mysd
  
  mynorm &lt;- rnorm(10000, mean=0, sd=mysd)
  mymin2 &lt;- min(mynorm)
  mymax2 &lt;- max(mynorm)
  if (mymin2 &lt; mymin) { mymin &lt;- mymin2 }
  if (mymax2 &gt; mymax) { mymax &lt;- mymax2 }

# make a red histogram of the forecast errors, with the normally distributed data overlaid:
  
  mybins &lt;- seq(mymin, mymax, mybinsize)
  hist(PPT_S_R, col=&quot;red&quot;, freq=FALSE, breaks=mybins)
  
# freq=FALSE ensures the area under the histogram = 1
# generate normally distributed data with mean 0 and standard deviation mysd
  myhist &lt;- hist(mynorm, plot=FALSE, breaks=mybins)
# plot the normal curve as a blue line on top of the histogram of forecast errors:
  points(myhist$mids, myhist$density, type=&quot;l&quot;, col=&quot;blue&quot;, lwd=2)
}

# make a histogram
plotForecastErrors(PPT_S_R) </code></pre>
<p><img src="Time_Series_Lab_files/figure-html/unnamed-chunk-1-7.png" width="672" /></p>
<div id="questions" class="section level3">
<h3>Questions</h3>
<ol style="list-style-type: decimal">
<li><p>Run this code with the temperature dataset attached and pay attention to the forecast confidence intervals. Why does it perform better than it did on the precipitation dataset?</p></li>
<li><p>Try to run scale() or BoxCox.lambda() to transform data to non-negative forecast values.</p></li>
<li><p>Is Holt-Winter appropriate for forecasting with non-negative value data sets? Why or why not.</p></li>
</ol>
</div>
</div>
<div id="arima" class="section level1">
<h1>ARIMA</h1>
<p>Two Parts</p>
<ol style="list-style-type: decimal">
<li><p>Autoregressive Model (AR): It creates a regression model using previous values from the time series. It applies a “moving window” where the response of the previous predictor data becomes the predictor data for the next group.</p></li>
<li><p>Moving Average (MA): A smoothing technique to reduce the effects of random variation.</p></li>
<li><p>(Can also have a seasonal component.)</p></li>
</ol>
<div id="box-jenkins-univariate-model" class="section level3">
<h3>Box-Jenkins Univariate Model</h3>
<ul>
<li>Assumes stationarity</li>
<li>NO trend, inconsistent variance and seasonality (although seasonality can sometimes be included)</li>
<li>Very flexible</li>
<li>Building a good ARIMA requires statistical experience (be dangerous?)</li>
</ul>
</div>
<div id="terms-in-the-model" class="section level3">
<h3>Terms in the Model</h3>
<ul>
<li>Difference operators</li>
<li>Autoregressive terms</li>
<li>Moving Average Terms</li>
<li>Seasonal Difference operators</li>
<li>Seasonal Autoregressive terms</li>
<li>Seasonal Moving Average</li>
</ul>
<p>*As with all models, only include the necessary terms</p>
</div>
<div id="building-an-arima-with-the-keeling-curve" class="section level3">
<h3>Building an ARIMA with the Keeling curve</h3>
<pre class="r"><code>data(co2)
str(co2)</code></pre>
<pre><code>##  Time-Series [1:468] from 1959 to 1998: 315 316 316 318 318 ...</code></pre>
<pre class="r"><code>plot(co2)</code></pre>
<p><img src="Time_Series_Lab_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
</div>
<div id="trend" class="section level3">
<h3>Trend?</h3>
<p>Autocorrelation Plot</p>
<p><img src="Time_Series_Lab_files/figure-html/pressure-1.png" width="672" /></p>
<p>Yes, there is a trend.</p>
</div>
<div id="if-trend" class="section level3">
<h3>If trend…</h3>
<p>Differencing (ie. subtracting mean) or fitting a curve and subtracting the fitted values</p>
<p>detrend(): computes the least-squares fit of a straight line to the data and subtracts the resulting function from the data.</p>
<pre class="r"><code># subtracting yearly mean
yearlymean &lt;- ave(co2, gl(39, 12), FUN = mean)
co2.dt &lt;- co2 - yearlymean

# blackbox way to do it but not necessary
# co2.dt &lt;- pracma::detrend(co2.m, tt = &quot;constant&quot;)
# co2.dt &lt;- ts(as.numeric(co2.dt), start = c(1959, 1), frequency = 12)
# will get the same result as above</code></pre>
</div>
<div id="detrended" class="section level3">
<h3>Detrended</h3>
<pre class="r"><code>plot(co2.dt)</code></pre>
<p><img src="Time_Series_Lab_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
</div>
<div id="seasonality" class="section level3">
<h3>Seasonality?</h3>
<p>Seasonal Subseries Plot</p>
<pre class="r"><code>monthplot(co2.dt, ylab = &quot;data&quot;)</code></pre>
<p><img src="Time_Series_Lab_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p>Autocorrelation Plot</p>
<pre class="r"><code>acf(co2.dt, type = &quot;correlation&quot;)</code></pre>
<p><img src="Time_Series_Lab_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>Yes, there is seasonality.</p>
</div>
<div id="if-seasonality" class="section level3">
<h3>If Seasonality…</h3>
<p>Seasonal differencing</p>
<p>diff(): takes timeseries (ts), applies a given lag and returns lagged differences for each value in the timeseries.</p>
<pre class="r"><code># differencing once
co2.dt.dif &lt;- diff(co2.dt,lag = 12)
plot(co2.dt.dif)</code></pre>
<p><img src="Time_Series_Lab_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>Check diagnostic plots again.</p>
<p>Seasonal Subseries Plot</p>
<pre class="r"><code>monthplot(co2.dt.dif, ylab = &quot;data&quot;)</code></pre>
<p><img src="Time_Series_Lab_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>Autocorrelation Plot: Still some seasonality showing up in this plot</p>
<pre class="r"><code>acf(co2.dt.dif, type = &quot;correlation&quot;)</code></pre>
<p><img src="Time_Series_Lab_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<p>Based on the autocorrelation plot, model will need a seasonal component to address strong seasonality with differencing.</p>
<p>CAVEAT: Be judicious with differencing more than once, you can run into issues of over correcting.</p>
</div>
<div id="unequal-variance" class="section level3">
<h3>Unequal variance?</h3>
<p>This dataset has equal variance.</p>
</div>
<div id="if-unequal-variance" class="section level3">
<h3>If unequal variance…</h3>
<p>Use natural log transformation</p>
</div>
<div id="another-option-in-r-for-diagnosing-data" class="section level3">
<h3>Another option in R for diagnosing data</h3>
<p>Seasonal Trend Decomposition using loess</p>
<p>Loess: a non-parametric regression method using multiple regression models, k-nearest-neighbor-based meta-model</p>
<p>stl(): Decomposes time series into seasonal, trend and irregular components using loess</p>
<pre class="r"><code>co2.stl &lt;- stl(co2,s.window = &quot;periodic&quot;)
plot(co2.stl)</code></pre>
<p><img src="Time_Series_Lab_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<pre class="r"><code># black box?</code></pre>
</div>
<div id="choose-an-arima-model" class="section level3">
<h3>Choose an ARIMA Model</h3>
<p>Assess the shape of the autocorrelation or partial autocorrelation plots to determine model.</p>
<p>Exponential decay to 0: autoregressive model Alternating + &amp; - decay to 0: autoregressive model One or more spikes with the rest essentially at 0: moving average model Decay starts after a few lags: mixed autoregressive and moving average model All 0 or close to 0: data are random High values at fixed intervals: add seasonal autoregressive term No decay to 0: Series is not stationary</p>
<p>Based on the autocorrelation plot…</p>
<pre class="r"><code>acf(co2.dt.dif, type = &quot;correlation&quot;)</code></pre>
<p><img src="Time_Series_Lab_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<p>ARIMA model with possible seasonal autocorrelation</p>
<p>Syntax looks like: AR(1) with seasonal AR(12) The autoregression term has a lag of 1 because that is when the autocorrelation plot drops off, and seasonal autocorrelation has a lag of 12 because the seasonality is a 12 month cycle.</p>
</div>
<div id="arima-1" class="section level3">
<h3>ARIMA</h3>
<p>In base R:</p>
<p>arima(): fit an ARIMA model to a timeseries dataset</p>
<p>arima0(): same as arima() with the added ability to use the predict() function to predict values out into the future</p>
<pre class="r"><code># ARIMA(1,0,0)[12]
# without seasonality on fully differenced data
results &lt;- arima0(co2.dt.dif, order = c(1,0,0), include.mean = FALSE)
# exclude mean because estimation of mean is 0, since mean was taken out in the detrending

# ARIMA(1,0,0)(0,1,1)[12]
# with seasonality on detrended data with seasonality
resultsseason &lt;- arima0(co2.dt, order = c(1,0,0), seasonal = c(0,1,1), include.mean = FALSE)
# order and season = c(p,d,q) c(AR, degree of differencing, MA order)

results</code></pre>
<pre><code>## 
## Call:
## arima0(x = co2.dt.dif, order = c(1, 0, 0), include.mean = FALSE)
## 
## Coefficients:
##          ar1
##       0.3663
## s.e.  0.0438
## 
## sigma^2 estimated as 0.1175:  log likelihood = -158.92,  aic = 321.84</code></pre>
<pre class="r"><code>resultsseason</code></pre>
<pre><code>## 
## Call:
## arima0(x = co2.dt, order = c(1, 0, 0), seasonal = c(0, 1, 1), include.mean = FALSE)
## 
## Coefficients:
##          ar1     sma1
##       0.3809  -0.8609
## s.e.  0.0436   0.0020
## 
## sigma^2 estimated as 0.07152:  log likelihood = -53.58,  aic = 113.15</code></pre>
<pre class="r"><code>acf(results$residuals)</code></pre>
<p><img src="Time_Series_Lab_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<pre class="r"><code>acf(resultsseason$residuals)</code></pre>
<p><img src="Time_Series_Lab_files/figure-html/unnamed-chunk-12-2.png" width="672" /></p>
<p>The ARIMA model with the seasonal componant does much better when comparing the AICs as we would expect.</p>
<p>Another option in forecast package:</p>
<p>auto.arima(): takes a timeseries (ts) and calculates the best arima based on the AIC, AICc and BIC.</p>
<pre class="r"><code>resultsauto &lt;- forecast::auto.arima(co2)
resultsauto</code></pre>
<pre><code>## Series: co2 
## ARIMA(1,1,1)(1,1,2)[12]                    
## 
## Coefficients:
##          ar1      ma1     sar1     sma1     sma2
##       0.2569  -0.5847  -0.5489  -0.2620  -0.5123
## s.e.  0.1406   0.1204   0.5879   0.5701   0.4819
## 
## sigma^2 estimated as 0.08576:  log likelihood=-84.39
## AIC=180.78   AICc=180.97   BIC=205.5</code></pre>
<pre class="r"><code>acf(resultsauto$residuals)</code></pre>
<p><img src="Time_Series_Lab_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<p>Be careful! The computer has a tendency to overfit. It is important to look at the number of terms in the equation and make sure some have not cancelled others out. In this case, the seasonal MA and the none seasonal AR introduce opposite correlations effectively canceling each other out. It is definately important to unpack the black box.</p>
</div>
<div id="plots-for-the-best-model-from-above" class="section level3">
<h3>Plots for the best model from above</h3>
<pre class="r"><code># plot
fitted.co2.dt &lt;- co2.dt - resultsseason$residuals
ts.plot(co2.dt, fitted.co2.dt, col = 1:2)</code></pre>
<p><img src="Time_Series_Lab_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<pre class="r"><code># on original data
fitted.co2 &lt;- fitted.co2.dt + yearlymean
ts.plot(co2, fitted.co2, col = 1:2)</code></pre>
<p><img src="Time_Series_Lab_files/figure-html/unnamed-chunk-14-2.png" width="672" /></p>
</div>
<div id="with-an-understanding-of-the-process" class="section level3">
<h3>With an understanding of the process…</h3>
<p>R will deal with trends, seasonality and unequal variance with arima0(). <em>Make sure you know which terms to put in the model first.</em></p>
<pre class="r"><code>final &lt;- arima0(co2, order = c(1,1,0), seasonal = c(0,1,1))
acf(final$residuals)</code></pre>
<p><img src="Time_Series_Lab_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
</div>
<div id="so-what-about-predictions" class="section level3">
<h3>So what about predictions?</h3>
<pre class="r"><code>co2.fitted &lt;- co2 - final$residuals
predict.final &lt;- predict(final,n.ahead = 36,se.fit = FALSE)

ts.plot(co2, co2.fitted, predict.final, col = 1:3)</code></pre>
<p><img src="Time_Series_Lab_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<pre class="r"><code># and standard error 
# from which you can get confidence intervals
predict.final.se &lt;- predict(final,n.ahead = 36)</code></pre>
</div>
<div id="conclusions" class="section level3">
<h3>Conclusions:</h3>
<ol style="list-style-type: decimal">
<li><p>ARIMA models are tricky to build. It is easy to overfit the mode. Statistical experience definately helps.</p></li>
<li><p>It is important to open the black box and fully understand what the model is doing.</p></li>
<li><p>Diagonostics are critical, but open to interpretation.</p></li>
</ol>
</div>
<div id="questions-1" class="section level3">
<h3>Questions</h3>
<ol style="list-style-type: decimal">
<li>Take another timeseries dataset built into R. For example:</li>
</ol>
<pre class="r"><code>data() # lists the different r datasets

head(austres) # Numbers (in thousands) of Australian residents measured quarterly from March 1971 to March 1994. The object is of class &quot;ts&quot;.</code></pre>
<pre><code>## [1] 13067.3 13130.5 13198.4 13254.2 13303.7 13353.9</code></pre>
<p>Run the appropriate tests and build an ARIMA model for it. How confident are you in the ARIMA model? What are some drawbacks to using the model? What are some advantages?</p>
<ol start="2" style="list-style-type: decimal">
<li>Use the ARIMA model to predict future values. Does the ARIMA make good predictions? How reasonable are your confidence intervals?</li>
</ol>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
