<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Danny Nielsen and Cristina Perez" />

<meta name="date" content="2016-11-27" />

<title>Spatial Autocorrelation Mini-lab</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cerulean.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<link rel="stylesheet"
      href="site_libs/highlight/default.css"
      type="text/css" />
<script src="site_libs/highlight/highlight.js"></script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}

.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.9em;
  padding-left: 5px;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">NRES 746</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Schedule
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="schedule.html">Course Schedule</a>
    </li>
    <li>
      <a href="labschedule.html">Lab Schedule</a>
    </li>
    <li>
      <a href="Syllabus.pdf">Syllabus</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Lectures
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="INTRO.html">Introduction to NRES 746</a>
    </li>
    <li>
      <a href="LECTURE1.html">Why focus on algorithms?</a>
    </li>
    <li>
      <a href="LECTURE2.html">Working with probabilities</a>
    </li>
    <li>
      <a href="LECTURE3.html">The Virtual Ecologist</a>
    </li>
    <li>
      <a href="LECTURE4.html">Likelihood</a>
    </li>
    <li>
      <a href="LECTURE5.html">Optimization</a>
    </li>
    <li>
      <a href="LECTURE6.html">Bayesian #1: concepts</a>
    </li>
    <li>
      <a href="LECTURE7.html">Bayesian #2: mcmc</a>
    </li>
    <li>
      <a href="LECTURE8.html">Model Selection</a>
    </li>
    <li>
      <a href="LECTURE9.html">Model Performance Evaluation</a>
    </li>
    <li>
      <a href="LECTURE10.html">Machine Learning</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Lab exercises
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="LAB1.html">Lab 1: Algorithms in R</a>
    </li>
    <li>
      <a href="LAB2.html">Lab 2: Virtual ecologist</a>
    </li>
    <li>
      <a href="LAB3.html">Lab 3: Likelihood and optimization</a>
    </li>
    <li>
      <a href="LAB4.html">Lab 4: Bayesian inference</a>
    </li>
    <li>
      <a href="LAB5.html">Lab 5: Model selection</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Data sets
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="TreeData.csv">Tree Data</a>
    </li>
    <li>
      <a href="ReedfrogPred.csv">Reed Frog Predation Data</a>
    </li>
    <li>
      <a href="ReedfrogFuncresp.csv">Reed Frog Func Resp</a>
    </li>
    <li>
      <a href="uta_simulated_data.csv">Uta data</a>
    </li>
    <li>
      <a href="tide_ALL_navd_HH.csv">tide data?</a>
    </li>
    <li>
      <a href="TestDataset2.csv">Ordination minilab: testdataset2</a>
    </li>
    <li>
      <a href="TestHypotheses.csv">Ordination minilab: testhypotheses</a>
    </li>
    <li>
      <a href="PRISM_ppt_1895-2015Mo2.csv">PRISM data for time series lab</a>
    </li>
    <li>
      <a href="final_winter_modeldata2.csv">winter deer data for RSF lab</a>
    </li>
    <li>
      <a href="keeley_rawdata.csv">Keeley data</a>
    </li>
    <li>
      <a href="Nest_basic_ALL.csv">nest basic data</a>
    </li>
    <li>
      <a href="Cap_data_for SA minilab.csv">cap data for SA</a>
    </li>
    <li>
      <a href="JoTrPresence02202008_dryad.txt">Joshua tree data for SDM lab</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Student-led topics
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="forWebsite_SEM.html">SEMs</a>
    </li>
    <li>
      <a href="SEM_Minilab_v2.html">SEM mini-lab</a>
    </li>
    <li>
      <a href="GAMs.html">GAMs</a>
    </li>
    <li>
      <a href="RMarkdown_FigureDemo.html">Publication-quality figures in R</a>
    </li>
    <li>
      <a href="Bayesian Networks.pptx">Bayesian Networks</a>
    </li>
    <li>
      <a href="Bayes_Network_Markdown_Final.html">Bayesian Networks mini-lab</a>
    </li>
    <li>
      <a href="GraphTheory.html">Graph Theory</a>
    </li>
    <li>
      <a href="NRES746_IPMs.pptx">Integrated Population Models</a>
    </li>
    <li>
      <a href="TimeSeries_heckler.html">Time Series Analysis</a>
    </li>
    <li>
      <a href="Time_Series_Lab.html">Time-series mini-lab</a>
    </li>
    <li>
      <a href="Spatial_Autocorrelation.html">Spatial Autocorrelation</a>
    </li>
    <li>
      <a href="SA_minilab.html">Spatial Autocorrelation mini-lab</a>
    </li>
    <li>
      <a href="SDM_pres.html">Species Distribution Modeling</a>
    </li>
    <li>
      <a href="IPM_miniLab.html">IPM mini-lab</a>
    </li>
    <li>
      <a href="Final_MiniLabScript.html">RSF mini-lab</a>
    </li>
    <li>
      <a href="MixedModelMinilab.html">Mixed-effects model mini-lab</a>
    </li>
    <li>
      <a href="Minilab_Ordination.html">Ordination mini-lab</a>
    </li>
  </ul>
</li>
<li>
  <a href="Links.html">Links</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Spatial Autocorrelation Mini-lab</h1>
<h4 class="author"><em>Danny Nielsen and Cristina Perez</em></h4>
<h4 class="date"><em>November 27, 2016</em></h4>

</div>


<div id="this-lab-will-walk-you-through-the-process-of-detecting-spatial-autocorrelation-sa-in-spatial-data-and-how-to-deal-with-sa-once-detected.-we-will-use-the-provided-woodrat-data-for-these-exercises" class="section level3">
<h3>This lab will walk you through the process of detecting Spatial Autocorrelation (SA) in spatial data, and how to deal with SA once detected. We will use the provided woodrat data for these exercises</h3>
<div id="first-lets-load-the-data" class="section level4">
<h4>First, let’s load the data</h4>
<pre class="r"><code>ratdat &lt;- read.csv(&quot;Cap_data_for SA.csv&quot;)</code></pre>
</div>
</div>
<div id="lets-try-and-model-density-as-a-function-of-slope-keeping-the-effects-of-sa-in-mind" class="section level3">
<h3>Let’s try and model density as a function of slope, keeping the effects of SA in mind!</h3>
</div>
<div id="first-we-will-want-to-run-some-sa-analysis-well-need-to-load-some-packages." class="section level3">
<h3>First, we will want to run some SA analysis! We’ll need to load some packages.</h3>
<pre class="r"><code>library(ncf)  #package for building correlograms</code></pre>
<pre><code>## Warning: package &#39;ncf&#39; was built under R version 3.3.2</code></pre>
<pre class="r"><code>library(nlme)</code></pre>
<pre><code>## Warning: package &#39;nlme&#39; was built under R version 3.3.2</code></pre>
<pre class="r"><code>library(raster)</code></pre>
<pre><code>## Loading required package: sp</code></pre>
<pre><code>## 
## Attaching package: &#39;raster&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:nlme&#39;:
## 
##     getData</code></pre>
<pre class="r"><code>library(vegan)</code></pre>
<pre><code>## Warning: package &#39;vegan&#39; was built under R version 3.3.2</code></pre>
<pre><code>## Loading required package: permute</code></pre>
<pre><code>## Warning: package &#39;permute&#39; was built under R version 3.3.2</code></pre>
<pre><code>## Loading required package: lattice</code></pre>
<pre><code>## This is vegan 2.4-1</code></pre>
<pre><code>## 
## Attaching package: &#39;vegan&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:ncf&#39;:
## 
##     mantel.correlog</code></pre>
<pre class="r"><code>library(colorRamps)</code></pre>
<pre><code>## Warning: package &#39;colorRamps&#39; was built under R version 3.3.2</code></pre>
<pre class="r"><code>library(emdbook)</code></pre>
</div>
<div id="question-1-look-at-the-data-and-generate-some-basic-plots.-does-anything-appear-to-indicate-sa" class="section level3">
<h3>Question 1: Look at the data and generate some basic plots. Does anything appear to indicate SA?</h3>
</div>
<div id="now-lets-see-if-we-can-detect-sa-in-our-data." class="section level3">
<h3>Now, let’s see if we can detect SA in our data.</h3>
<div id="lets-first-define-some-objects-well-use-from-the-dataset" class="section level4">
<h4>Let’s first define some objects we’ll use from the dataset</h4>
<pre class="r"><code>x.coords &lt;- (ratdat$UTM.E) 
y.coords &lt;- (ratdat$UTM.N)
density &lt;- (ratdat$Density)
slope &lt;- (ratdat$WWslope)</code></pre>
</div>
<div id="now-use-the-correlog-function.-use-the-help-to-learn-what-the-function-requires-to-run" class="section level4">
<h4>Now, use the correlog function. Use the help to learn what the function requires to run!</h4>
<pre class="r"><code>?correlog</code></pre>
<pre><code>## starting httpd help server ...</code></pre>
<pre><code>##  done</code></pre>
</div>
</div>
<div id="after-running-the-correlog-function-you-should-be-able-to-plot-the-results" class="section level3">
<h3>After running the correlog function, you should be able to plot the results!</h3>
<pre class="r"><code>plot(rat.cor)</code></pre>
<p><img src="SA_minilab_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
</div>
<div id="question-2-look-at-the-results.-does-sa-appear-to-be-present" class="section level3">
<h3>Question 2: Look at the results. Does SA appear to be present?</h3>
<div id="now-what-should-we-do-we-can-thin-the-data-to-reduce-the-influence-of-sa.-or-we-can-incorporate-sa-directly-into-our-model." class="section level4">
<h4>Now, what should we do? We can thin the data to reduce the influence of SA. Or, we can incorporate SA directly into our model.</h4>
</div>
</div>
<div id="question-3-study-the-correlogram-and-determine-which-method-you-would-like-to-use-to-handle-the-sa-thinning-or-direct-modeling." class="section level3">
<h3>Question 3: Study the correlogram and determine which method you would like to use to handle the SA: thinning or direct modeling.</h3>
</div>
<div id="for-thinning-you-could-use-the-following-function-from-dan-warren-httpsgist.github.comdanlwarren271288d5bab45d2da549" class="section level3">
<h3>For thinning, you could use the following function: (from Dan Warren: <a href="https://gist.github.com/danlwarren/271288d5bab45d2da549" class="uri">https://gist.github.com/danlwarren/271288d5bab45d2da549</a>)</h3>
<pre class="r"><code>thin.max &lt;- function(x, cols, npoints){    #Create empty vector for output
  
  inds &lt;- vector(mode=&quot;numeric&quot;)
  
  #Create distance matrix
  this.dist &lt;- as.matrix(dist(x[,cols], upper=TRUE))
  
  #Draw first index at random
  inds &lt;- c(inds, as.integer(runif(1, 1, length(this.dist[,1]))))
  
  #Get second index from maximally distant point from first one
  #Necessary because apply needs at least two columns or it&#39;ll barf
  #in the next bit
  inds &lt;- c(inds, which.max(this.dist[,inds]))
  
  while(length(inds) &lt; npoints){
    #For each point, find its distance to the closest point that&#39;s already been selected
    min.dists &lt;- apply(this.dist[,inds], 1, min)
    
    #Select the point that is furthest from everything we&#39;ve already selected
    this.ind &lt;- which.max(min.dists)
    
    #Get rid of ties, if they exist
    if(length(this.ind) &gt; 1){
      print(&quot;Breaking tie...&quot;)
      this.ind &lt;- this.ind[1]
    }
    inds &lt;- c(inds, this.ind)
  }
  
  return(x[inds,])
}</code></pre>
</div>
<div id="question-3.2-after-thinning-the-data-run-the-correlog-function-again.-plot-the-new-results-and-determine-what-if-any-difference-it-has-made-try-adjusting-the-npoints-number-and-see-what-kind-of-difference-it-makes-to-the-results" class="section level3">
<h3>Question 3.2: After thinning the data, run the correlog function again. Plot the new results and determine what, if any, difference it has made? Try adjusting the “npoints” number and see what kind of difference it makes to the results?</h3>
</div>
<div id="rather-than-thinning-you-may-just-want-to-incorporate-the-sa-directly-in-your-model" class="section level2">
<h2>Rather than thinning, you may just want to incorporate the SA directly in your model</h2>
<div id="we-can-do-this-by-fitting-linear-models-with-generalized-least-squares-gls" class="section level4">
<h4>We can do this by fitting linear models with Generalized Least Squares (GLS)</h4>
<pre class="r"><code>m2 &lt;- gls(log1p(density)~slope + I(slope^2), data = ratdat) #model without including SA residuals
m3 &lt;- gls(log1p(density)~slope + I(slope^2), correlation = corExp(form = ~UTM.E + UTM.N, nugget = TRUE), data = ratdat) #we add the correlation argument to run the same model with SA residuals included

vario2&lt;- Variogram(m2, form = ~UTM.E + UTM.N, resType = &quot;pearson&quot;)  #create variograms that you can then plot!
vario3 &lt;- Variogram(m3, form = ~UTM.E + UTM.N, resType = &quot;pearson&quot;)</code></pre>
</div>
<div id="question-3.3" class="section level3">
<h3>Question 3.3</h3>
</div>
<div id="model-density-as-a-function-of-slope-with-and-without-incorporating-sa.-you-should-get-similar-plots-as-above" class="section level3">
<h3>Model density as a function of slope with and without incorporating SA. You should get similar plots as above!</h3>
</div>
<div id="determine-which-model-is-the-better-fit" class="section level3">
<h3>Determine which model is the better fit?</h3>
</div>
<div id="use-the-aic-function-to-compare-the-two-models." class="section level3">
<h3>Use the AIC function to compare the two models.</h3>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
