<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Danielle C. Miles and Miranda M. Crowell" />

<meta name="date" content="2016-11-14" />

<title>Species Distribution Modeling</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cerulean.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<link rel="stylesheet"
      href="site_libs/highlight/default.css"
      type="text/css" />
<script src="site_libs/highlight/highlight.js"></script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}

.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.9em;
  padding-left: 5px;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">NRES 746</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Schedule
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="schedule.html">Course Schedule</a>
    </li>
    <li>
      <a href="labschedule.html">Lab Schedule</a>
    </li>
    <li>
      <a href="Syllabus.pdf">Syllabus</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Lectures
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="INTRO.html">Introduction to NRES 746</a>
    </li>
    <li>
      <a href="LECTURE1.html">Why focus on algorithms?</a>
    </li>
    <li>
      <a href="LECTURE2.html">Working with probabilities</a>
    </li>
    <li>
      <a href="LECTURE3.html">The Virtual Ecologist</a>
    </li>
    <li>
      <a href="LECTURE4.html">Likelihood</a>
    </li>
    <li>
      <a href="LECTURE5.html">Optimization</a>
    </li>
    <li>
      <a href="LECTURE6.html">Bayesian #1: concepts</a>
    </li>
    <li>
      <a href="LECTURE7.html">Bayesian #2: mcmc</a>
    </li>
    <li>
      <a href="LECTURE8.html">Model Selection</a>
    </li>
    <li>
      <a href="LECTURE9.html">Model Performance Evaluation</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Lab exercises
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="LAB1.html">Lab 1: Algorithms in R</a>
    </li>
    <li>
      <a href="LAB2.html">Lab 2: Virtual ecologist</a>
    </li>
    <li>
      <a href="LAB3.html">Lab 3: Likelihood and optimization</a>
    </li>
    <li>
      <a href="LAB4.html">Lab 4: Bayesian inference</a>
    </li>
    <li>
      <a href="LAB5.html">Lab 5: Model selection</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Data sets
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="TreeData.csv">Tree Data</a>
    </li>
    <li>
      <a href="ReedfrogPred.csv">Reed Frog Predation Data</a>
    </li>
    <li>
      <a href="ReedfrogFuncresp.csv">Reed Frog Func Resp</a>
    </li>
    <li>
      <a href="uta_simulated_data.csv">Uta data</a>
    </li>
    <li>
      <a href="tide_ALL_navd_HH.csv">tide data?</a>
    </li>
    <li>
      <a href="TestDataset2.csv">test dataset for SDM?</a>
    </li>
    <li>
      <a href="PRISM_tmean_189511_201610.csv">Reed Frog Func Resp</a>
    </li>
    <li>
      <a href="PRISM_ppt_1895-2015Mo2.csv">Reed Frog Func Resp</a>
    </li>
    <li>
      <a href="final_winter_modeldata2.csv">winter model data</a>
    </li>
    <li>
      <a href="keeley_rawdata.csv">Keeley data</a>
    </li>
    <li>
      <a href="Nest_basic_ALL.csv">nest basic data</a>
    </li>
    <li>
      <a href="Cap_data_for SA.csv">cap data for SA</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Student-led topics
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="forWebsite_SEM.html">SEMs</a>
    </li>
    <li>
      <a href="SEM_Minilab_v2.html">SEM mini-lab</a>
    </li>
    <li>
      <a href="GAMs.html">GAMs</a>
    </li>
    <li>
      <a href="RMarkdown_FigureDemo.html">Publication-quality figures in R</a>
    </li>
    <li>
      <a href="Bayesian Networks.pptx">Bayesian Networks</a>
    </li>
    <li>
      <a href="Bayes_Network_Markdown_Final.html">Bayesian Networks mini-lab</a>
    </li>
    <li>
      <a href="GraphTheory.html">Graph Theory</a>
    </li>
    <li>
      <a href="NRES746_IPMs.pptx">Integrated Population Models</a>
    </li>
    <li>
      <a href="TimeSeries_heckler.html">Time Series Analysis</a>
    </li>
    <li>
      <a href="Time_Series_Lab.html">Time-series mini-lab</a>
    </li>
    <li>
      <a href="Spatial_Autocorrelation.html">Spatial Autocorrelation</a>
    </li>
    <li>
      <a href="SA_miniLab.html">Spatial Autocorrelation mini-lab</a>
    </li>
    <li>
      <a href="SDM_pres.html">Species Distribution Modeling</a>
    </li>
    <li>
      <a href="IPM_miniLab.html">IPM mini-lab</a>
    </li>
    <li>
      <a href="Final_MiniLabScript.html">RSF mini-lab</a>
    </li>
    <li>
      <a href="MixedModelMinilab.html">Mixed-effects model mini-lab</a>
    </li>
    <li>
      <a href="Minilab_Ordination.html">Ordination mini-lab</a>
    </li>
  </ul>
</li>
<li>
  <a href="Links.html">Links</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Species Distribution Modeling</h1>
<h4 class="author"><em>Danielle C. Miles and Miranda M. Crowell</em></h4>
<h4 class="date"><em>November 14, 2016</em></h4>

</div>


<div id="what-is-a-sdm" class="section level3">
<h3>What is a SDM?</h3>
<ul>
<li>Aliases: Environmental niche modeling, ecologicl niche modeling, predictive habitat distribution modeling, climate envelope modeling</li>
<li>A way to estimate the conditions at any site based on conditions at sites with known occurrence (similarity)</li>
<li>Environmental values are used to fit the model
<ul>
<li>Temperature, precipitation, soil type, water depth, land cover</li>
</ul></li>
<li>Model predicts the variable across the area of interest
<ul>
<li>Specific locations and regions, future or past climates</li>
</ul></li>
<li>Ecology, evolution, and conservation biology: predict distribution of species in geographic space using algorithms based in realized ecological niche</li>
</ul>
<div id="sdm-versus-rsf" class="section level4">
<h4>SDM versus RSF</h4>
<ul>
<li>RSFs usually use GPS or radio-telemetry data while SDMs usually use occurrence data</li>
<li>RSFs can scale from a plant, to a patch, to a home range, to a landscape
<ul>
<li>SDMs are usually used at a larger scale (i.e., landscape, country, globe)</li>
</ul></li>
<li>RSFs are usually analyzed using linear regression models while SDMs are usually analyzed using machine learning methods (e.g., MaxEnt)</li>
</ul>
</div>
</div>
<div id="when-to-use-an-sdm" class="section level3">
<h3>When to use an SDM</h3>
<ul>
<li>Assessing species invasion or proliferation</li>
<li><strong>Assessing impacts of cliate change on species</strong></li>
<li>Assessing impacts of land use change on species</li>
<li>Identifying unsurveyed sites of high potential for occurrence of rare species</li>
<li>Mapping suitable sites for species reintroduction or restoration</li>
<li>Quantifying key environmental drivers of presence or habitat suitability</li>
<li>Determining realized (or fundamental!!) niche of a species</li>
<li>Predicting potential distribution or geographic range limits</li>
</ul>
</div>
<div id="main-steps-to-complete-an-sdm" class="section level2">
<h2>Main Steps to Complete an SDM</h2>
<div id="step-1-data-preparation" class="section level3">
<h3>Step 1: Data Preparation</h3>
<ul>
<li><strong>Most time consuming part of SDMs!!</strong></li>
<li>Collect sufficient number of records for occurrence
<ul>
<li>Presence, absence, or less often, abundance</li>
</ul></li>
<li>Clean up data!
<ul>
<li>Does the data make sense for your species?</li>
<li>Do the data points have coordinates? Are they accurate?</li>
<li>Get rid of duplicate records</li>
</ul></li>
<li>Predictor variables: environmental data
<ul>
<li>Must be accurate and relevant to your study</li>
<li>Appropriate spatial resolution (e.g., if you are investigating a variable at a global scale, a 1-m resolution doesn’t make much sense!)</li>
</ul></li>
</ul>
<div id="be-aware-of-sampling-bias" class="section level5">
<h5><strong>Be aware of sampling bias!</strong></h5>
<ul>
<li>Presence only data
<ul>
<li>Surveys may have only been done at easily accessible areas close to roads</li>
<li>Intense sampling of certain areas</li>
<li>These may cause your model to show low suitability in certain areas- but that could just be because of a lack of sampling in those areas!</li>
</ul></li>
<li>No absence data?
<ul>
<li>Subsampling to reduce unevenness (e.g., break study area up into grid cells and choose one point to represent each grid cell)</li>
<li>Potential problems with subsampling</li>
</ul>
<ol style="list-style-type: decimal">
<li>Eliminating records of rare or endangered species that may not have a lot of data points to begin with</li>
<li>Records may be clumped for a reason. We may assume this is sampling bias, but it could have to do with the ecology of the species!</li>
</ol></li>
<li>Does lack of presence mean absence?
<ul>
<li>Detection issues</li>
<li>Knowledge of your study species! (e.g., does your species hibernate? estivate? migrate?)</li>
</ul></li>
</ul>
</div>
<div id="example-estimating-absence-from-presence" class="section level5">
<h5>Example: Estimating Absence from Presence</h5>
<ul>
<li>Atlantic cod (Ecological Modelling, 2016)
<ul>
<li>Uses presence of other species that Atlantic cod are known to not occur sympatrically with to determine true absence</li>
<li>1.7 million occurrences of 280 marine species in GBIF</li>
</ul></li>
<li>This example is done globally, but can be scaled to regional studies</li>
</ul>
</div>
<div id="moral-of-the-story-if-you-have-absence-data.-use-it" class="section level4">
<h4>Moral of the Story: If you have absence data…. USE IT!!</h4>
</div>
</div>
<div id="step-2-fitting-a-model" class="section level3">
<h3>Step 2: Fitting a model</h3>
<p><strong>Which model?</strong></p>
<ul>
<li>Profile methods
<ul>
<li>Use environmental distance to known stes and simple statistics</li>
<li>BIOCLIM and DOMAIN have low performance and stability</li>
</ul></li>
<li>Regression methods
<ul>
<li>Generalized linear models, generalized additive models</li>
</ul></li>
<li>Machine learning methods
<ul>
<li>MAXENT</li>
<li>Random Forest</li>
<li>Boosted Regression</li>
</ul></li>
</ul>
</div>
<div id="step-3-predictions" class="section level3">
<h3>Step 3: Predictions</h3>
<ul>
<li>Predict function in R
<ul>
<li>This will take variables you have and apply them to a different space</li>
<li>Any type of model can be used</li>
</ul></li>
</ul>
<div id="extrapolation" class="section level4">
<h4>Extrapolation</h4>
<ul>
<li>Appplying the model to a data set outside known occurrence range
<ul>
<li>Or temporal extrapolation</li>
</ul></li>
<li>Important in climate change models</li>
<li><strong>Uncertainty</strong>
<ul>
<li>No way to know for sure how climate, land use, species’ movements and interactions will change into the future</li>
<li>Important to acknowledge it so models can be improved in the future</li>
<li>Embrace it!</li>
</ul></li>
</ul>
</div>
</div>
<div id="step-4-evaluating-the-results" class="section level3">
<h3>Step 4: Evaluating the Results</h3>
<ul>
<li>Ask yourself…
<ul>
<li>Does the model seem sensible ecologically?</li>
<li>Do the predictions seem reasonable?</li>
</ul></li>
<li><strong>Spatial Cross-validation</strong>
<ul>
<li>Interpolation: use ‘training’ model to test with known occurrence data set across different regions</li>
<li>Example: Fitting pygmy rabbit presence-only model from Hart-Sheldon to occurrence data at two other regions- Elko and Austin</li>
<li>If our training model for Hart-Sheldon doesn’t fit Elko and Austin occurrence data well it could mean it is an overfit model</li>
</ul></li>
</ul>
<div id="area-under-the-curve-auc-in-evaluating-the-results" class="section level5">
<h5>Area Under the Curve (AUC) in Evaluating the Results</h5>
<ul>
<li>Measure of accuracy
<ul>
<li>0.5 AUC = as good as a random guess</li>
<li>Closer AUC is to 1, the better the model is!</li>
</ul></li>
<li>Criticism: Increased spatial extent of background points leads to an increased AUC value
<ul>
<li>Remove “spatial sorting bias” through “point-wise distance sampling”</li>
<li>Example:</li>
</ul></li>
</ul>
<pre class="r"><code>&gt; sb &lt;- ssb(pres_test, back_test, pres_train)
&gt; sb[,1] / sb[,2] #this equation is used to assess if spatial sorting bias is affecting our data</code></pre>
<p>p 0.06743079</p>
<ul>
<li>This value is close to 0 which means there is a strong spatial bias</li>
</ul>
<pre class="r"><code>&gt; i &lt;- pwdSample(pres_test, back_test, pres_train, n=1, tr=0.1) #point-wise distance sampling
&gt; pres_test_pwd &lt;- pres_test[!is.na(i[,1]), ]
&gt; back_test_pwd &lt;- back_test[na.omit(as.vector(i)), ]
&gt; sb2 &lt;- ssb(pres_test_pwd, back_test_pwd, pres_train)
&gt; sb2[1]/ sb2[2]</code></pre>
<p>[1] 1.013039</p>
<ul>
<li>This value is much better! A value closer to 1 means there is no spatial bias</li>
</ul>
<pre class="r"><code>&gt; bc &lt;- bioclim(predictors, pres_train) 
&gt; evaluate(bc, p=pres_test, a=back_test, x=predictors) #evaluate data without correction for spatial sorting bias
# cut out all results except AUC</code></pre>
<p>AUC : 0.7551724</p>
<pre class="r"><code>&gt; evaluate(bc, p=pres_test_pwd, a=back_test_pwd, x=predictors) #evaluate data with correction for spatial sorting bias
# cut out all results except AUC</code></pre>
<p>AUC : 0.4467456</p>
<ul>
<li>We see that the correction for the spatial sampling bias lowered the AUC value by approximately 0.3</li>
</ul>
</div>
</div>
<div id="correlative-versus-mechanistic-sdms" class="section level3">
<h3>Correlative versus Mechanistic SDMs</h3>
<ul>
<li>Correlative
<ul>
<li>Applies environmental conditions to occurrence records</li>
<li>Realized niche: habitat &amp; resources a population actually uses</li>
<li>Requires <strong>relatively</strong> little knowledge of focal organism</li>
</ul></li>
<li>Mechanistic
<ul>
<li>Incorporates physiology, morphology, and behavior of organism</li>
<li>Fundamental niche: habitat &amp; resources a population is theoretically capable of using under ideal conditions</li>
<li>Requires a significant increase in invested time, effort, resources, data, and knowledge of focal organism</li>
</ul></li>
<li>Joint approach
<ul>
<li>Would allow one to map the fundamental niche of a given organism and then find the realized niche, or areas of higher habitat suitability, within the area of the fundamental niche</li>
</ul></li>
<li>Example
<ul>
<li>Kearney &amp; Porter (2009) Mechanistic niche modelling: combining physiological and spatial data to predit species’ ranges</li>
<li>Invasive Cane Toads in Australia</li>
</ul></li>
</ul>
</div>
<div id="future-advances-for-sdms" class="section level3">
<h3>Future Advances for SDMs</h3>
<ul>
<li>Inclusion of species interactions</li>
<li>More complex, mechanistic models
<ul>
<li>Especially for the spread of invasive species</li>
</ul></li>
<li>How species will respond to novel environmental conditions
<ul>
<li>Community shifts</li>
<li>New competitors and predators</li>
</ul></li>
<li>Movement
<ul>
<li>Dispersal and Migration</li>
<li>Gene flow between populations</li>
</ul></li>
</ul>
</div>
<div id="getting-started-on-the-example-in-r" class="section level3">
<h3>Getting started on the example in R!!</h3>
<p><em>Make sure you have all of the correct packages installed and ready using library() or require().</em></p>
<pre class="r"><code># install.packages(&quot;raster&quot;)
# #includes &quot;sp&quot;
# install.packages(&quot;rgdal&quot;)
# install.packages(&quot;dismo&quot;)
# install.packages(&quot;rJava&quot;)
library(rgdal)
library(raster)
library(rJava) </code></pre>
<p>^These are what are suggested through the cran vignette, but you will evaluate what you would need. we are going to focus on what can be done in dismo. You might even have your own background maps you would be using, but for our example will we need these map packages.</p>
<pre class="r"><code># install.packages(&quot;maptools&quot;)
require(maptools)
# install.packages(&quot;maps&quot;)
# install.packages(&quot;mapdata&quot;)
require(mapdata)
# install.packages(&quot;rgeos&quot;)</code></pre>
<pre class="r"><code>require(maps)</code></pre>
<pre><code>## Loading required package: maps</code></pre>
<pre><code>## Warning: package &#39;maps&#39; was built under R version 3.3.2</code></pre>
<pre class="r"><code>library(rgeos)</code></pre>
<pre><code>## Warning: package &#39;rgeos&#39; was built under R version 3.3.2</code></pre>
<pre><code>## rgeos version: 0.3-21, (SVN revision 540)
##  GEOS runtime version: 3.5.0-CAPI-1.9.0 r4084 
##  Linking to sp version: 1.2-3 
##  Polygon checking: TRUE</code></pre>
<pre class="r"><code>library(dismo)</code></pre>
<pre><code>## Warning: package &#39;dismo&#39; was built under R version 3.3.2</code></pre>
<pre><code>## Loading required package: raster</code></pre>
<pre><code>## Loading required package: sp</code></pre>
<p>Our example is being borrowed from</p>
<p>Godsoe, W., Strand, E., Smith, C. I., Yoder, J. B., Esque, T. C., &amp; Pellmyr, O. (2009). Divergence in an obligate mutualism is not explained by divergent climatic factors. New Phytologist, 183(3), 589-599.</p>
<p>It is Dr. Jeremy Yoder who provides code that we have modified to show you at <a href="http://www.molecularecologist.com/2013/04/species-distribution-models-in-r/" class="uri">http://www.molecularecologist.com/2013/04/species-distribution-models-in-r/</a>. You will need to download the data from dryad at <a href="http://datadryad.org/resource/doi:10.5061/dryad.6s67t" class="uri">http://datadryad.org/resource/doi:10.5061/dryad.6s67t</a>. It contains latitude and longitude coordinates in decimal degrees for 5,765 points for observations of Joshua tree (<em>Yucca brevifolia</em>), and the species of pollinator moth (<em>Tegeticula synthetica</em> or <em>T. antithetica</em>) present at those sites. Then in r we will load our data and our map (we are working in the US).</p>
<pre class="r"><code>#load table of coordinates
locs &lt;- read.delim(&quot;JoTrPresence02202008_dryad.txt&quot;)
data(stateMapEnv) # load the database with the U.S. states</code></pre>
</div>
</div>
<div id="now-were-ready" class="section level2">
<h2>Now we’re ready</h2>
<pre class="r"><code>#we will now check the data by plotting it on this map
# notice we&#39;re limiting the extent of the map to focus on the Mojave Desert region
plot(c(-119, -113), c(33.5, 38), mar=par(&quot;mar&quot;), xlab=&quot;longitude&quot;, ylab=&quot;latitude&quot;, xaxt=&quot;n&quot;, yaxt=&quot;n&quot;, type=&quot;n&quot;, main=&quot;Joshua tree presence data&quot;)
#rect draws a rectangle
rect(par(&quot;usr&quot;)[1],par(&quot;usr&quot;)[3],par(&quot;usr&quot;)[2],par(&quot;usr&quot;)[4], col=&quot;lightblue&quot;)
map(&quot;state&quot;, xlim=c(-119, -113), ylim=c(33.5, 38), fill=T, col=&quot;cornsilk&quot;, add=T)
#we can label the states
text(x=-117.5, y=35.5, &quot;California&quot;, col=&quot;cornsilk3&quot;, cex=3)
text(x=-116, y=37.5, &quot;Nevada&quot;, col=&quot;cornsilk3&quot;, cex=3)
text(x=-113, y=34.5, &quot;Arizona&quot;, col=&quot;cornsilk3&quot;, cex=3)
text(x=-113, y=37.75, &quot;Utah&quot;, col=&quot;cornsilk3&quot;, cex=3)
#now add the points
points(locs$longitude, locs$latitude, col=&quot;darkgreen&quot;, pch=20, cex=0.5)
axis(1,las=1)
axis(2,las=1)
box()</code></pre>
<p><img src="SDM_pres_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<p>This is a map of our raw points. You can see some clumping, there is not even distribution. Why? Partially because Joshua trees aren’t evenly distributed, but also because sampling efforts aren’t evenly distrbuted. How do we compensate for this? ### Subsetting! We can divide the map up into a grid and randomly draw a single point from each grid square. We will use 5 kilometer squares, but be careful that is is crude at this scale and if you were looking at the whole globe accurate calculations are complicated because the Earth is not flat.</p>
<pre class="r"><code>#subsetting
# create sequences of latitude and longitude values to define the grid
longrid = seq(-119,-113,0.05)
latgrid = seq(33.5,38,0.05)
# identify points within each grid cell, draw one at random
subs = c()
for(i in 1:(length(longrid)-1)){
  for(j in 1:(length(latgrid)-1)){
    gridsq = subset(locs, latitude &gt; latgrid[j] &amp; latitude &lt; 
                      latgrid[j+1] &amp; longitude &gt; longrid[i] &amp; longitude &lt; 
                      longrid[i+1])     
    if(dim(gridsq)[1]&gt;0){subs = rbind(subs, gridsq[sample(1:dim(gridsq)[1],1 ), ])}}}
dim(subs) # confirm that you have a smaller dataset than you started with</code></pre>
<pre><code>## [1] 812   3</code></pre>
<pre class="r"><code>#yes, there are now three variables and only 812 obs of 5765</code></pre>
<p><img src="SDM_pres_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<p>Okay, this looks good, but let’s reevaluate presence vs true absence. We don’t have absences, so we need to define points in regions where Joshua trees aren’t found. We want something informative (ie it’s not informative to identify the arctic circle in this model). In this case we will define a region that current observed trees could disperse to, but haven’t yet.</p>
<pre class="r"><code># define circles with a radius of 50 km around the subsampled points
x = circles(subs[,c(&quot;longitude&quot;,&quot;latitude&quot;)], d=50000, lonlat=T)
# draw random points that must fall within the circles in object x
#sp is sample point locations with an area 
bg = spsample(x@polygons, 1000, type=&#39;random&#39;, iter=1000)
#explain at polygons vs spatialpixels, line etc and &#39;random&#39; vs fibonacci
plot(x, border=&quot;orchid&quot;,lwd=3)
plot(bg, col=&quot;navyblue&quot;,shape=&quot;circle&quot;,add=TRUE,pch=20, cex=0.5)</code></pre>
<p><img src="SDM_pres_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<p><em>This is showing our Joshua tree presences and the pseudo-absences</em></p>
</div>
<div id="adding-climate-data" class="section level1">
<h1>Adding climate data</h1>
<p>The raster package allows for us to download from Bioclim, an open-source climate dataset from 1950 to 2000. You can extract by different spatial resolutions. Takes a lot of memory, so you could choose a specific location to save the data if you didn’t want it in your current working directory with path=“data/”.</p>
<pre class="r"><code>BClim = getData(&quot;worldclim&quot;, var=&quot;bio&quot;, res=2.5)
YbrevRange = extent(-119.25,-112.75,33.25,38.25) # define the extent
#Then crop the Bioclim data. Could save this to be reused in a future session with writeRaster().
BClim = crop(BClim, YbrevRange)
#now we have managable dataset, easier to plot
# this format plots the first (of 19) variables stored in BClim; change the 1 to 2-19 for the others
plot(BClim, 1, cex=0.5, legend=T, mar=par(&quot;mar&quot;), xaxt=&quot;n&quot;, yaxt=&quot;n&quot;, main=&quot;Annual mean temperature (ºC x 10)&quot;)
map(&quot;state&quot;, xlim=c(-119, -113), ylim=c(33.5, 38), fill=F, col=&quot;black&quot;, add=T)
#we can label the states again
text(x=-117.5, y=35.5, &quot;California&quot;, col=rgb(1,1,1,0.4), cex=2)
text(x=-116, y=37.5, &quot;Nevada&quot;, col=rgb(1,1,1,0.4), cex=2)
text(x=-113, y=34.5, &quot;Arizona&quot;, col=rgb(1,1,1,0.4), cex=2)
text(x=-113, y=37.75, &quot;Utah&quot;, col=rgb(1,1,1,0.4), cex=2)
#add the presence points again
points(subs$longitude, subs$latitude, col=&quot;darkgreen&quot;, pch=20, cex=0.5)
#and the pseudo-absence points
points(bg, cex=0.5, col=&quot;orangered3&quot;)
# add axes
axis(1,las=1)
axis(2,las=1)
box()</code></pre>
<p><img src="SDM_pres_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<p>This is pretty to look at, but we want to do analysis.</p>
<pre class="r"><code>#To actually extract the values for each of the 19 Bioclim variables, we just use the extract() function:
# pulling bioclim values
Ybrev_bc = extract(BClim, subs[,c(&quot;longitude&quot;,&quot;latitude&quot;)]) # for the subsampled presence points
bg_bc = extract(BClim, bg) # for the pseudo-absence points
#build datagrames, these will have two columns for coordinates and 19 climate variables
Ybrev_bc = data.frame(lon=subs$longitude, lat=subs$latitude, Ybrev_bc)
#and again for pseudo-absences
bgpoints = bg@coords
colnames(bgpoints) = c(&quot;lon&quot;,&quot;lat&quot;)
bg_bc = data.frame(cbind(bgpoints,bg_bc))
length(which(is.na(bg_bc$bio1))) # double-check for missing data</code></pre>
<pre><code>## [1] 8</code></pre>
<pre class="r"><code>bg_bc = bg_bc[!is.na(bg_bc$bio1), ] # and pull out the missing lines
group_p = kfold(Ybrev_bc, 5) # vector of group assignments splitting the Ybrev_bc into 5 groups
group_a = kfold(bg_bc, 5) # ditto for bg_bc
#we defined 5 groups so now we will choose one to use for our validating set-aside
test = 3
#Then we use test and the kfold groupings to divide the presence and absence points:
train_p = Ybrev_bc[group_p!=test, c(&quot;lon&quot;,&quot;lat&quot;)]
train_a = bg_bc[group_a!=test, c(&quot;lon&quot;,&quot;lat&quot;)]
test_p = Ybrev_bc[group_p==test, c(&quot;lon&quot;,&quot;lat&quot;)]
test_a = bg_bc[group_a==test, c(&quot;lon&quot;,&quot;lat&quot;)]</code></pre>
<div id="what-did-we-just-do" class="section level3">
<h3>What did we just do?</h3>
<p>To estimate the effectiveness of a predictive model, it’s common practice to set aside part of the dataset to validate the model. We’ll estimate the model from the total dataset minus the set-aside, then check the model’s ability to correctly identify the points in the set-aside as presences or absences. If we then re-divide the data, then re-estimate the model, then re-validate, we can begin to get a sense for how effective a given method is at estimating the SDM. For this purpose, the function kfold() creates a vector of values you can use to break your data into k groups of equal size, each of which can be used as the set-aside for testing over several iterations of this validation cycle. ## Species distribution model Okay, so you think you can dance. Well, you need to get Java. You will need to manually choose other versions of Java and get 64-bit. THEN, you may have to fool around in regedit.exe and make a key called Prefs under JavaSoft. Or or if that is already there(looks like a folder) right click and give full control in permissions. Once that is all in place you can use dismo for the maxent function in dismo for the maximum entropy and rJava so r and Java can talk to each other without us having to use the MAXENT window directly.</p>
<pre class="r"><code>me = maxent(BClim, p=train_p, a=train_a)</code></pre>
<pre><code>## Loading required namespace: rJava</code></pre>
<pre class="r"><code>#now evaluate the model
e = evaluate(test_p, test_a, me, BClim)
e</code></pre>
<pre><code>## class          : ModelEvaluation 
## n presences    : 162 
## n absences     : 198 
## AUC            : 0.831494 
## cor            : 0.561277 
## max TPR+TNR at : 0.3748659</code></pre>
<p>You will notice in these statistics is the AUC, area under curve. So how good is this model at labeling a geographic point as either a presence or an absence? Well an AUC of 0.5 would be no better than a coin flip. Ours is better than that, but we would want a higher number for publication of our SDM. We could use different portions of the total model for validation, we could alter our selections of pseudo-absence points, or the range of climate variables we use. Right now, this is good enough for me. Since I’m a happy mama, we will move on to visualizing the predictions from our model. # Estimate predicted probabilities</p>
<pre class="r"><code>## Visualize these predictions from the model by cell
pred_me = predict(me, BClim) # generate the predictions
# make a nice plot
plot(pred_me, 1, cex=0.5, legend=T, mar=par(&quot;mar&quot;), xaxt=&quot;n&quot;, yaxt=&quot;n&quot;, main=&quot;Predicted presence of Joshua trees&quot;)
map(&quot;state&quot;, xlim=c(-119, -113), ylim=c(33.5, 38), fill=F, col=&quot;black&quot;, add=T)
# state names
text(x=-117.5, y=35.5, &quot;California&quot;, col=rgb(1,1,1,0.6), cex=3)
text(x=-116, y=37.5, &quot;Nevada&quot;, col=rgb(1,1,1,0.6), cex=3)
text(x=-113, y=34.5, &quot;Arizona&quot;, col=rgb(1,1,1,0.6), cex=3)
text(x=-113, y=37.75, &quot;Utah&quot;, col=rgb(1,1,1,0.6), cex=3)
#presence
points(subs$longitude, subs$latitude, col=&quot;darkgreen&quot;, pch=20, cex=0.5)
#and the pseudo-absence points
points(bg, cex=0.5, col=&quot;orangered3&quot;)
axis(1,las=1)
axis(2,las=1)
box()</code></pre>
<p><img src="SDM_pres_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<p><em>Remember, the shading is not percipitation this time, but probabilities!</em> This is just a basic run through to play with that I hope you enjoy. Happy modeling! :)</p>
</div>
</div>
<div id="additional-questions" class="section level1">
<h1>Additional Questions</h1>
<ol style="list-style-type: decimal">
<li>Try running this code example again, but with different Bioclim variables.
<ol style="list-style-type: lower-alpha">
<li>Think about how adding more variables will change what we can learn from our SDM.</li>
<li>Based off of your ecological knowledge, what factors might be most important to start with when looking at the ranges of the Joshua trees? Would you chose the same variables to start with if it was a mammal?</li>
</ol></li>
<li>As a thought experiment, how might you add elevation or slope to this model? How might that become informative?</li>
</ol>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
