<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="S. Hromada, A. Parandhaman, A. Xiong" />

<meta name="date" content="2018-11-25" />

<title>Resource Selection Functions - NRES 746</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cerulean.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}

.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">NRES 746</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Schedule
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="schedule.html">Course Schedule</a>
    </li>
    <li>
      <a href="labschedule.html">Lab Schedule</a>
    </li>
    <li>
      <a href="Syllabus2.pdf">Syllabus</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Lectures
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="INTRO.html">Introduction to NRES 746</a>
    </li>
    <li>
      <a href="LECTURE1.html">Why focus on algorithms?</a>
    </li>
    <li>
      <a href="LECTURE2.html">Working with probabilities</a>
    </li>
    <li>
      <a href="LECTURE3.html">The Virtual Ecologist</a>
    </li>
    <li>
      <a href="LECTURE4.html">Likelihood</a>
    </li>
    <li>
      <a href="LECTURE5.html">Optimization</a>
    </li>
    <li>
      <a href="LECTURE6.html">Bayesian #1: concepts</a>
    </li>
    <li>
      <a href="LECTURE7.html">Bayesian #2: mcmc</a>
    </li>
    <li>
      <a href="LECTURE8.html">Model Selection</a>
    </li>
    <li>
      <a href="LECTURE9.html">Performance Evaluation</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Lab exercises
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="LAB1.html">Lab 1: Algorithms in R</a>
    </li>
    <li>
      <a href="FINALPROJ.html">Final project overview</a>
    </li>
    <li>
      <a href="LAB2.html">Lab 2: Virtual ecologist</a>
    </li>
    <li>
      <a href="LAB3.html">Lab 3: Likelihood</a>
    </li>
    <li>
      <a href="LAB4.html">Lab 4: Bayesian inference</a>
    </li>
    <li>
      <a href="LAB5.html">Lab 5: Model selection (optional)</a>
    </li>
    <li>
      <a href="FigureDemo.html">Demo: Figures in R</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Student-led topics
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="TimeSeries.html">Time-series analysis</a>
    </li>
    <li>
      <a href="SEM.html">Structural Equation Models</a>
    </li>
    <li>
      <a href="SpatialAutocorrelation.html">Spatial Autocorrelation</a>
    </li>
    <li>
      <a href="BayesianNetworks.html">Bayesian Networks</a>
    </li>
    <li>
      <a href="MixedEffects.html">Mixed Effects Models</a>
    </li>
    <li>
      <a href="Ordination.html">Ordination</a>
    </li>
    <li>
      <a href="QuantileRegression.html">Quantile Regression</a>
    </li>
    <li>
      <a href="RSFs.html">Resource Selection Functions</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Data sets
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="TreeData.csv">Tree Data</a>
    </li>
    <li>
      <a href="ReedfrogPred.csv">Reed Frog Predation Data</a>
    </li>
    <li>
      <a href="ReedfrogFuncresp.csv">Reed Frog Func Resp</a>
    </li>
  </ul>
</li>
<li>
  <a href="Links.html">Links</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Resource Selection Functions - NRES 746</h1>
<h4 class="author"><em>S. Hromada, A. Parandhaman, A. Xiong</em></h4>
<h4 class="date"><em>11/25/2018</em></h4>

</div>


<p>For those wishing to follow along with the R-based demo in class, <a href="RSFs.R">click here</a> for the companion R script for this lecture.</p>
<p>Follow along with our powerpoint presentation <a href="https://docs.google.com/presentation/d/1oT8zsYhlCYqr819nL53tgg_2_efumI72ToeSETS3Ci4/edit?usp=sharing">here</a></p>
<div id="logistic-regression" class="section level1">
<h1>Logistic Regression</h1>
<p>adapted from <a href="https://stats.idre.ucla.edu/r/dae/logit-regression/" class="uri">https://stats.idre.ucla.edu/r/dae/logit-regression/</a></p>
<pre class="r"><code>mydata &lt;- read.csv(&quot;https://stats.idre.ucla.edu/stat/data/binary.csv&quot;)
## view the first few rows of the data
head(mydata)</code></pre>
<pre><code>##   admit gre  gpa rank
## 1     0 380 3.61    3
## 2     1 660 3.67    3
## 3     1 800 4.00    1
## 4     1 640 3.19    4
## 5     0 520 2.93    4
## 6     1 760 3.00    2</code></pre>
<pre class="r"><code>mydata$rank &lt;- factor(mydata$rank)
mylogit &lt;- glm(admit ~ gre + gpa + rank, data = mydata, family = &quot;binomial&quot;)

summary(mylogit)</code></pre>
<pre><code>## 
## Call:
## glm(formula = admit ~ gre + gpa + rank, family = &quot;binomial&quot;, 
##     data = mydata)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -1.6268  -0.8662  -0.6388   1.1490   2.0790  
## 
## Coefficients:
##              Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) -3.989979   1.139951  -3.500 0.000465 ***
## gre          0.002264   0.001094   2.070 0.038465 *  
## gpa          0.804038   0.331819   2.423 0.015388 *  
## rank2       -0.675443   0.316490  -2.134 0.032829 *  
## rank3       -1.340204   0.345306  -3.881 0.000104 ***
## rank4       -1.551464   0.417832  -3.713 0.000205 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 499.98  on 399  degrees of freedom
## Residual deviance: 458.52  on 394  degrees of freedom
## AIC: 470.52
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<p>For every unit increase of gre/gpa, log odds of admission increase by 0.002/0.8 “Rank” variables show relative log odds of admission</p>
<p>We can use a Wald test to determine if “rank” is significant, with the chisquared portion</p>
<pre class="r"><code>aod::wald.test(b = coef(mylogit), Sigma = vcov(mylogit), Terms = 4:6)</code></pre>
<pre><code>## $Sigma
##              (Intercept)           gre           gpa         rank2
## (Intercept)  1.299488136 -3.012230e-04 -0.3036601226 -8.447562e-02
## gre         -0.000301223  1.196831e-06 -0.0001241775 -1.685461e-06
## gpa         -0.303660123 -1.241775e-04  0.1101040465  4.520512e-03
## rank2       -0.084475619 -1.685461e-06  0.0045205124  1.001657e-01
## rank3       -0.048643548  1.860520e-05 -0.0094686488  6.956636e-02
## rank4       -0.089431344  1.183599e-05  0.0035682837  7.012724e-02
##                     rank3         rank4
## (Intercept) -0.0486435476 -8.943134e-02
## gre          0.0000186052  1.183599e-05
## gpa         -0.0094686488  3.568284e-03
## rank2        0.0695663608  7.012724e-02
## rank3        0.1192365224  6.974161e-02
## rank4        0.0697416110  1.745833e-01
## 
## $b
##  (Intercept)          gre          gpa        rank2        rank3 
## -3.989979073  0.002264426  0.804037549 -0.675442928 -1.340203916 
##        rank4 
## -1.551463677 
## 
## $Terms
## [1] 4 5 6
## 
## $H0
## [1] 0 0 0
## 
## $L
##    (Intercept) gre gpa rank2 rank3 rank4
## L1           0   0   0     1     0     0
## L2           0   0   0     0     1     0
## L3           0   0   0     0     0     1
## 
## $result
## $result$chi2
##         chi2           df            P 
## 2.089532e+01 3.000000e+00 1.106793e-04 
## 
## 
## $verbose
## [1] FALSE
## 
## $df
## NULL
## 
## attr(,&quot;class&quot;)
## [1] &quot;wald.test&quot;</code></pre>
<p>Then we can turn them into odds-ratio (more interpretable)</p>
<pre class="r"><code>exp(cbind(OR = coef(mylogit), confint(mylogit)))</code></pre>
<pre><code>## Waiting for profiling to be done...</code></pre>
<pre><code>##                    OR       2.5 %    97.5 %
## (Intercept) 0.0185001 0.001889165 0.1665354
## gre         1.0022670 1.000137602 1.0044457
## gpa         2.2345448 1.173858216 4.3238349
## rank2       0.5089310 0.272289674 0.9448343
## rank3       0.2617923 0.131641717 0.5115181
## rank4       0.2119375 0.090715546 0.4706961</code></pre>
<p>Then we can also perform a goodness of fit test, tests whether is a better fit than null model by deviance of both</p>
<pre class="r"><code>with(mylogit, null.deviance - deviance) #test statistic </code></pre>
<pre><code>## [1] 41.45903</code></pre>
<pre class="r"><code>with(mylogit, df.null - df.residual) #degrees of freedom</code></pre>
<pre><code>## [1] 5</code></pre>
<pre class="r"><code>with(mylogit, pchisq(null.deviance - deviance, df.null - df.residual, lower.tail = FALSE)) #p-value</code></pre>
<pre><code>## [1] 7.578194e-08</code></pre>
<pre class="r"><code>logLik(mylogit)</code></pre>
<pre><code>## &#39;log Lik.&#39; -229.2587 (df=6)</code></pre>
<div id="resource-selection" class="section level2">
<h2>Resource Selection</h2>
</div>
<div id="goats" class="section level2">
<h2>Goats</h2>
<p>Picture of mtn Goats here</p>
<p>Dataset (provided in ResourceSelection package) collected on Mountain goats in Coast Mtns, BC (Lele &amp; Keim, 2006)</p>
<pre class="r"><code>library(ResourceSelection)</code></pre>
<pre><code>## ResourceSelection 0.3-2   2017-02-28</code></pre>
<pre class="r"><code>data(goats)
head(goats)</code></pre>
<pre><code>##   STATUS ID ELEVATION   SLOPE       ET   ASPECT       HLI      TASP
## 1      1  1       651 38.5216  35.3553 243.1131 0.9175926 0.9468804
## 2      1  1       660 39.6927  70.7107 270.0000 0.8840338 0.6986293
## 3      1  1       316 20.5477  50.0000 279.2110 0.7131423 0.5749115
## 4      1  1       334 34.0783  35.3553 266.1859 0.8643775 0.7447368
## 5      1  1       454 41.6187  25.0000 258.3106 0.9349181 0.8292587
## 6      1  1       343 28.4694 103.0776 237.0426 0.8254866 0.9756112</code></pre>
<p>19014 locations of 10 goats</p>
<p>Collected Variables: STATUS a numeric vector, 1: used, 0: available ID a numeric vector, individuals ELEVATION a numeric vector (m) SLOPE a numeric vector (degrees, steep) ET a numeric vector, access to escape terrain (distance from steep slopes, m) ASPECT a numeric vector (degrees) HLI a numeric vector, heat load index (0-1) TASP a numeric vector, transformed aspect</p>
<p>some data processing:</p>
<pre class="r"><code>goats$exp.HLI &lt;- exp(goats$HLI)
goats$sin.SLOPE &lt;- sin(pi * goats$SLOPE / 180)
goats$ELEVATION &lt;- scale(goats$ELEVATION)
goats$ET &lt;- scale(goats$ET)
goats$TASP &lt;- scale(goats$TASP)
head(goats)</code></pre>
<pre><code>##   STATUS ID  ELEVATION   SLOPE         ET   ASPECT       HLI      TASP
## 1      1  1 -0.9150137 38.5216 -0.6183467 243.1131 0.9175926 0.9803218
## 2      1  1 -0.8914406 39.6927 -0.3792833 270.0000 0.8840338 0.5836063
## 3      1  1 -1.7924533 20.5477 -0.5193233 279.2110 0.7131423 0.3858999
## 4      1  1 -1.7453073 34.0783 -0.6183467 266.1859 0.8643775 0.6572880
## 5      1  1 -1.4310005 41.6187 -0.6883664 258.3106 0.9349181 0.7923575
## 6      1  1 -1.7217343 28.4694 -0.1604274 237.0426 0.8254866 1.0262349
##    exp.HLI sin.SLOPE
## 1 2.503257 0.6228096
## 2 2.420644 0.6386698
## 3 2.040393 0.3509871
## 4 2.373528 0.5603253
## 5 2.547005 0.6641702
## 6 2.282991 0.4766893</code></pre>
<p>Now we fit the models. “m” describes the matching of use and available points, “0” will give us an unmatched design while other values will allow us to relate certain points. “B” is the number of bootstrap iterations</p>
<pre class="r"><code>m1 &lt;- rspf(STATUS ~ TASP + sin.SLOPE + ELEVATION, goats, m=0, B = 99)</code></pre>
<pre><code>## Loading required namespace: pbapply</code></pre>
<pre class="r"><code>m2 &lt;- rspf(STATUS ~ TASP + ELEVATION, goats, m=0, B = 99)
summary(m1)</code></pre>
<pre><code>## 
## Call:
## rspf(formula = STATUS ~ TASP + sin.SLOPE + ELEVATION, data = goats, 
##     m = 0, B = 99)
## 
## Resource Selection Probability Function (Logistic RSPF) model
## Non-matched Used-Available design
## Maximum Likelihood estimates
## with Nonparametric Bootstrap standard errors (B = 99)
## 
## Fitted probabilities:
##      Min.   1st Qu.    Median      Mean   3rd Qu.      Max. 
## 1.947e-08 4.280e-07 9.977e-07 1.376e-06 1.924e-06 8.793e-06 
## 
## Coefficients (logit link):
##              Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) -16.89454    0.29476 -57.317   &lt;2e-16 ***
## TASP          0.39116    0.01248  31.354   &lt;2e-16 ***
## sin.SLOPE     5.36640    0.09881  54.312   &lt;2e-16 ***
## ELEVATION     0.09829    0.01187   8.279   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 
## 
## Log-likelihood: -5.729e+04 
## BIC = 1.146e+05 
## 
## Hosmer and Lemeshow goodness of fit (GOF) test:
## X-squared = 152.4, df = 8, p-value &lt; 2.2e-16</code></pre>
<pre class="r"><code>summary(m2)</code></pre>
<pre><code>## 
## Call:
## rspf(formula = STATUS ~ TASP + ELEVATION, data = goats, m = 0, B = 99)
## 
## Resource Selection Probability Function (Logistic RSPF) model
## Non-matched Used-Available design
## Maximum Likelihood estimates
## with Nonparametric Bootstrap standard errors (B = 99)
## 
## Fitted probabilities:
##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
## 0.01194 0.58006 0.86178 0.73656 0.95712 0.99835 
## 
## Coefficients (logit link):
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  1.62906    0.10049   16.21   &lt;2e-16 ***
## TASP         1.86071    0.07700   24.16   &lt;2e-16 ***
## ELEVATION    1.14338    0.08185   13.97   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 
## 
## Log-likelihood: -5.91e+04 
## BIC = 1.182e+05 
## 
## Hosmer and Lemeshow goodness of fit (GOF) test:
## X-squared = 174.3, df = 8, p-value &lt; 2.2e-16</code></pre>
<pre class="r"><code>CAIC(m1, m2)</code></pre>
<pre><code>##    df     CAIC
## m1  4 114591.7
## m2  3 118225.2</code></pre>
<pre class="r"><code>#plot(m1)
ResourceSelection::mep(m1) # marginal effects similar to plot but with CIs</code></pre>
<p><img src="RSFs_files/figure-html/unnamed-chunk-8-1.png" width="672" /><img src="RSFs_files/figure-html/unnamed-chunk-8-2.png" width="672" /><img src="RSFs_files/figure-html/unnamed-chunk-8-3.png" width="672" /><img src="RSFs_files/figure-html/unnamed-chunk-8-4.png" width="672" /></p>
<pre class="r"><code>ResourceSelection::kdepairs(m1) # 2D kernel density estimates</code></pre>
<p><img src="RSFs_files/figure-html/unnamed-chunk-8-5.png" width="672" /></p>
<pre class="r"><code>plot(m2)</code></pre>
<p><img src="RSFs_files/figure-html/unnamed-chunk-8-6.png" width="672" /><img src="RSFs_files/figure-html/unnamed-chunk-8-7.png" width="672" /></p>
<pre class="r"><code>ResourceSelection::kdepairs(m2)</code></pre>
<p><img src="RSFs_files/figure-html/unnamed-chunk-8-8.png" width="672" /></p>
<pre class="r"><code>ResourceSelection::mep(m2)</code></pre>
<p><img src="RSFs_files/figure-html/unnamed-chunk-8-9.png" width="672" /><img src="RSFs_files/figure-html/unnamed-chunk-8-10.png" width="672" /><img src="RSFs_files/figure-html/unnamed-chunk-8-11.png" width="672" /></p>
<p>Let’s create our own, using raw telemetry data. This dataset comes from the “amt” package, and contains locations of one red deer in Germany.</p>
<pre class="r"><code>library(lubridate, quietly = T)</code></pre>
<pre><code>## 
## Attaching package: &#39;lubridate&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:base&#39;:
## 
##     date</code></pre>
<pre class="r"><code>library(amt, quietly = T)</code></pre>
<pre><code>## 
## Attaching package: &#39;amt&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:stats&#39;:
## 
##     filter</code></pre>
<pre class="r"><code>library(raster, quietly = T)</code></pre>
<pre><code>## Warning: package &#39;sp&#39; was built under R version 3.5.1</code></pre>
<pre><code>## 
## Attaching package: &#39;sp&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:amt&#39;:
## 
##     bbox</code></pre>
<pre><code>## 
## Attaching package: &#39;raster&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:amt&#39;:
## 
##     select</code></pre>
<pre class="r"><code>data(deer)
head(deer)</code></pre>
<pre><code>## # A tibble: 6 x 4
##         x_       y_ t_                  burst_
## *    &lt;dbl&gt;    &lt;dbl&gt; &lt;dttm&gt;               &lt;dbl&gt;
## 1 4314068. 3445807. 2008-03-30 00:01:47      1
## 2 4314053. 3445768. 2008-03-30 06:00:54      1
## 3 4314105. 3445859. 2008-03-30 12:01:47      1
## 4 4314044. 3445785. 2008-03-30 18:01:24      1
## 5 4313015. 3445858. 2008-03-31 00:01:23      1
## 6 4312860. 3445857. 2008-03-31 06:01:45      1</code></pre>
<p>Each point (n=826) is just a coordinate and time. Let’s plot the raw telemetry data:</p>
<pre class="r"><code>plot(deer$x_, deer$y_)</code></pre>
<p><img src="RSFs_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<p>Now we load in our environmental variable (a raster also provided in the amt package). A value of 1 indicates a forest pixel, while 2 indicates a non forest pixel.</p>
<pre class="r"><code>data(&quot;sh_forest&quot;)
(sh_forest)</code></pre>
<pre><code>## class       : RasterLayer 
## dimensions  : 720, 751, 540720  (nrow, ncol, ncell)
## resolution  : 25, 25  (x, y)
## extent      : 4304725, 4323500, 3437725, 3455725  (xmin, xmax, ymin, ymax)
## coord. ref. : +proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs 
## data source : in memory
## names       : sh.forest 
## values      : 1, 2  (min, max)</code></pre>
<pre class="r"><code>plot(sh_forest)
points(deer$x_, deer$y_)</code></pre>
<p><img src="RSFs_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<p>To make it more interesting (and allow the rspf function from ResourceSelection to work), lets make a continuous variable</p>
<pre class="r"><code>set.seed(3)
hab &lt;- raster(nrows = sh_forest@nrows, ncol = sh_forest@ncols, ext = sh_forest@extent)
hab &lt;- setValues(hab, rnorm(ncell(hab), mean=15, sd=3))
plot(hab)
points(deer$x_, deer$y_)</code></pre>
<p><img src="RSFs_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<p>Next we will create a random sampling of the area around where the deer was observed, designating “available” habitat. There are many ways you can go about this (and is an area of considerable debate), but we will simply create random points within the minimum convex hull of the deer locations.</p>
<pre class="r"><code>avail &lt;- random_points(deer)
plot(avail$x_, avail$y_)
points(deer$x_, deer$y_, col=&quot;red&quot;, pch=19)</code></pre>
<p><img src="RSFs_files/figure-html/unnamed-chunk-13-1.png" width="672" /> Now let’s extract the habitat values for each point in the deer’s use and the random use</p>
<pre class="r"><code>deer &lt;- deer %&gt;% extract_covariates(sh_forest) 
avail &lt;- avail %&gt;% extract_covariates(sh_forest)
deer &lt;- deer %&gt;% extract_covariates(hab) 
avail &lt;- avail %&gt;% extract_covariates(hab)

deer$use &lt;- 1
avail$use &lt;- 0
deer.c &lt;- plyr::rbind.fill(deer, avail)

deer.c &lt;- deer.c %&gt;% 
  mutate(forest = factor(sh.forest, levels = 1:2, labels = c(&quot;forest&quot;, &quot;non-forest&quot;))) 

head(deer.c)</code></pre>
<pre><code>##        x_      y_                  t_ burst_ sh.forest    layer use case_
## 1 4314068 3445807 2008-03-30 00:01:47      1         2 12.03266   1    NA
## 2 4314053 3445768 2008-03-30 06:00:54      1         2 17.93293   1    NA
## 3 4314105 3445859 2008-03-30 12:01:47      1         2 16.10760   1    NA
## 4 4314044 3445785 2008-03-30 18:01:24      1         2 14.93261   1    NA
## 5 4313015 3445858 2008-03-31 00:01:23      1         1 12.03256   1    NA
## 6 4312860 3445857 2008-03-31 06:01:45      1         1 24.36156   1    NA
##       forest
## 1 non-forest
## 2 non-forest
## 3 non-forest
## 4 non-forest
## 5     forest
## 6     forest</code></pre>
<pre class="r"><code>tail(deer.c)</code></pre>
<pre><code>##           x_      y_   t_ burst_ sh.forest    layer use case_     forest
## 9907 4316770 3447792 &lt;NA&gt;     NA         2 15.28169   0 FALSE non-forest
## 9908 4316100 3448312 &lt;NA&gt;     NA         2 11.64061   0 FALSE non-forest
## 9909 4312481 3446510 &lt;NA&gt;     NA         2 14.81225   0 FALSE non-forest
## 9910 4311792 3447221 &lt;NA&gt;     NA         2 15.47709   0 FALSE non-forest
## 9911 4311581 3444055 &lt;NA&gt;     NA         1 17.33755   0 FALSE     forest
## 9912 4315560 3449291 &lt;NA&gt;     NA         1 16.04431   0 FALSE     forest</code></pre>
<p>Now let’s fit the model</p>
<pre class="r"><code>deer.rsf &lt;- rspf(use ~ forest + layer, data=deer.c, m=0, B=99)
summary(deer.rsf)</code></pre>
<pre><code>## 
## Call:
## rspf(formula = use ~ forest + layer, data = deer.c, m = 0, B = 99)
## 
## Resource Selection Probability Function (Logistic RSPF) model
## Non-matched Used-Available design
## Maximum Likelihood estimates
## with Nonparametric Bootstrap standard errors (B = 99)
## 
## Fitted probabilities:
##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
## 0.06904 0.07112 0.07169 0.08310 0.07277 0.12747 
## 
## Coefficients (logit link):
##                   Estimate Std. Error z value Pr(&gt;|z|)
## (Intercept)      -1.907231   4.631085  -0.412    0.680
## forestnon-forest -0.603934   2.854546  -0.212    0.832
## layer            -0.003572   0.027191  -0.131    0.895
## 
## Log-likelihood: -7504 
## BIC = 1.503e+04 
## 
## Hosmer and Lemeshow goodness of fit (GOF) test:
## X-squared = 15.37, df = 8, p-value 0.0523</code></pre>
<pre class="r"><code>mep(deer.rsf) # marginal effects similar to plot but with CIs</code></pre>
<p><img src="RSFs_files/figure-html/unnamed-chunk-15-1.png" width="672" /><img src="RSFs_files/figure-html/unnamed-chunk-15-2.png" width="672" /><img src="RSFs_files/figure-html/unnamed-chunk-15-3.png" width="672" /></p>
<pre class="r"><code>kdepairs(deer.rsf) # 2D kernel density estimates</code></pre>
<p><img src="RSFs_files/figure-html/unnamed-chunk-15-4.png" width="672" /></p>
<pre class="r"><code>plot(deer.rsf)</code></pre>
<p><img src="RSFs_files/figure-html/unnamed-chunk-15-5.png" width="672" /><img src="RSFs_files/figure-html/unnamed-chunk-15-6.png" width="672" /></p>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
