<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Margarete Walden and Karly Feher" />


<title>Structural Equation Modeling Minilab</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cerulean.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<script src="site_libs/htmlwidgets-0.7/htmlwidgets.js"></script>
<script src="site_libs/viz-0.3/viz.js"></script>
<link href="site_libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
<script src="site_libs/grViz-binding-0.8.4/grViz.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}

.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">NRES 746</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Schedule
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="schedule.html">Course Schedule</a>
    </li>
    <li>
      <a href="labschedule.html">Lab Schedule</a>
    </li>
    <li>
      <a href="Syllabus2.pdf">Syllabus</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Lectures
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="INTRO.html">Introduction to NRES 746</a>
    </li>
    <li>
      <a href="LECTURE1.html">Why focus on algorithms?</a>
    </li>
    <li>
      <a href="LECTURE2.html">Working with probabilities</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Lab exercises
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="LAB1.html">Lab 1: Algorithms in R</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Data sets
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="TreeData.csv">Tree Data</a>
    </li>
  </ul>
</li>
<li>
  <a href="Links.html">Links</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Structural Equation Modeling Minilab</h1>
<h4 class="author"><em>Margarete Walden and Karly Feher</em></h4>
<h4 class="date"><em>December 1, 2016</em></h4>

</div>


<div id="sem-minilab-path-analysis" class="section level2">
<h2><a name="top"/>SEM Minilab: Path Analysis </a></h2>
<p>First, let’s review our Path Analysis Example from the SEM lecture.</p>
<div id="htmlwidget-a6f1062bf3999a8cdf95" style="width:672px;height:288px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-a6f1062bf3999a8cdf95">{"x":{"diagram":"digraph {\n\ngraph [rankdir=LR]\n\n\n  \"a\" [label = \"distance\", shape = \"rectangle\", color = \"black\"] \n  \"b\" [label = <abiotic  r<FONT POINT-SIZE=\"8\"><SUP>2\u003c/SUP>\u003c/FONT>=0.21>, shape = \"rectangle\", color = \"black\"] \n  \"c\" [label = <hetero  r<FONT POINT-SIZE=\"8\"><SUP>2\u003c/SUP>\u003c/FONT>=0.12>, shape = \"rectangle\", color = \"black\"] \n  \"d\" [label = <richness  r<FONT POINT-SIZE=\"8\"><SUP>2\u003c/SUP>\u003c/FONT>=0.36>, shape = \"rectangle\", color = \"black\"] \n\"a\"->\"b\" [label = \"0.46\", color = \"black\"] \n\"a\"->\"c\" [label = \"0.35\", color = \"black\"] \n\"b\"->\"d\" [label = \"0.41\", color = \"black\"] \n\"c\"->\"d\" [label = \"0.34\", color = \"black\"] \n\"b\"->\"b\" [label = \"0.889\", color = \"grey\"] \n\"c\"->\"c\" [label = \"0.938\", color = \"grey\"] \n\"d\"->\"d\" [label = \"0.800\", color = \"grey\"] \n}","config":{"engine":null,"options":null}},"evals":[],"jsHooks":[]}</script>
<p>In this example we were trying to understand patterns in species richness over five years following fire. Parameters were measured in 90 x 1000 <span class="math inline">\(m^2\)</span> plots. We focused on four measured variables: distance to ocean, abiotic index, spatial heterogeneity, and species richness.</p>
<p>Now let’s review the steps taken in this example. Download the data from Webcampus, “Files” &gt;&gt; “Student led topics” &gt;&gt; “SEM” &gt;&gt; “Keeley_rawdata.csv”</p>
<pre class="r"><code>keeley &lt;-read.csv(&quot;./Keeley_rawdata.csv&quot;, header =TRUE)
summary(keeley) #-- Look at data</code></pre>
<pre><code>##     distance          elev           abiotic           age       
##  Min.   :37.04   Min.   :  60.0   Min.   :32.59   Min.   : 3.00  
##  1st Qu.:39.46   1st Qu.: 202.5   1st Qu.:43.81   1st Qu.:15.00  
##  Median :51.77   Median : 400.0   Median :48.04   Median :25.00  
##  Mean   :49.23   Mean   : 424.7   Mean   :49.24   Mean   :25.57  
##  3rd Qu.:58.40   3rd Qu.: 630.0   3rd Qu.:54.90   3rd Qu.:35.00  
##  Max.   :60.72   Max.   :1225.0   Max.   :70.46   Max.   :60.00  
##      hetero          firesev          cover              rich      
##  Min.   :0.3842   Min.   :1.200   Min.   :0.05558   Min.   :15.00  
##  1st Qu.:0.6246   1st Qu.:3.700   1st Qu.:0.48769   1st Qu.:37.00  
##  Median :0.6843   Median :4.300   Median :0.63712   Median :50.00  
##  Mean   :0.6833   Mean   :4.565   Mean   :0.69123   Mean   :49.23  
##  3rd Qu.:0.7684   3rd Qu.:5.550   3rd Qu.:0.91468   3rd Qu.:62.00  
##  Max.   :0.8779   Max.   :9.200   Max.   :1.53541   Max.   :85.00</code></pre>
<p>Our first step is to perform linear regression for each piece of our hypothesized model. These “piecewise” linear regressions tell us some information about our model variables. We can determine whether individual variables are significant in each regression by looking at the p-values for the parameter estimates. Also, we can find the <span class="math inline">\(r^2\)</span> values for our endogenous variables from the “lm” function in R.</p>
<pre class="r"><code>abioticLM &lt;- lm(abiotic~distance, data=keeley)    #-- Abiotic caused by distance
heteroLM &lt;- lm(hetero~distance, data=keeley)      #-- Heterogeneity caused by distance
richnessLM &lt;- lm(rich~abiotic+hetero,data=keeley) #-- Richness caused by abiotic and heterogeneity
summary(abioticLM)$coefficients
summary(heteroLM)$coefficients
summary(richnessLM)$coefficients
summary(abioticLM)$r.squared
summary(heteroLM)$r.squared
summary(richnessLM)$r.squared</code></pre>
<pre><code>##               Estimate Std. Error  t value     Pr(&gt;|t|)
## (Intercept) 29.5537053 4.11762269 7.177371 2.142310e-10
## distance     0.3998271 0.08233372 4.856176 5.158424e-06
##                Estimate  Std. Error  t value     Pr(&gt;|t|)
## (Intercept) 0.461802396 0.065045361 7.099698 3.063408e-10
## distance    0.004499205 0.001300611 3.459300 8.370677e-04
##                Estimate Std. Error   t value     Pr(&gt;|t|)
## (Intercept) -21.6224780 10.0651511 -2.148252 3.447302e-02
## abiotic       0.8135516  0.1746343  4.658602 1.136795e-05
## hetero       45.0702119 11.6796513  3.858866 2.181692e-04
## [1] 0.2113455
## [1] 0.1197074
## [1] 0.3667967</code></pre>
<p>Remember, an ANOVA is linear regression. An alternative to looking at the summaries for each “lm” object above is to use the “aov” function to determine whether our three hypothesized linear relationships are significant:</p>
<pre class="r"><code>summary(aov(abioticLM))
summary(aov(heteroLM))
summary(aov(richnessLM))</code></pre>
<pre><code>##             Df Sum Sq Mean Sq F value   Pr(&gt;F)    
## distance     1   1109    1109   23.58 5.16e-06 ***
## Residuals   88   4139      47                     
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
##             Df Sum Sq Mean Sq F value   Pr(&gt;F)    
## distance     1 0.1405 0.14045   11.97 0.000837 ***
## Residuals   88 1.0329 0.01174                     
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
##             Df Sum Sq Mean Sq F value   Pr(&gt;F)    
## abiotic      1   5248    5248   35.51 5.28e-08 ***
## hetero       1   2201    2201   14.89 0.000218 ***
## Residuals   87  12859     148                     
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>Notice that the p-values for significance are the same as above.</p>
<p>Because all variables are significant in our piecewise linear regressions, we will retain all terms in our model.</p>
<p>Our next step is to estimate the parameters in our model. Remember, our parameters are the path coefficients and error terms. We can use the <span class="math inline">\(r^2\)</span> values from our earlier piecewise linear regressions for our endogenous variables and error terms because we are retaining all of those variables in our model. Now we need to estimate the path coefficients.</p>
<p>To standardize our path coefficients, divide the covariance by the standard deviations. There are two ways to do this in R: you can use the “cor” function to display the correlation matrix for all your variables, and then fill in the values. The other way is to use the “lm.beta” function in the package “QuantPsyc”. This will return the standardized path coefficient(s) directly for individual piecewise linear regressions.</p>
<pre class="r"><code>cor_matrix &lt;- cor(keeley[,c(1,3,5,8)])      #-- The [,] is matrix notation in which the (row,column) numbers can be specified. In this case, we&#39;re saying to use only the numbered columns of data to calculate the correlation matrix.
cor_matrix

library(QuantPsyc)
lm.beta(abioticLM)   #-- Path from &quot;distance&quot; to &quot;abiotic&quot;.
lm.beta(heteroLM)    #-- Path from &quot;distance&quot; to &quot;hetero&quot;.
lm.beta(richnessLM)  #-- &quot;abiotic&quot; = path from &quot;abiotic&quot; to &quot;richness&quot;; &quot;hetero&quot; = path from &quot;hetero&quot; to richness.</code></pre>
<pre><code>##           distance   abiotic    hetero      rich
## distance 1.0000000 0.4597233 0.3459875 0.5844775
## abiotic  0.4597233 1.0000000 0.2766418 0.5083485
## hetero   0.3459875 0.2766418 1.0000000 0.4569914
## rich     0.5844775 0.5083485 0.4569914 1.0000000
##  distance 
## 0.4597233 
##  distance 
## 0.3459875 
##   abiotic    hetero 
## 0.4135769 0.3425788</code></pre>
<p>Note that the “lm.beta” function and the “cor” function return the same values.</p>
<p>We will now proceed to fill in our estimates for our model:</p>
<div id="htmlwidget-f0f9ead967eb29cec4c3" style="width:672px;height:288px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-f0f9ead967eb29cec4c3">{"x":{"diagram":"digraph {\n\ngraph [rankdir=LR]\n\n\n  \"a\" [label = \"distance\", shape = \"rectangle\", color = \"black\"] \n  \"b\" [label = <abiotic  r<FONT POINT-SIZE=\"8\"><SUP>2\u003c/SUP>\u003c/FONT>=0.21>, shape = \"rectangle\", color = \"black\"] \n  \"c\" [label = <hetero  r<FONT POINT-SIZE=\"8\"><SUP>2\u003c/SUP>\u003c/FONT>=0.12>, shape = \"rectangle\", color = \"black\"] \n  \"d\" [label = <richness  r<FONT POINT-SIZE=\"8\"><SUP>2\u003c/SUP>\u003c/FONT>=0.36>, shape = \"rectangle\", color = \"black\"] \n\"a\"->\"b\" [label = \"0.46\", color = \"black\"] \n\"a\"->\"c\" [label = \"0.35\", color = \"black\"] \n\"b\"->\"d\" [label = \"0.41\", color = \"black\"] \n\"c\"->\"d\" [label = \"0.34\", color = \"black\"] \n\"b\"->\"b\" [label = \"0.889\", color = \"grey\"] \n\"c\"->\"c\" [label = \"0.938\", color = \"grey\"] \n\"d\"->\"d\" [label = \"0.800\", color = \"grey\"] \n}","config":{"engine":null,"options":null}},"evals":[],"jsHooks":[]}</script>
<p>Next we test for mediation. In a mediation relationship, there is a direct effect between an independent variable and a dependent variable. There are also indirect effects between an independent variable and a mediator variable, and between a mediator variable and a dependent variable.</p>
<p>The degree to which the direct effect changes as a result of including the mediating variable is referred to as the mediational effect. Testing for mediation involves running a series of regression analyses for all of the causal pathways and some method of estimating a change in direct effect.</p>
<p>In our example, we have two mediations: the effect of “distance” on “richness” is mediated by two mediator variables: “abiotic” and “hetero”. We need to investigate whether these mediations are fully explaining the effect of “distance” on “richness.” One way to determine this is to look at the residuals from the linear regression of “richness” by “abiotic” and “hetero.” The residuals will be the remaining variance in “richness” not explained by “abiotic” and “hetero.” We would expect no structure in the residuals if “abiotic” and “hetero” are fully explaining all effects. However, if we saw a relationship between the residuals and “distance”, we would suspect that there is some effect of “distance” on “richness” that is not being sufficiently explained, or mediated, by “abiotic” and “hetero.” Let’s do this in R:</p>
<pre class="r"><code>#-- First we&#39;ll extract the residuals from the linear regression of richness by abiotic and hetero.
resid_rich &lt;- resid(richnessLM)
#-- Next, we&#39;ll perform a linear regression of these residuals by distance. If this relationship is significant, it would indicate we are missing a path in our model because abiotic and hetero are incomplete mediators.
residLM &lt;- lm(resid_rich~distance,data=keeley)
summary(residLM)$coefficients   #-- The relationship is signficant (we could also test this using the &quot;aov&quot; function)
#-- To help visualize this, we&#39;ll plot the residuals against distance and show the fitted linear regression.
plot(resid_rich~distance,data=keeley)
abline(residLM,col=&quot;blue&quot;,lwd=2)</code></pre>
<p><img src="SEM_Minilab_v2_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<pre><code>##                Estimate Std. Error   t value     Pr(&gt;|t|)
## (Intercept) -23.2326282  6.8078379 -3.412629 0.0009741965
## distance      0.4718762  0.1361258  3.466472 0.0008176835</code></pre>
<p>As distance increases, the values of the residuals increase. Because this relationship is signficant, we conclude that we need to add a path in our model from “distance” to “richness”.</p>
<p>Now, we would need to perform a new regression: <code>lm(rich~abiotic+hetero+distance)</code> in order to estimate the new <span class="math inline">\(r^2\)</span> for “richness”. For the purposes of this example, we are going to show what would happen if you went directly to testing goodness of fit without investigating mediation. (In the end, the final model chosen will be the same by either process.)</p>
<div id="d-separation-and-goodness-of-fit" class="section level3">
<h3><a name="fit"/>D-separation and goodness of fit</a></h3>
<p>Next, we evaluate goodness of fit. Our first check is to use d-separation to determine whether the observed data adequately account for the modeled probabilities.</p>
<p>Rewording from earlier, the d-separation criterion for any pair of variables involves:</p>
<ol style="list-style-type: decimal">
<li>Controlling for common ancestors that could generate correlations between the pair.</li>
<li>Controlling for causal connections through multi-link directed pathways via parents.</li>
<li>Not controlling for common descendent variables.</li>
</ol>
<p>In the context of our model (ignoring the path from “distance” to “richness”), if we wanted to formulate a d-separation statement for the path from “distance” to “richness”:</p>
<ol style="list-style-type: decimal">
<li>There are no common ancestors.</li>
<li>We include the parents of “richness” that are part of mediating pathways: “abiotic”&quot; and “hetero”.</li>
<li>There are no common descendents.</li>
</ol>
<p>Thus, we conclude that the residuals for “distance” and “richness” are predicted to be uncorrelated.</p>
<p>Because writing out the entire set of all possible d-statements would involve overlap and would increase the possibility of Type II error, we will identify what is called the “basis set”, which is the minimum number of d=separation statements that is sufficient to predict the entire set of d-separation statements. In this case:</p>
<p><span class="math display">\[
\textrm{distance}\perp \textrm{richness} | (\textrm{abiotic, hetero})\\
\textrm{biotic}\perp \textrm{hetero} | (\textrm{distance})
\]</span> Each of these d-separated statements predicts a (conditional) probabilistic independence:</p>
<ol style="list-style-type: decimal">
<li>“Distance” is d-separated from “richness” when conditioned on “abiotic” and “hetero”.</li>
<li>“Biotic” is d-separated from “hetero” when conditioned on “distance”.</li>
</ol>
<p>The composite probability for the basis set is Fisher’s C test: <span class="math display">\[
C=-2*\sum_{i=1}^{k}Ln(p_{i})
\]</span> Where <span class="math inline">\(p_{i}=\)</span> p-values of all tests of conditional independence; <em>C</em> has a chi-square distribution with 2k degrees of freedom; <em>k</em> = number of elements of the basis set.</p>
<p>We conclude that the predicted variables are conditionally independent if <span class="math inline">\(p&gt;05\)</span>. If <span class="math inline">\(p&lt;.05\)</span>, there are likely to be missing paths (in order to account for the lack of independence).</p>
<p>We’ll use some built-in functions in R to determine the fit test:</p>
<pre class="r"><code>library(piecewiseSEM)</code></pre>
<pre><code>## Warning in sample.int(.Machine$integer.max - 1L, 1L): &#39;.Random.seed&#39; is not
## an integer vector but of type &#39;NULL&#39;, so ignored</code></pre>
<pre class="r"><code>#-- First, build a model object using the correct syntax:
modList &lt;- list(
  lm(abiotic~distance, data=keeley),
  lm(hetero~distance,data=keeley),
  lm(rich~abiotic+hetero,data=keeley)
)
#-- Next, run the Fisher C test:
sem.fisher.c(modList,data=keeley,.progressBar=FALSE)</code></pre>
<pre><code>##   fisher.c df p.value
## 1    21.86  4       0</code></pre>
<p>Because the p-value &lt; 0.05, we know that the model is missing a pathway. Let’s suppose that pathway is a direct pathway from “distance to ocean” to “richness” (as we concluded from our evaluation of mediation). So, that means our new script will be:</p>
<pre class="r"><code>#-- First, build a model object using the correct syntax:
modList2 &lt;- list(
  lm(abiotic~distance, data=keeley),
  lm(hetero~distance,data=keeley),
  lm(rich~abiotic+hetero+distance,data=keeley) #-- note that we&#39;ve added &quot;distance&quot; as a direct cause of &quot;richness&quot;
)
#-- Next, run the Fisher C test:
sem.fisher.c(modList2,data=keeley,.progressBar=FALSE)</code></pre>
<pre><code>##   fisher.c df p.value
## 1     3.35  2   0.187</code></pre>
<p>Now, our p-value is &gt; 0.05. This means we can conclude our model is supported by our data. We can use the package semPlot to visualize our final model:</p>
<pre class="r"><code>library(lavaan)
library(semPlot)
#--First create an object that stores the relationships between the variables:
modList3 &lt;- &#39;
  abiotic~distance
  hetero~distance
  rich~abiotic+hetero+distance
&#39;
#--Next, we need to create a model object that &quot;semPaths&quot; can work with. In this case, we use the &quot;sem&quot; function in the library &quot;lavaan&quot; to create our SEM model object &quot;fullfit1&quot;.
fullfit1 &lt;- sem(modList3, data=keeley)
#--Then visualize the model:
semPaths(fullfit1,rotate=1,layout=&quot;spring&quot;,&quot;std&quot;)</code></pre>
<p><img src="SEM_Minilab_v2_files/figure-html/unnamed-chunk-10-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Note that the “sem” function in the package “lavaan” uses maximum likelihood estimation by default for estimating the model parameters. This compares the modeled covariance matrix to the observed covariance matrix. For path analysis, the ML estimates are likely to be very close to the piecewise estimates we generated earlier using Least Squares from our linear regressions.</p>
<p>Using this model, we would make the following inferences:</p>
<ol style="list-style-type: decimal">
<li>46% of the variance of “richness” is accounted for by the path model, 54% is residual variance.</li>
<li>The correlation between “distance” and “richness” is the sum of the products of the path coefficients along each path. Thus, <span class="math inline">\((0.27*0.46)+(0.38)+(0.26*0.35)=0.595\)</span>, meaning that 59.5% of the correlation between “distance” and “richness” is due to the direct and indirect effects of “distance” on “richness”.</li>
</ol>
</div>
<div id="question-1" class="section level3">
<h3>Question 1</h3>
<p>We would like to add another measured variable, Cover, to our model.</p>
<div id="htmlwidget-42edba03c575651d11fd" style="width:672px;height:192px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-42edba03c575651d11fd">{"x":{"diagram":"digraph {\n\ngraph [rankdir=LR]\n\n\n  \"a\" [label = \"distance\", shape = \"rectangle\", color = \"black\"] \n  \"b\" [label = \"abiotic\", shape = \"rectangle\", color = \"black\"] \n  \"c\" [label = \"hetero\", shape = \"rectangle\", color = \"black\"] \n  \"d\" [label = \"richness\", shape = \"rectangle\", color = \"black\"] \n  \"e\" [label = \"cover\", shape = \"rectangle\", color = \"black\"] \n\"a\"->\"b\" [color = \"black\"] \n\"a\"->\"c\" [color = \"black\"] \n\"a\"->\"d\" [color = \"black\"] \n\"a\"->\"e\" [color = \"black\"] \n\"b\"->\"d\"\n\"c\"->\"d\"\n\"e\"->\"d\"\n}","config":{"engine":null,"options":null}},"evals":[],"jsHooks":[]}</script>
<p>Fit and evalute the above model</p>
<ol style="list-style-type: decimal">
<li>Fill in the standard coefficients</li>
<li>Test for mediation</li>
<li>Evaluate goodness of fit (using d-seperation)</li>
<li>What inferences can we make about this model?</li>
</ol>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
